<!DOCTYPE html>
<html lang="en">

<head>
	<meta http-equiv="content-type" content="text/html; charset=utf-8">
	<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
	<link rel="stylesheet" href="/css/highlight/styles/vs2015.css">
	<!-- title -->
	
	<title>
	
		00 rocksdb release log | 
	 
	Fly542 技术积累
	</title>
	
	<!-- keywords,description -->
	 

	<!-- favicon -->
	
	<link rel="shortcut icon" href="/favicon.ico">
	
  

	
<link rel="stylesheet" href="/css/main.css">

	
<link rel="stylesheet" href="https://cdn.staticfile.org/font-awesome/4.7.0/css/font-awesome.min.css">

	
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.17.1/build/styles/darcula.min.css">


	
<script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.17.1/build/highlight.min.js"></script>

	
<script src="https://cdn.jsdelivr.net/npm/jquery@3.4.1/dist/jquery.min.js"></script>

	
<script src="https://cdn.jsdelivr.net/npm/jquery-pjax@2.0.1/jquery.pjax.min.js"></script>

	
<script src="/js/main.js"></script>

	
		
<script src="https://cdn.jsdelivr.net/npm/leancloud-storage/dist/av-min.js"></script>

		
<script src="https://cdn.jsdelivr.net/npm/valine@1.3.10/dist/Valine.min.js"></script>

	
	
		<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
	
<meta name="generator" content="Hexo 4.2.1"></head>

<body>
	<header id="header">
    <a id="title" href="/" class="logo">Fly542 技术积累</a>

	<ul id="menu">
		<li class="menu-item">
			<a href="/about" class="menu-item-link">关于我</a>
		</li>
		
		<li class="menu-item">
			<a href="https://fly542.cn" class="menu-item-link" target="_blank">
				<i class="fa fa-github fa-2x"></i>
			</a>
		</li>
	</ul>
</header>


	
<div id="sidebar">
	<button id="sidebar-toggle" class="toggle" ><i class="fa fa-arrow-right " aria-hidden="true"></i></button>
	
	<div id="site-toc">
		<input id="search-input" class="search-input" type="text" placeholder="search...">
		<div id="tree">
			

			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										00 操作系统
									</a>
									
							<ul>
								<li class="file">
									<a href="/2020/07/25/00%20%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/linux%E4%B8%8BIO%E5%BA%94%E7%94%A8%E8%AF%A6%E8%A7%A3/">
										linux下IO应用详解
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										01 架构设计与软件工程
									</a>
									
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										00 架构设计
									</a>
									
							<ul>
								<li class="file">
									<a href="/2020/07/25/01%20%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E4%B8%8E%E8%BD%AF%E4%BB%B6%E5%B7%A5%E7%A8%8B/00%20%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1/%E5%B8%B8%E8%A7%81%E6%9E%B6%E6%9E%84%E6%A8%A1%E5%BC%8F/">
										常见架构模式
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										01 软件工程
									</a>
									
							<ul>
								<li class="file">
									<a href="/2020/07/27/01%20%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E4%B8%8E%E8%BD%AF%E4%BB%B6%E5%B7%A5%E7%A8%8B/01%20%E8%BD%AF%E4%BB%B6%E5%B7%A5%E7%A8%8B/UML%E7%B1%BB%E5%9B%BE%E5%9B%BE%E7%A4%BA%E6%A0%B7%E4%BE%8B/">
										UML类图图示样例
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2020/07/27/01%20%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E4%B8%8E%E8%BD%AF%E4%BB%B6%E5%B7%A5%E7%A8%8B/01%20%E8%BD%AF%E4%BB%B6%E5%B7%A5%E7%A8%8B/%E6%97%B6%E5%BA%8F%E5%9B%BE%E3%80%81%E6%B4%BB%E5%8A%A8%E5%9B%BE%E3%80%81%E7%8A%B6%E6%80%81%E5%9B%BE%E3%80%81%E5%8D%8F%E4%BD%9C%E5%9B%BE%E7%9A%84%E5%8C%BA%E5%88%AB/">
										时序图、活动图、状态图、协作图的区别
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										02 设计模式
									</a>
									
							<ul>
								<li class="file">
									<a href="/2020/08/02/01%20%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E4%B8%8E%E8%BD%AF%E4%BB%B6%E5%B7%A5%E7%A8%8B/02%20%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/00%20%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E7%9A%84%E5%85%AD%E5%A4%A7%E5%8E%9F%E5%88%99/">
										00 设计模式的六大原则
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										01 创建型
									</a>
									
							<ul>
								<li class="file">
									<a href="/2020/08/01/01%20%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E4%B8%8E%E8%BD%AF%E4%BB%B6%E5%B7%A5%E7%A8%8B/02%20%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/01%20%E5%88%9B%E5%BB%BA%E5%9E%8B/01%20Abstract%20Factory(%E6%8A%BD%E8%B1%A1%E5%B7%A5%E5%8E%82)/">
										01 Abstract Factory(抽象工厂)
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2020/08/02/01%20%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E4%B8%8E%E8%BD%AF%E4%BB%B6%E5%B7%A5%E7%A8%8B/02%20%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/01%20%E5%88%9B%E5%BB%BA%E5%9E%8B/02%20Builder%20(%E7%94%9F%E6%88%90%E5%99%A8)/">
										02 Builder (生成器)
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										02 结构型
									</a>
									
							<ul>
								<li class="file">
									<a href="/2020/07/27/01%20%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E4%B8%8E%E8%BD%AF%E4%BB%B6%E5%B7%A5%E7%A8%8B/02%20%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/02%20%E7%BB%93%E6%9E%84%E5%9E%8B/01%20Adapter---%E9%80%82%E9%85%8D%E5%99%A8%E6%A8%A1%E5%BC%8F/">
										01 Adapter---适配器模式
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										03 行为型
									</a>
									
							<ul>
								<li class="file">
									<a href="/2020/08/01/01%20%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E4%B8%8E%E8%BD%AF%E4%BB%B6%E5%B7%A5%E7%A8%8B/02%20%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/03%20%E8%A1%8C%E4%B8%BA%E5%9E%8B/09%20Strategy%20(%E7%AD%96%E7%95%A5)/">
										09 Strategy (策略)
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
								</li>
								
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										02 DevOps
									</a>
									
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										01 程序运维
									</a>
									
							<ul>
								<li class="file">
									<a href="/2020/07/26/02%20DevOps/01%20%E7%A8%8B%E5%BA%8F%E8%BF%90%E7%BB%B4/00%20%E5%AE%9A%E4%BD%8Dcpu%20100_p%E7%9A%84%E6%96%B9%E6%B3%95/">
										00 定位cpu 100_p的方法
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2020/08/13/02%20DevOps/01%20%E7%A8%8B%E5%BA%8F%E8%BF%90%E7%BB%B4/01%20VIRT%E4%B8%8ERES%E5%8D%A0%E7%94%A8%E5%88%86%E6%9E%90/">
										01 VIRT与RES占用分析
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2020/08/14/02%20DevOps/01%20%E7%A8%8B%E5%BA%8F%E8%BF%90%E7%BB%B4/02%20%5B%E7%99%BE%E5%BA%A6%E5%88%86%E4%BA%AB%5D%E9%A2%91%E7%B9%81%E5%88%86%E9%85%8D%E9%87%8A%E6%94%BE%E5%86%85%E5%AD%98%E5%AF%BC%E8%87%B4%E7%9A%84%E6%80%A7%E8%83%BD%E9%97%AE%E9%A2%98%E5%88%86%E6%9E%90/">
										02 [百度分享]频繁分配释放内存导致的性能问题分析
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										02 常用软件
									</a>
									
							<ul>
								<li class="file">
									<a href="/2020/07/27/02%20DevOps/02%20%E5%B8%B8%E7%94%A8%E8%BD%AF%E4%BB%B6/00%20%E5%B8%B8%E7%94%A8git%E5%91%BD%E4%BB%A4/">
										00 常用git命令
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2020/07/30/02%20DevOps/02%20%E5%B8%B8%E7%94%A8%E8%BD%AF%E4%BB%B6/01%20%E5%BC%80%E5%8F%91%E6%9C%BA%E9%83%A8%E7%BD%B2/">
										01 开发机部署
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2020/07/30/02%20DevOps/02%20%E5%B8%B8%E7%94%A8%E8%BD%AF%E4%BB%B6/02%20%E5%A4%9A%E7%89%88%E6%9C%ACgcc%E9%83%A8%E7%BD%B2/">
										02 多版本gcc部署
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2020/07/30/02%20DevOps/02%20%E5%B8%B8%E7%94%A8%E8%BD%AF%E4%BB%B6/03%20vimrc%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6/">
										03 vimrc配置文件
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2020/07/31/02%20DevOps/02%20%E5%B8%B8%E7%94%A8%E8%BD%AF%E4%BB%B6/04%20goreplay%20%E5%BC%95%E6%B5%81%E6%B5%8B%E8%AF%95%E5%B7%A5%E5%85%B7/">
										04 goreplay 引流测试工具
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2014/08/01/02%20DevOps/02%20%E5%B8%B8%E7%94%A8%E8%BD%AF%E4%BB%B6/05%20scons%E5%AE%9E%E7%94%A8%E8%AF%B4%E6%98%8E/">
										05 scons实用说明
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2012/03/20/02%20DevOps/02%20%E5%B8%B8%E7%94%A8%E8%BD%AF%E4%BB%B6/06%20ssh%E8%B7%B3%E8%BD%AC%E6%97%A0%E5%AF%86%E7%A0%81%E7%99%BB%E5%BD%95%E6%88%96%E6%89%A7%E8%A1%8C%E5%91%BD%E4%BB%A4/">
										06 ssh跳转无密码登录或执行命令
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2018/05/03/02%20DevOps/02%20%E5%B8%B8%E7%94%A8%E8%BD%AF%E4%BB%B6/07%20%E6%9C%AC%E5%9C%B0%E6%96%87%E4%BB%B6%E6%98%A0%E5%B0%84%E4%B8%BA%E7%A3%81%E7%9B%98/">
										07 本地文件映射为磁盘
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2020/08/27/02%20DevOps/02%20%E5%B8%B8%E7%94%A8%E8%BD%AF%E4%BB%B6/08%20Python%20%E5%86%85%E7%BD%AE%E7%9A%84SimpleHTTPServer%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/">
										08 Python 内置的SimpleHTTPServer使用指南
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2020/11/12/02%20DevOps/02%20%E5%B8%B8%E7%94%A8%E8%BD%AF%E4%BB%B6/09%20%E7%9B%91%E6%8E%A7%E8%BF%9B%E7%A8%8B%E7%9A%84%E5%8F%A5%E6%9F%84%E5%8F%8A%E5%90%AF%E5%8A%A8%E6%97%B6%E9%97%B4/">
										09 监控进程的句柄及启动时间
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2020/12/04/02%20DevOps/02%20%E5%B8%B8%E7%94%A8%E8%BD%AF%E4%BB%B6/10%20vim%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%E5%8F%8A%E5%BF%AB%E6%8D%B7%E9%94%AE/">
										10 vim常用命令及快捷键
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2021/02/24/02%20DevOps/02%20%E5%B8%B8%E7%94%A8%E8%BD%AF%E4%BB%B6/11%20makefile%E5%8F%8A%E7%BC%96%E8%AF%91%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86%E6%B1%87%E6%80%BB/">
										11 makefile及编译相关知识汇总
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2021/03/24/02%20DevOps/02%20%E5%B8%B8%E7%94%A8%E8%BD%AF%E4%BB%B6/12%20doxygen%E4%BD%BF%E7%94%A8%E8%AF%B4%E6%98%8E/">
										12 doxygen使用说明
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										03 工具参考
									</a>
									
							<ul>
								<li class="file">
									<a href="/2020/08/20/02%20DevOps/03%20%E5%B7%A5%E5%85%B7%E5%8F%82%E8%80%83/00%20objdump%20%E4%BA%8C%E8%BF%9B%E5%88%B6%E6%96%87%E4%BB%B6%E5%88%86%E6%9E%90/">
										00 objdump 二进制文件分析
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2020/08/20/02%20DevOps/03%20%E5%B7%A5%E5%85%B7%E5%8F%82%E8%80%83/01%20lsof%20%E4%B8%80%E5%88%87%E7%9A%86%E6%96%87%E4%BB%B6/">
										01 lsof 一切皆文件
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2020/08/20/02%20DevOps/03%20%E5%B7%A5%E5%85%B7%E5%8F%82%E8%80%83/02%20strace%20%E8%B7%9F%E8%B8%AA%E8%BF%9B%E7%A8%8B%E4%B8%AD%E7%9A%84%E7%B3%BB%E7%BB%9F%E8%B0%83%E7%94%A8/">
										02 strace 跟踪进程中的系统调用
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2020/08/20/02%20DevOps/03%20%E5%B7%A5%E5%85%B7%E5%8F%82%E8%80%83/03%20pstack%20%E8%B7%9F%E8%B8%AA%E8%BF%9B%E7%A8%8B%E6%A0%88/">
										03 pstack 跟踪进程栈
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										03 开发
									</a>
									
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										00 算法与数据结构
									</a>
									
							<ul>
								<li class="file">
									<a href="/2014/08/01/03%20%E5%BC%80%E5%8F%91/00%20%E7%AE%97%E6%B3%95%E4%B8%8E%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/01%20(%E8%BD%AC%E8%BD%BD)%E4%B8%80%E8%87%B4%E6%80%A7hash%E7%AE%97%E6%B3%95(consistent%20hashing)/">
										01 (转载)一致性hash算法(consistent hashing)
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2020/07/27/03%20%E5%BC%80%E5%8F%91/00%20%E7%AE%97%E6%B3%95%E4%B8%8E%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/02%20MD5%E7%AE%97%E6%B3%95%E5%8E%9F%E7%90%86/">
										02 MD5算法原理
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2020/08/15/03%20%E5%BC%80%E5%8F%91/00%20%E7%AE%97%E6%B3%95%E4%B8%8E%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/03%20%E4%BC%B8%E5%B1%95%E6%A0%91(splay)/">
										03 伸展树(splay)
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2021/05/10/03%20%E5%BC%80%E5%8F%91/00%20%E7%AE%97%E6%B3%95%E4%B8%8E%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/04%20%E4%BA%8C%E5%8F%89%E6%A0%91%20AVL%E6%A0%91%20B%E6%A0%91%E7%AD%89%E7%AE%97%E6%B3%95%E6%A0%91%E4%BB%8B%E7%BB%8D/">
										04 二叉树 AVL树 B树等算法树介绍
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										01 C&C++
									</a>
									
							<ul>
								<li class="file">
									<a href="/2020/08/16/03%20%E5%BC%80%E5%8F%91/01%20C&C++/00%20C++%20%E5%86%85%E5%AD%98%E5%88%86%E9%85%8D(new%EF%BC%8Coperator%20new)%E8%AF%A6%E8%A7%A3/">
										00 C++ 内存分配(new，operator new)详解
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2020/08/03/03%20%E5%BC%80%E5%8F%91/01%20C&C++/01%20getopt%E4%B8%8Egetopt_long%E4%BD%BF%E7%94%A8/">
										01 getopt与getopt_long使用
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2020/07/26/03%20%E5%BC%80%E5%8F%91/01%20C&C++/02%20%E5%A4%A7%E7%AB%AF-%E5%B0%8F%E7%AB%AF%E5%AF%B9%E9%BD%90%E5%88%A4%E5%AE%9A%E5%87%BD%E6%95%B0/">
										02 大端-小端对齐判定函数
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2020/08/28/03%20%E5%BC%80%E5%8F%91/01%20C&C++/03%20Linux%E4%B8%AD%E7%BA%BF%E7%A8%8B%E4%B8%8ECPU%E6%A0%B8%E7%9A%84%E7%BB%91%E5%AE%9A/">
										03 Linux中线程与CPU核的绑定
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2020/08/29/03%20%E5%BC%80%E5%8F%91/01%20C&C++/04%20typedef%20%E7%B2%BE%E9%AB%93/">
										04 typedef 精髓
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2020/11/17/03%20%E5%BC%80%E5%8F%91/01%20C&C++/05%20%E6%97%B6%E9%97%B4/">
										05 时间
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2020/11/20/03%20%E5%BC%80%E5%8F%91/01%20C&C++/06%20%E8%99%9A%E7%BB%A7%E6%89%BF/">
										06 虚继承
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2020/12/08/03%20%E5%BC%80%E5%8F%91/01%20C&C++/07%20%E5%AE%8F%E5%AE%9A%E4%B9%89define%E7%9A%84%E5%A5%87%E6%8A%80%E6%B7%AB%E5%B7%A7/">
										07 宏定义define的奇技淫巧
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2021/01/13/03%20%E5%BC%80%E5%8F%91/01%20C&C++/08%20%E5%90%84%E7%B1%BBconst%20%E6%8C%87%E9%92%88%E7%9A%84%E5%8C%BA%E5%88%AB/">
										08 各类const 指针的区别
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2021/02/22/03%20%E5%BC%80%E5%8F%91/01%20C&C++/09%20Linux%E4%B8%ADerrno%E8%AF%B4%E6%98%8E/">
										09 Linux中errno说明
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2021/05/17/03%20%E5%BC%80%E5%8F%91/01%20C&C++/10%20%E6%8C%87%E9%92%88/">
										10 指针
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2021/05/17/03%20%E5%BC%80%E5%8F%91/01%20C&C++/10%20%E6%8C%87%E9%92%88%E7%B2%BE%E9%AB%93/">
										10 指针精髓
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										02 Rust
									</a>
									
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										00 fun_code
									</a>
									
							<ul>
								<li class="file">
									<a href="/2020/07/31/03%20%E5%BC%80%E5%8F%91/02%20Rust/00%20fun_code/rust%20%E5%AE%9E%E7%8E%B0%E5%87%BD%E6%95%B0%E9%87%8D%E8%BD%BD/">
										rust 实现函数重载
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2020/07/31/03%20%E5%BC%80%E5%8F%91/02%20Rust/00%20fun_code/rust%20%E8%8E%B7%E5%8F%96%E5%BD%93%E5%89%8D%E7%9A%84%E6%97%B6%E9%97%B4%E6%88%B3/">
										rust 获取当前的时间戳
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2020/07/31/03%20%E5%BC%80%E5%8F%91/02%20Rust/00%20fun_code/vec%E5%90%88%E5%B9%B6%E6%95%B0%E6%8D%AE%E6%97%B6%E9%98%B2%E6%AD%A2%E5%87%BA%E7%8E%B0%E6%8B%B7%E8%B4%9D%E7%9A%84%E6%96%B9%E6%B3%95/">
										vec合并数据时防止出现拷贝的方法
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2020/07/31/03%20%E5%BC%80%E5%8F%91/02%20Rust/00%20fun_code/%E5%90%8C%E4%B8%80%E4%B8%AAcrate%E5%86%85%E4%B8%8D%E5%90%8Clib%E6%88%96%E7%A8%8B%E5%BA%8F%E9%97%B4%E7%9A%84%E5%BC%95%E7%94%A8/">
										同一个crate内不同lib或程序间的引用
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2020/07/31/03%20%E5%BC%80%E5%8F%91/02%20Rust/00%20fun_code/%E6%89%93%E5%8D%B0%E5%8F%82%E6%95%B0%E7%B1%BB%E5%9E%8B/">
										打印参数类型
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2020/07/31/03%20%E5%BC%80%E5%8F%91/02%20Rust/00%20fun_code/%E6%89%93%E5%8D%B0%E5%8F%98%E9%87%8F%E5%9C%B0%E5%9D%80/">
										打印变量地址
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2020/07/31/03%20%E5%BC%80%E5%8F%91/02%20Rust/00%20fun_code/%E6%9C%89%E8%B6%A3%E7%9A%84%E6%89%80%E6%9C%89%E6%9D%83%E9%97%AE%E9%A2%98%E9%97%AE%E9%A2%98/">
										有趣的所有权问题问题
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2020/07/31/03%20%E5%BC%80%E5%8F%91/02%20Rust/rust%20%E5%AE%8F/">
										rust 宏
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2020/07/25/03%20%E5%BC%80%E5%8F%91/02%20Rust/rust-%E4%B8%BA%E4%BB%80%E4%B9%88%E4%B8%8D%E8%83%BD%E5%B0%86u32%E8%BD%AC%E6%8D%A2%E4%B8%BAchar%EF%BC%9F/">
										rust-为什么不能将u32转换为char？
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2020/07/31/03%20%E5%BC%80%E5%8F%91/02%20Rust/%E4%B8%BA%E4%BB%80%E4%B9%88%E5%87%BD%E6%95%B0%E5%8F%82%E6%95%B0%E6%8F%90%E7%A4%BA%E3%80%8Aremove%20this%20mut%E3%80%8B/">
										为什么函数参数提示《remove this mut》
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										03 Shell
									</a>
									
							<ul>
								<li class="file">
									<a href="/2020/07/30/03%20%E5%BC%80%E5%8F%91/03%20Shell/awk%E5%B8%B8%E7%94%A8%E6%96%B9%E6%B3%95/">
										awk常用方法
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2020/07/27/03%20%E5%BC%80%E5%8F%91/03%20Shell/%E5%88%A9%E7%94%A8Shell%E5%91%BD%E4%BB%A4%E8%8E%B7%E5%8F%96IP%E5%9C%B0%E5%9D%80/">
										利用Shell命令获取IP地址
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2018/11/30/03%20%E5%BC%80%E5%8F%91/03%20Shell/%E7%9B%91%E6%8E%A7%E6%8C%87%E5%AE%9A%E8%BF%9B%E7%A8%8B%E7%9A%84%E5%8F%A5%E6%9F%84%E4%BF%A1%E6%81%AF/">
										监控指定进程的句柄信息
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										04 网络
									</a>
									
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										00 DNS
									</a>
									
							<ul>
								<li class="file">
									<a href="/2020/08/26/04%20%E7%BD%91%E7%BB%9C/00%20DNS/00%20DNS%E5%8D%8F%E8%AE%AE/">
										00 DNS协议
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2020/08/26/04%20%E7%BD%91%E7%BB%9C/00%20DNS/01%20DNS%E4%B8%ADRR%E4%BB%8B%E7%BB%8D/">
										01 DNS中RR介绍
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2020/07/27/04%20%E7%BD%91%E7%BB%9C/hello-world/">
										hello-world
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										05 分布式及数据库
									</a>
									
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										00 传统数据库
									</a>
									
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										00 mysql
									</a>
									
							<ul>
								<li class="file">
									<a href="/2020/07/27/05%20%E5%88%86%E5%B8%83%E5%BC%8F%E5%8F%8A%E6%95%B0%E6%8D%AE%E5%BA%93/00%20%E4%BC%A0%E7%BB%9F%E6%95%B0%E6%8D%AE%E5%BA%93/00%20mysql/mysql%20%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/">
										mysql 常用命令
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										01 sqlite
									</a>
									
							<ul>
								<li class="file">
									<a href="/2020/07/26/05%20%E5%88%86%E5%B8%83%E5%BC%8F%E5%8F%8A%E6%95%B0%E6%8D%AE%E5%BA%93/00%20%E4%BC%A0%E7%BB%9F%E6%95%B0%E6%8D%AE%E5%BA%93/01%20sqlite/sqlite3%20%E5%AE%A2%E6%88%B7%E7%AB%AF%E6%93%8D%E4%BD%9C%E5%91%BD%E4%BB%A4/">
										sqlite3 客户端操作命令
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										02 Pika
									</a>
									
							<ul>
								<li class="file">
									<a href="/2020/07/29/05%20%E5%88%86%E5%B8%83%E5%BC%8F%E5%8F%8A%E6%95%B0%E6%8D%AE%E5%BA%93/02%20Pika/pika%20%E8%BF%90%E7%BB%B4%E5%91%BD%E4%BB%A4/">
										pika 运维命令
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										03 squid
									</a>
									
							<ul>
								<li class="file">
									<a href="/2020/08/16/05%20%E5%88%86%E5%B8%83%E5%BC%8F%E5%8F%8A%E6%95%B0%E6%8D%AE%E5%BA%93/03%20squid/00%20squid%20%E5%86%85%E5%AD%98%E6%B1%A0%E7%A0%94%E7%A9%B6/">
										00 squid 内存池研究
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2020/08/22/05%20%E5%88%86%E5%B8%83%E5%BC%8F%E5%8F%8A%E6%95%B0%E6%8D%AE%E5%BA%93/03%20squid/01%20suqid%20%E5%AD%98%E5%82%A8%E6%A8%A1%E5%9E%8B%E7%A0%94%E7%A9%B6/">
										01 suqid 存储模型研究
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										04 scylladb&&cassandra
									</a>
									
							<ul>
								<li class="file">
									<a href="/2020/08/19/05%20%E5%88%86%E5%B8%83%E5%BC%8F%E5%8F%8A%E6%95%B0%E6%8D%AE%E5%BA%93/04%20scylladb&&cassandra/00%20scylladb/">
										00 scylladb
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2020/08/31/05%20%E5%88%86%E5%B8%83%E5%BC%8F%E5%8F%8A%E6%95%B0%E6%8D%AE%E5%BA%93/04%20scylladb&&cassandra/01%20scylladb%20%E9%A9%B1%E5%8A%A8%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95/">
										01 scylladb 驱动使用方法
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										05 kafka
									</a>
									
							<ul>
								<li class="file">
									<a href="/2020/08/31/05%20%E5%88%86%E5%B8%83%E5%BC%8F%E5%8F%8A%E6%95%B0%E6%8D%AE%E5%BA%93/05%20kafka/00%20kafka%E5%9F%BA%E7%A1%80/">
										00 kafka基础
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2020/08/31/05%20%E5%88%86%E5%B8%83%E5%BC%8F%E5%8F%8A%E6%95%B0%E6%8D%AE%E5%BA%93/05%20kafka/01%20kafka%E9%A9%B1%E5%8A%A8/">
										01 kafka驱动
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										06 rocksdb
									</a>
									
							<ul>
								<li class="file active">
									<a href="/2020/09/22/05%20%E5%88%86%E5%B8%83%E5%BC%8F%E5%8F%8A%E6%95%B0%E6%8D%AE%E5%BA%93/06%20rocksdb/00%20rocksdb_release_log/">
										00 rocksdb_release_log
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										06 杂项
									</a>
									
							<ul>
								<li class="file">
									<a href="/2020/08/19/06%20%E6%9D%82%E9%A1%B9/00%20%E7%A0%94%E5%8F%91%E9%A1%B9%E7%9B%AE%E4%BA%A4%E6%8E%A5%E5%86%85%E5%AE%B9/">
										00 研发项目交接内容
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
		</div>
	</div>
</div>

	<!-- 引入正文 -->
	<div id="content">
		<h1 id="article-title">

	00 rocksdb_release_log
</h1>
<div class="article-meta">
	
	<span>Fly542</span>
	<span>2020-09-22 20:30:15</span>
    
		<div id="article-categories">
            
		</div>
    
</div>

<div id="article-content">
	<p>以下内容从官方整理下rockdb的release log 信息，便于统一查看</p>
<h2 id="6-11-4-2020-07-15"><a href="#6-11-4-2020-07-15" class="headerlink" title="6.11.4 (2020-07-15)"></a>6.11.4 (2020-07-15)</h2><h3 id="Bug-Fixes"><a href="#Bug-Fixes" class="headerlink" title="Bug Fixes"></a>Bug Fixes</h3><ul>
<li>Make compaction report InternalKey corruption while iterating over the input.</li>
</ul>
<h2 id="6-11-3-2020-07-09"><a href="#6-11-3-2020-07-09" class="headerlink" title="6.11.3 (2020-07-09)"></a>6.11.3 (2020-07-09)</h2><h3 id="Bug-Fixes-1"><a href="#Bug-Fixes-1" class="headerlink" title="Bug Fixes"></a>Bug Fixes</h3><ul>
<li>Fix a bug when index_type == kTwoLevelIndexSearch in PartitionedIndexBuilder to update FlushPolicy to point to internal key partitioner when it changes from user-key mode to internal-key mode in index partition.</li>
<li>Disable file deletion after MANIFEST write/sync failure until db re-open or Resume() so that subsequent re-open will not see MANIFEST referencing deleted SSTs.</li>
</ul>
<h2 id="6-11-1-2020-06-23"><a href="#6-11-1-2020-06-23" class="headerlink" title="6.11.1 (2020-06-23)"></a>6.11.1 (2020-06-23)</h2><h3 id="Bug-Fixes-2"><a href="#Bug-Fixes-2" class="headerlink" title="Bug Fixes"></a>Bug Fixes</h3><ul>
<li>Best-efforts recovery ignores CURRENT file completely. If CURRENT file is missing during recovery, best-efforts recovery still proceeds with MANIFEST file(s).</li>
<li>In best-efforts recovery, an error that is not Corruption or IOError::kNotFound or IOError::kPathNotFound will be overwritten silently. Fix this by checking all non-ok cases and return early.</li>
<li>Compressed block cache was automatically disabled with read-only DBs by mistake. Now it is fixed: compressed block cache will be in effective with read-only DB too.</li>
<li>Fail recovery and report once hitting a physical log record checksum mismatch, while reading MANIFEST. RocksDB should not continue processing the MANIFEST any further.</li>
<li>Fix a bug of wrong iterator result if another thread finishes an update and a DB flush between two statement.</li>
</ul>
<h3 id="Public-API-Change"><a href="#Public-API-Change" class="headerlink" title="Public API Change"></a>Public API Change</h3><ul>
<li><code>DB::OpenForReadOnly()</code> now returns <code>Status::NotFound</code> when the specified DB directory does not exist. Previously the error returned depended on the underlying <code>Env</code>.</li>
</ul>
<h2 id="6-11-2020-06-12"><a href="#6-11-2020-06-12" class="headerlink" title="6.11 (2020-06-12)"></a>6.11 (2020-06-12)</h2><h3 id="Bug-Fixes-3"><a href="#Bug-Fixes-3" class="headerlink" title="Bug Fixes"></a>Bug Fixes</h3><ul>
<li>Fix consistency checking error swallowing in some cases when options.force_consistency_checks = true.</li>
<li>Fix possible false NotFound status from batched MultiGet using index type kHashSearch.</li>
<li>Fix corruption caused by enabling delete triggered compaction (NewCompactOnDeletionCollectorFactory) in universal compaction mode, along with parallel compactions. The bug can result in two parallel compactions picking the same input files, resulting in the DB resurrecting older and deleted versions of some keys.</li>
<li>Fix a use-after-free bug in best-efforts recovery. column_family_memtables_ needs to point to valid ColumnFamilySet.</li>
<li>Let best-efforts recovery ignore corrupted files during table loading.</li>
<li>Fix corrupt key read from ingested file when iterator direction switches from reverse to forward at a key that is a prefix of another key in the same file. It is only possible in files with a non-zero global seqno.</li>
<li>Fix abnormally large estimate from GetApproximateSizes when a range starts near the end of one SST file and near the beginning of another. Now GetApproximateSizes consistently and fairly includes the size of SST metadata in addition to data blocks, attributing metadata proportionally among the data blocks based on their size.</li>
<li>Fix potential file descriptor leakage in PosixEnv’s IsDirectory() and NewRandomAccessFile().</li>
<li>Fix false negative from the VerifyChecksum() API when there is a checksum mismatch in an index partition block in a BlockBasedTable format table file (index_type is kTwoLevelIndexSearch).</li>
<li>Fix sst_dump to return non-zero exit code if the specified file is not a recognized SST file or fails requested checks.</li>
<li>Fix incorrect results from batched MultiGet for duplicate keys, when the duplicate key matches the largest key of an SST file and the value type for the key in the file is a merge value.</li>
</ul>
<h3 id="Public-API-Change-1"><a href="#Public-API-Change-1" class="headerlink" title="Public API Change"></a>Public API Change</h3><ul>
<li>Flush(…, column_family) may return Status::ColumnFamilyDropped() instead of Status::InvalidArgument() if column_family is dropped while processing the flush request.</li>
<li>BlobDB now explicitly disallows using the default column family’s storage directories as blob directory.</li>
<li>DeleteRange now returns <code>Status::InvalidArgument</code> if the range’s end key comes before its start key according to the user comparator. Previously the behavior was undefined.</li>
<li>ldb now uses options.force_consistency_checks = true by default and “–disable_consistency_checks” is added to disable it.</li>
<li>DB::OpenForReadOnly no longer creates files or directories if the named DB does not exist, unless create_if_missing is set to true.</li>
<li>The consistency checks that validate LSM state changes (table file additions/deletions during flushes and compactions) are now stricter, more efficient, and no longer optional, i.e. they are performed even if <code>force_consistency_checks</code> is <code>false</code>.</li>
<li>Disable delete triggered compaction (NewCompactOnDeletionCollectorFactory) in universal compaction mode and num_levels = 1 in order to avoid a corruption bug.</li>
<li><code>pin_l0_filter_and_index_blocks_in_cache</code> no longer applies to L0 files larger than <code>1.5 * write_buffer_size</code> to give more predictable memory usage. Such L0 files may exist due to intra-L0 compaction, external file ingestion, or user dynamically changing <code>write_buffer_size</code> (note, however, that files that are already pinned will continue being pinned, even after such a dynamic change).</li>
<li>In point-in-time wal recovery mode, fail database recovery in case of IOError while reading the WAL to avoid data loss.</li>
</ul>
<h3 id="New-Features"><a href="#New-Features" class="headerlink" title="New Features"></a>New Features</h3><ul>
<li>sst_dump to add a new –readahead_size argument. Users can specify read size when scanning the data. Sst_dump also tries to prefetch tail part of the SST files so usually some number of I/Os are saved there too.</li>
<li>Generate file checksum in SstFileWriter if Options.file_checksum_gen_factory is set. The checksum and checksum function name are stored in ExternalSstFileInfo after the sst file write is finished.</li>
<li>Add a value_size_soft_limit in read options which limits the cumulative value size of keys read in batches in MultiGet. Once the cumulative value size of found keys exceeds read_options.value_size_soft_limit, all the remaining keys are returned with status Abort without further finding their values. By default the value_size_soft_limit is std::numeric_limits<uint64_t>::max().</li>
<li>Enable SST file ingestion with file checksum information when calling IngestExternalFiles(const std::vector&amp; args). Added files_checksums and files_checksum_func_names to IngestExternalFileArg such that user can ingest the sst files with their file checksum information. Added verify_file_checksum to IngestExternalFileOptions (default is True). To be backward compatible, if DB does not enable file checksum or user does not provide checksum information (vectors of files_checksums and files_checksum_func_names are both empty), verification of file checksum is always sucessful. If DB enables file checksum, DB will always generate the checksum for each ingested SST file during Prepare stage of ingestion and store the checksum in Manifest, unless verify_file_checksum is False and checksum information is provided by the application. In this case, we only verify the checksum function name and directly store the ingested checksum in Manifest. If verify_file_checksum is set to True, DB will verify the ingested checksum and function name with the genrated ones. Any mismatch will fail the ingestion. Note that, if IngestExternalFileOptions::write_global_seqno is True, the seqno will be changed in the ingested file. Therefore, the checksum of the file will be changed. In this case, a new checksum will be generated after the seqno is updated and be stored in the Manifest.</li>
</ul>
<h3 id="Performance-Improvements"><a href="#Performance-Improvements" class="headerlink" title="Performance Improvements"></a>Performance Improvements</h3><ul>
<li>Eliminate redundant key comparisons during random access in block-based tables.</li>
</ul>
<h2 id="6-10-2-2020-06-05"><a href="#6-10-2-2020-06-05" class="headerlink" title="6.10.2 (2020-06-05)"></a>6.10.2 (2020-06-05)</h2><p> Bug fix</p>
<ul>
<li>Fix false negative from the VerifyChecksum() API when there is a checksum mismatch in an index partition block in a BlockBasedTable format table file (index_type is kTwoLevelIndexSearch).</li>
</ul>
<h2 id="6-10-1-2020-05-27"><a href="#6-10-1-2020-05-27" class="headerlink" title="6.10.1 (2020-05-27)"></a>6.10.1 (2020-05-27)</h2><h3 id="Bug-fix"><a href="#Bug-fix" class="headerlink" title="Bug fix"></a>Bug fix</h3><ul>
<li>Remove “u’’” in TARGETS file.</li>
<li>Fix db_stress_lib target in buck.</li>
</ul>
<h2 id="6-10-2020-05-02"><a href="#6-10-2020-05-02" class="headerlink" title="6.10 (2020-05-02)"></a>6.10 (2020-05-02)</h2><h3 id="Behavior-Changes"><a href="#Behavior-Changes" class="headerlink" title="Behavior Changes"></a>Behavior Changes</h3><ul>
<li>Disable delete triggered compaction (NewCompactOnDeletionCollectorFactory) in universal compaction mode and num_levels = 1 in order to avoid a corruption bug.</li>
</ul>
<h3 id="Bug-Fixes-4"><a href="#Bug-Fixes-4" class="headerlink" title="Bug Fixes"></a>Bug Fixes</h3><ul>
<li>Fix wrong result being read from ingested file. May happen when a key in the file happen to be prefix of another key also in the file. The issue can further cause more data corruption. The issue exists with rocksdb &gt;= 5.0.0 since DB::IngestExternalFile() was introduced.</li>
<li>Finish implementation of BlockBasedTableOptions::IndexType::kBinarySearchWithFirstKey. It’s now ready for use. Significantly reduces read amplification in some setups, especially for iterator seeks.</li>
<li>Fix a bug by updating CURRENT file so that it points to the correct MANIFEST file after best-efforts recovery.</li>
<li>Fixed a bug where ColumnFamilyHandle objects were not cleaned up in case an error happened during BlobDB’s open after the base DB had been opened.</li>
<li>Fix a potential undefined behavior caused by trying to dereference nullable pointer (timestamp argument) in DB::MultiGet.</li>
<li>Fix a bug caused by not including user timestamp in MultiGet LookupKey construction. This can lead to wrong query result since the trailing bytes of a user key, if not shorter than timestamp, will be mistaken for user timestamp.</li>
<li>Fix a bug caused by using wrong compare function when sorting the input keys of MultiGet with timestamps.<br>Upgraded version of bzip library (1.0.6 -&gt; 1.0.8) used with RocksJava to address potential vulnerabilities if an attacker can manipulate compressed data saved and loaded by RocksDB (not normal). See issue <a href="https://github.com/facebook/rocksdb/issues/6703" target="_blank" rel="noopener">#6703</a>.</li>
<li>Fix consistency checking error swallowing in some cases when options.force_consistency_checks = true.</li>
<li>Fix possible false NotFound status from batched MultiGet using index type kHashSearch.</li>
<li>Fix corruption caused by enabling delete triggered compaction (NewCompactOnDeletionCollectorFactory) in universal compaction mode, along with parallel compactions. The bug can result in two parallel compactions picking the same input files, resulting in the DB resurrecting older and deleted versions of some keys.</li>
<li>Fix a use-after-free bug in best-efforts recovery. column_family_memtables_ needs to point to valid ColumnFamilySet.</li>
<li>Let best-efforts recovery ignore corrupted files during table loading.</li>
<li>Fix a bug when making options.bottommost_compression, options.compression_opts and options.bottommost_compression_opts dynamically changeable: the modified values are not written to option files or returned back to users when being queried.</li>
<li>Fix a bug where index key comparisons were unaccounted in PerfContext::user_key_comparison_count for lookups in files written with format_version &gt;= 3.</li>
<li>Fix many bloom.filter statistics not being updated in batch MultiGet.</li>
</ul>
<h3 id="Public-API-Change-2"><a href="#Public-API-Change-2" class="headerlink" title="Public API Change"></a>Public API Change</h3><ul>
<li>Add a ConfigOptions argument to the APIs dealing with converting options to and from strings and files. The ConfigOptions is meant to replace some of the options (such as input_strings_escaped and ignore_unknown_options) and allow for more parameters to be passed in the future without changing the function signature.</li>
<li>Add NewFileChecksumGenCrc32cFactory to the file checksum public API, such that the builtin Crc32c based file checksum generator factory can be used by applications.</li>
<li>Add IsDirectory to Env and FS to indicate if a path is a directory.<br>ldb now uses options.force_consistency_checks = true by default and “–disable_consistency_checks” is added to disable it.</li>
<li>Add ReadOptions::deadline to allow users to specify a deadline for MultiGet requests</li>
</ul>
<h3 id="New-Features-1"><a href="#New-Features-1" class="headerlink" title="New Features"></a>New Features</h3><ul>
<li>Added support for pipelined &amp; parallel compression optimization for BlockBasedTableBuilder. This optimization makes block building, block compression and block appending a pipeline, and uses multiple threads to accelerate block compression. Users can set CompressionOptions::parallel_threads greater than 1 to enable compression parallelism. This feature is experimental for now.</li>
<li>Provide an allocator for memkind to be used with block cache. This is to work with memory technologies (Intel DCPMM is one such technology currently available) that require different libraries for allocation and management (such as PMDK and memkind). The high capacities available make it possible to provision large caches (up to several TBs in size) beyond what is achievable with DRAM.</li>
<li>Option max_background_flushes can be set dynamically using DB::SetDBOptions().</li>
<li>Added functionality in sst_dump tool to check the compressed file size for different compression levels and print the time spent on compressing files with each compression type. Added arguments –compression_level_from and –compression_level_to to report size of all compression levels and one compression_type must be specified with it so that it will report compressed sizes of one compression type with different levels.</li>
<li>Added statistics for redundant insertions into block cache: rocksdb.block.cache.*add.redundant. (There is currently no coordination to ensure that only one thread loads a table block when many threads are trying to access that same table block.)</li>
</ul>
<h3 id="Performance-Improvements-1"><a href="#Performance-Improvements-1" class="headerlink" title="Performance Improvements"></a>Performance Improvements</h3><ul>
<li>Improve performance of batch MultiGet with partitioned filters, by sharing block cache lookups to applicable filter blocks.</li>
<li>Reduced memory copies when fetching and uncompressing compressed blocks from sst files.</li>
</ul>
<h2 id="6-8-1-2020-03-30"><a href="#6-8-1-2020-03-30" class="headerlink" title="6.8.1 (2020-03-30)"></a>6.8.1 (2020-03-30)</h2><h3 id="Behavior-changes"><a href="#Behavior-changes" class="headerlink" title="Behavior changes"></a>Behavior changes</h3><ul>
<li>Since RocksDB 6.8.0, ttl-based FIFO compaction can drop a file whose oldest key becomes older than options.ttl while others have not. This fix reverts this and makes ttl-based FIFO compaction use the file’s flush time as the criterion. This fix also requires that max_open_files = -1 and compaction_options_fifo.allow_compaction = false to function properly.</li>
</ul>
<h2 id="6-8-0-2020-02-24"><a href="#6-8-0-2020-02-24" class="headerlink" title="6.8.0 (2020-02-24)"></a>6.8.0 (2020-02-24)</h2><h3 id="Java-API-Changes"><a href="#Java-API-Changes" class="headerlink" title="Java API Changes"></a>Java API Changes</h3><ul>
<li>Major breaking changes to Java comparators, toward standardizing on ByteBuffer for performant, locale-neutral operations on keys (<a href="https://github.com/facebook/rocksdb/pull/6252" target="_blank" rel="noopener">#6252</a>).</li>
<li>Added overloads of common API methods using direct ByteBuffers for keys and values (<a href="https://github.com/facebook/rocksdb/pull/2283" target="_blank" rel="noopener">#2283</a>).</li>
</ul>
<h3 id="Bug-Fixes-5"><a href="#Bug-Fixes-5" class="headerlink" title="Bug Fixes"></a>Bug Fixes</h3><ul>
<li>Fix incorrect results while block-based table uses kHashSearch, together with Prev()/SeekForPrev().</li>
<li>Fix a bug that prevents opening a DB after two consecutive crash with TransactionDB, where the first crash recovers from a corrupted WAL with kPointInTimeRecovery but the second cannot.</li>
<li>Fixed issue <a href="https://github.com/facebook/rocksdb/issues/6316" target="_blank" rel="noopener">#6316</a> that can cause a corruption of the MANIFEST file in the middle when writing to it fails due to no disk space.</li>
<li>Add DBOptions::skip_checking_sst_file_sizes_on_db_open. It disables potentially expensive checking of all sst file sizes in DB::Open().</li>
<li>BlobDB now ignores trivially moved files when updating the mapping between blob files and SSTs. This should mitigate issue <a href="https://github.com/facebook/rocksdb/issues/6338" target="_blank" rel="noopener">#6338</a> where out of order flush/compaction notifications could trigger an assertion with the earlier code.</li>
<li>Batched MultiGet() ignores IO errors while reading data blocks, causing it to potentially continue looking for a key and returning stale results.</li>
<li><code>WriteBatchWithIndex::DeleteRange</code> returns <code>Status::NotSupported</code>. Previously it returned success even though reads on the batch did not account for range tombstones. The corresponding language bindings now cannot be used. In C, that includes <code>rocksdb_writebatch_wi_delete_range</code>, <code>rocksdb_writebatch_wi_delete_range_cf</code>, <code>rocksdb_writebatch_wi_delete_rangev</code>, and <code>rocksdb_writebatch_wi_delete_rangev_cf</code>. In Java, that includes <code>WriteBatchWithIndex::deleteRange</code>.</li>
<li>Assign new MANIFEST file number when caller tries to create a new MANIFEST by calling LogAndApply(…, new_descriptor_log=true). This bug can cause MANIFEST being overwritten during recovery if options.write_dbid_to_manifest = true and there are WAL file(s).</li>
</ul>
<h3 id="Performance-Improvements-2"><a href="#Performance-Improvements-2" class="headerlink" title="Performance Improvements"></a>Performance Improvements</h3><ul>
<li>Perfom readahead when reading from option files. Inside DB, options.log_readahead_size will be used as the readahead size. In other cases, a default 512KB is used.</li>
</ul>
<h3 id="Public-API-Change-3"><a href="#Public-API-Change-3" class="headerlink" title="Public API Change"></a>Public API Change</h3><ul>
<li>The BlobDB garbage collector now emits the statistics <code>BLOB_DB_GC_NUM_FILES</code> (number of blob files obsoleted during GC), <code>BLOB_DB_GC_NUM_NEW_FILES</code> (number of new blob files generated during GC), <code>BLOB_DB_GC_FAILURES</code> (number of failed GC passes), <code>BLOB_DB_GC_NUM_KEYS_RELOCATED</code> (number of blobs relocated during GC), and <code>BLOB_DB_GC_BYTES_RELOCATED</code> (total size of blobs relocated during GC). On the other hand, the following statistics, which are not relevant for the new GC implementation, are now deprecated: <code>BLOB_DB_GC_NUM_KEYS_OVERWRITTEN</code>, <code>BLOB_DB_GC_NUM_KEYS_EXPIRED</code>, <code>BLOB_DB_GC_BYTES_OVERWRITTEN</code>, <code>BLOB_DB_GC_BYTES_EXPIRED</code>, and <code>BLOB_DB_GC_MICROS</code>.</li>
<li>Disable recycle_log_file_num when an inconsistent recovery modes are requested: kPointInTimeRecovery and kAbsoluteConsistency</li>
</ul>
<h3 id="New-Features-2"><a href="#New-Features-2" class="headerlink" title="New Features"></a>New Features</h3><ul>
<li>Added the checksum for each SST file generated by Flush or Compaction. Added sst_file_checksum_func to Options such that user can plugin their own SST file checksum function via override the FileChecksumFunc class. If user does not set the sst_file_checksum_func, SST file checksum calculation will not be enabled. The checksum information inlcuding uint32_t checksum value and a checksum function name (string). The checksum information is stored in FileMetadata in version store and also logged to MANIFEST. A new tool is added to LDB such that user can dump out a list of file checksum information from MANIFEST (stored in an unordered_map).</li>
<li><code>db_bench</code> now supports <code>value_size_distribution_type</code>, <code>value_size_min</code>, <code>value_size_max</code> options for generating random variable sized value. Added <code>blob_db_compression_type</code> option for BlobDB to enable blob compression.</li>
<li>Replace RocksDB namespace “rocksdb” with flag “ROCKSDB_NAMESPACE” which if is not defined, defined as “rocksdb” in header file rocksdb_namespace.h.</li>
</ul>
<h2 id="6-7-3-2020-03-18"><a href="#6-7-3-2020-03-18" class="headerlink" title="6.7.3 (2020-03-18)"></a>6.7.3 (2020-03-18)</h2><h3 id="Bug-Fixes-6"><a href="#Bug-Fixes-6" class="headerlink" title="Bug Fixes"></a>Bug Fixes</h3><ul>
<li>Fix a data race that might cause crash when calling DB::GetCreationTimeOfOldestFile() by a small chance. The bug was introduced in 6.6 Release.</li>
</ul>
<h2 id="6-7-2-2020-02-24"><a href="#6-7-2-2020-02-24" class="headerlink" title="6.7.2 (2020-02-24)"></a>6.7.2 (2020-02-24)</h2><h3 id="Bug-Fixes-7"><a href="#Bug-Fixes-7" class="headerlink" title="Bug Fixes"></a>Bug Fixes</h3><ul>
<li>Fixed a bug of IO Uring partial result handling introduced in 6.7.0.</li>
</ul>
<h2 id="6-7-1-2020-02-13"><a href="#6-7-1-2020-02-13" class="headerlink" title="6.7.1 (2020-02-13)"></a>6.7.1 (2020-02-13)</h2><h3 id="Bug-Fixes-8"><a href="#Bug-Fixes-8" class="headerlink" title="Bug Fixes"></a>Bug Fixes</h3><ul>
<li>Fixed issue <a href="https://github.com/facebook/rocksdb/issues/6316" target="_blank" rel="noopener">#6316</a> that can cause a corruption of the MANIFEST file in the middle when writing to it fails due to no disk space.</li>
<li>Batched MultiGet() ignores IO errors while reading data blocks, causing it to potentially continue looking for a key and returning stale results.</li>
</ul>
<h2 id="6-7-0-2020-01-21"><a href="#6-7-0-2020-01-21" class="headerlink" title="6.7.0 (2020-01-21)"></a>6.7.0 (2020-01-21)</h2><h3 id="Public-API-Change-4"><a href="#Public-API-Change-4" class="headerlink" title="Public API Change"></a>Public API Change</h3><ul>
<li>Added a rocksdb::FileSystem class in include/rocksdb/file_system.h to encapsulate file creation/read/write operations, and an option DBOptions::file_system to allow a user to pass in an instance of rocksdb::FileSystem. If its a non-null value, this will take precendence over DBOptions::env for file operations. A new API rocksdb::FileSystem::Default() returns a platform default object. The DBOptions::env option and Env::Default() API will continue to be used for threading and other OS related functions, and where DBOptions::file_system is not specified, for file operations. For storage developers who are accustomed to rocksdb::Env, the interface in rocksdb::FileSystem is new and will probably undergo some changes as more storage systems are ported to it from rocksdb::Env. As of now, no env other than Posix has been ported to the new interface.</li>
<li>A new rocksdb::NewSstFileManager() API that allows the caller to pass in separate Env and FileSystem objects.</li>
<li>Changed Java API for RocksDB.keyMayExist functions to use Holder&lt;byte[]&gt; instead of StringBuilder, so that retrieved values need not decode to Strings.</li>
<li>A new <code>OptimisticTransactionDBOptions</code> Option that allows users to configure occ validation policy. The default policy changes from kValidateSerial to kValidateParallel to reduce mutex contention.</li>
</ul>
<h3 id="Bug-Fixes-9"><a href="#Bug-Fixes-9" class="headerlink" title="Bug Fixes"></a>Bug Fixes</h3><ul>
<li>Fix a bug that can cause unnecessary bg thread to be scheduled(<a href="https://github.com/facebook/rocksdb/pull/6104" target="_blank" rel="noopener">#6104</a>).</li>
<li>Fix crash caused by concurrent CF iterations and drops(<a href="https://github.com/facebook/rocksdb/pull/6147" target="_blank" rel="noopener">#6147</a>).</li>
<li>Fix a race condition for cfd-&gt;log_number_ between manifest switch and memtable switch (PR 6249) when number of column families is greater than 1.</li>
<li>Fix a bug on fractional cascading index when multiple files at the same level contain the same smallest user key, and those user keys are for merge operands. In this case, Get() the exact key may miss some merge operands.</li>
<li>Delcare kHashSearch index type feature-incompatible with index_block_restart_interval larger than 1.</li>
<li>Fixed an issue where the thread pools were not resized upon setting <code>max_background_jobs</code> dynamically through the <code>SetDBOptions</code> interface.</li>
<li>Fix a bug that can cause write threads to hang when a slowdown/stall happens and there is a mix of writers with WriteOptions::no_slowdown set/unset.</li>
<li>Fixed an issue where an incorrect “number of input records” value was used to compute the “records dropped” statistics for compactions.</li>
</ul>
<h3 id="New-Features-3"><a href="#New-Features-3" class="headerlink" title="New Features"></a>New Features</h3><ul>
<li>It is now possible to enable periodic compactions for the base DB when using BlobDB.</li>
<li>BlobDB now garbage collects non-TTL blobs when <code>enable_garbage_collection</code> is set to <code>true</code> in <code>BlobDBOptions</code>. Garbage collection is performed during compaction: any valid blobs located in the oldest N files (where N is the number of non-TTL blob files multiplied by the value of <code>BlobDBOptions::garbage_collection_cutoff</code>) encountered during compaction get relocated to new blob files, and old blob files are dropped once they are no longer needed. Note: we recommend enabling periodic compactions for the base DB when using this feature to deal with the case when some old blob files are kept alive by SSTs that otherwise do not get picked for compaction.</li>
<li><code>db_bench</code> now supports the <code>garbage_collection_cutoff</code> option for BlobDB.</li>
<li>MultiGet() can use IO Uring to parallelize read from the same SST file. This featuer is by default disabled. It can be enabled with environment variable ROCKSDB_USE_IO_URING.</li>
</ul>
<h2 id="6-6-4-2020-01-31"><a href="#6-6-4-2020-01-31" class="headerlink" title="6.6.4 (2020-01-31)"></a>6.6.4 (2020-01-31)</h2><h3 id="Bug-Fixes-10"><a href="#Bug-Fixes-10" class="headerlink" title="Bug Fixes"></a>Bug Fixes</h3><ul>
<li>Fixed issue <a href="https://github.com/facebook/rocksdb/issues/6316" target="_blank" rel="noopener">#6316</a> that can cause a corruption of the MANIFEST file in the middle when writing to it fails due to no disk space.</li>
</ul>
<h2 id="RocksDB-5-18-4"><a href="#RocksDB-5-18-4" class="headerlink" title="RocksDB 5.18.4"></a><a href="https://github.com/facebook/rocksdb/releases/tag/v5.18.4" target="_blank" rel="noopener">RocksDB 5.18.4</a></h2><p><a href="https://github.com/siying" target="_blank" rel="noopener"><img src="https://avatars0.githubusercontent.com/u/5334567?s=40&v=4" alt="@siying"></a> <a href="https://github.com/siying" target="_blank" rel="noopener">siying</a> released this on 12 Feb · <a href="https://github.com/facebook/rocksdb/compare/v5.18.4...master" target="_blank" rel="noopener">1773 commits</a> to master since this release</p>
<p>Special release for ARM. (Note: the originally tagged commit for this release was wrong but the tag has been updated a couple of times. You might need to delete your copy of the tag with <code>git tag -d v5.18.4</code> to get the new one. See <a href="https://git-scm.com/docs/git-tag#_on_re_tagging" target="_blank" rel="noopener">https://git-scm.com/docs/git-tag#_on_re_tagging</a>)</p>
<h2 id="6-6-3-2020-01-24"><a href="#6-6-3-2020-01-24" class="headerlink" title="6.6.3 (2020-01-24)"></a>6.6.3 (2020-01-24)</h2><h3 id="Bug-Fixes-11"><a href="#Bug-Fixes-11" class="headerlink" title="Bug Fixes"></a>Bug Fixes</h3><ul>
<li>Fix a bug that can cause write threads to hang when a slowdown/stall happens and there is a mix of writers with WriteOptions::no_slowdown set/unset.</li>
</ul>
<h2 id="6-6-2-2020-01-13"><a href="#6-6-2-2020-01-13" class="headerlink" title="6.6.2 (2020-01-13)"></a>6.6.2 (2020-01-13)</h2><h3 id="Bug-Fixes-12"><a href="#Bug-Fixes-12" class="headerlink" title="Bug Fixes"></a>Bug Fixes</h3><ul>
<li>Fixed a bug where non-L0 compaction input files were not considered to compute the <code>creation_time</code> of new compaction outputs.</li>
</ul>
<h2 id="6-6-1-2020-01-02"><a href="#6-6-1-2020-01-02" class="headerlink" title="6.6.1 (2020-01-02)"></a>6.6.1 (2020-01-02)</h2><h3 id="Bug-Fixes-13"><a href="#Bug-Fixes-13" class="headerlink" title="Bug Fixes"></a>Bug Fixes</h3><ul>
<li>Fix a bug in WriteBatchWithIndex::MultiGetFromBatchAndDB, which is called by Transaction::MultiGet, that causes due to stale pointer access when the number of keys is &gt; 32</li>
<li>Fixed two performance issues related to memtable history trimming. First, a new SuperVersion is now created only if some memtables were actually trimmed. Second, trimming is only scheduled if there is at least one flushed memtable that is kept in memory for the purposes of transaction conflict checking.</li>
<li>BlobDB no longer updates the SST to blob file mapping upon failed compactions.</li>
<li>Fix a bug in which a snapshot read through an iterator could be affected by a DeleteRange after the snapshot (<a href="https://github.com/facebook/rocksdb/pull/6062" target="_blank" rel="noopener">#6062</a>).</li>
<li>Fixed a bug where BlobDB was comparing the <code>ColumnFamilyHandle</code> pointers themselves instead of only the column family IDs when checking whether an API call uses the default column family or not.</li>
<li>Delete superversions in BackgroundCallPurge.</li>
<li>Fix use-after-free and double-deleting files in BackgroundCallPurge().</li>
</ul>
<h2 id="6-6-0-2019-11-25"><a href="#6-6-0-2019-11-25" class="headerlink" title="6.6.0 (2019-11-25)"></a>6.6.0 (2019-11-25)</h2><h3 id="Bug-Fixes-14"><a href="#Bug-Fixes-14" class="headerlink" title="Bug Fixes"></a>Bug Fixes</h3><ul>
<li>Fix data corruption casued by output of intra-L0 compaction on ingested file not being placed in correct order in L0.</li>
<li>Fix a data race between Version::GetColumnFamilyMetaData() and Compaction::MarkFilesBeingCompacted() for access to being_compacted (<a href="https://github.com/facebook/rocksdb/pull/6056" target="_blank" rel="noopener">#6056</a>). The current fix acquires the db mutex during Version::GetColumnFamilyMetaData(), which may cause regression.</li>
<li>Fix a bug in DBIter that is_blob_ state isn’t updated when iterating backward using seek.</li>
<li>Fix a bug when format_version=3, partitioned fitlers, and prefix search are used in conjunction. The bug could result into Seek::(prefix) returning NotFound for an existing prefix.</li>
<li>Revert the feature “Merging iterator to avoid child iterator reseek for some cases (<a href="https://github.com/facebook/rocksdb/pull/5286" target="_blank" rel="noopener">#5286</a>)” since it might cause strong results when reseek happens with a different iterator upper bound.</li>
<li>Fix a bug causing a crash during ingest external file when background compaction cause severe error (file not found).</li>
<li>Fix a bug when partitioned filters and prefix search are used in conjunction, ::SeekForPrev could return invalid for an existing prefix. ::SeekForPrev might be called by the user, or internally on ::Prev, or within ::Seek if the return value involves Delete or a Merge operand.</li>
<li>Fix OnFlushCompleted fired before flush result persisted in MANIFEST when there’s concurrent flush job. The bug exists since OnFlushCompleted was introduced in rocksdb 3.8.</li>
<li>Fixed an sst_dump crash on some plain table SST files.</li>
<li>Fixed a memory leak in some error cases of opening plain table SST files.</li>
<li>Fix a bug when a crash happens while calling WriteLevel0TableForRecovery for multiple column families, leading to a column family’s log number greater than the first corrutped log number when the DB is being opened in PointInTime recovery mode during next recovery attempt (<a href="https://github.com/facebook/rocksdb/pull/5856" target="_blank" rel="noopener">#5856</a>).</li>
</ul>
<h3 id="New-Features-4"><a href="#New-Features-4" class="headerlink" title="New Features"></a>New Features</h3><ul>
<li>Universal compaction to support options.periodic_compaction_seconds. A full compaction will be triggered if any file is over the threshold.</li>
<li><code>GetLiveFilesMetaData</code> and <code>GetColumnFamilyMetaData</code> now expose the file number of SST files as well as the oldest blob file referenced by each SST.</li>
<li>A batched MultiGet API (DB::MultiGet()) that supports retrieving keys from multiple column families.</li>
<li>Full and partitioned filters in the block-based table use an improved Bloom filter implementation, enabled with format_version 5 (or above) because previous releases cannot read this filter. This replacement is faster and more accurate, especially for high bits per key or millions of keys in a single (full) filter. For example, the new Bloom filter has the same false postive rate at 9.55 bits per key as the old one at 10 bits per key, and a lower false positive rate at 16 bits per key than the old one at 100 bits per key.</li>
<li>Added AVX2 instructions to USE_SSE builds to accelerate the new Bloom filter and XXH3-based hash function on compatible x86_64 platforms (Haswell and later, ~2014).</li>
<li>Support options.ttl or options.periodic_compaction_seconds with options.max_open_files = -1. File’s oldest ancester time and file creation time will be written to manifest. If it is availalbe, this information will be used instead of creation_time and file_creation_time in table properties.</li>
<li>Setting options.ttl for universal compaction now has the same meaning as setting periodic_compaction_seconds.</li>
<li>SstFileMetaData also returns file creation time and oldest ancester time.</li>
<li>The <code>sst_dump</code> command line tool <code>recompress</code> command now displays how many blocks were compressed and how many were not, in particular how many were not compressed because the compression ratio was not met (12.5% threshold for GoodCompressionRatio), as seen in the <code>number.block.not_compressed</code> counter stat since version 6.0.0.</li>
<li>The block cache usage is now takes into account the overhead of metadata per each entry. This results into more accurate managment of memory. A side-effect of this feature is that less items are fit into the block cache of the same size, which would result to higher cache miss rates. This can be remedied by increasing the block cache size or passing kDontChargeCacheMetadata to its constuctor to restore the old behavior.</li>
<li>When using BlobDB, a mapping is maintained and persisted in the MANIFEST between each SST file and the oldest non-TTL blob file it references.</li>
<li><code>db_bench</code> now supports and by default issues non-TTL Puts to BlobDB. TTL Puts can be enabled by specifying a non-zero value for the <code>blob_db_max_ttl_range</code> command line parameter explicitly.</li>
<li><code>sst_dump</code> now supports printing BlobDB blob indexes in a human-readable format. This can be enabled by specifying the <code>decode_blob_index</code> flag on the command line.</li>
<li>A number of new information elements are now exposed through the EventListener interface. For flushes, the file numbers of the new SST file and the oldest blob file referenced by the SST are propagated. For compactions, the level, file number, and the oldest blob file referenced are passed to the client for each compaction input and output file.</li>
</ul>
<h3 id="Public-API-Change-5"><a href="#Public-API-Change-5" class="headerlink" title="Public API Change"></a>Public API Change</h3><ul>
<li>RocksDB release 4.1 or older will not be able to open DB generated by the new release. 4.2 was released on Feb 23, 2016.</li>
<li>TTL Compactions in Level compaction style now initiate successive cascading compactions on a key range so that it reaches the bottom level quickly on TTL expiry. <code>creation_time</code> table property for compaction output files is now set to the minimum of the creation times of all compaction inputs.</li>
<li>With FIFO compaction style, options.periodic_compaction_seconds will have the same meaning as options.ttl. Whichever stricter will be used. With the default options.periodic_compaction_seconds value with options.ttl’s default of 0, RocksDB will give a default of 30 days.</li>
<li>Added an API GetCreationTimeOfOldestFile(uint64_t* creation_time) to get the file_creation_time of the oldest SST file in the DB.</li>
<li>FilterPolicy now exposes additional API to make it possible to choose filter configurations based on context, such as table level and compaction style. See <code>LevelAndStyleCustomFilterPolicy</code> in db_bloom_filter_test.cc. While most existing custom implementations of FilterPolicy should continue to work as before, those wrapping the return of NewBloomFilterPolicy will require overriding new function <code>GetBuilderWithContext()</code>, because calling <code>GetFilterBitsBuilder()</code> on the FilterPolicy returned by NewBloomFilterPolicy is no longer supported.</li>
<li>An unlikely usage of FilterPolicy is no longer supported. Calling GetFilterBitsBuilder() on the FilterPolicy returned by NewBloomFilterPolicy will now cause an assertion violation in debug builds, because RocksDB has internally migrated to a more elaborate interface that is expected to evolve further. Custom implementations of FilterPolicy should work as before, except those wrapping the return of NewBloomFilterPolicy, which will require a new override of a protected function in FilterPolicy.</li>
<li>NewBloomFilterPolicy now takes bits_per_key as a double instead of an int. This permits finer control over the memory vs. accuracy trade-off in the new Bloom filter implementation and should not change source code compatibility.</li>
<li>The option BackupableDBOptions::max_valid_backups_to_open is now only used when opening BackupEngineReadOnly. When opening a read/write BackupEngine, anything but the default value logs a warning and is treated as the default. This change ensures that backup deletion has proper accounting of shared files to ensure they are deleted when no longer referenced by a backup.</li>
<li>Deprecate <code>snap_refresh_nanos</code> option.</li>
<li>Added DisableManualCompaction/EnableManualCompaction to stop and resume manual compaction.</li>
<li>Add TryCatchUpWithPrimary() to StackableDB in non-LITE mode.</li>
<li>Add a new Env::LoadEnv() overloaded function to return a shared_ptr to Env.</li>
<li>Flush sets file name to “(nil)” for OnTableFileCreationCompleted() if the flush does not produce any L0. This can happen if the file is empty thus delete by RocksDB.</li>
</ul>
<h3 id="Default-Option-Changes"><a href="#Default-Option-Changes" class="headerlink" title="Default Option Changes"></a>Default Option Changes</h3><ul>
<li>Changed the default value of periodic_compaction_seconds to <code>UINT64_MAX - 1</code> which allows RocksDB to auto-tune periodic compaction scheduling. When using the default value, periodic compactions are now auto-enabled if a compaction filter is used. A value of <code>0</code> will turn off the feature completely.</li>
<li>Changed the default value of ttl to <code>UINT64_MAX - 1</code> which allows RocksDB to auto-tune ttl value. When using the default value, TTL will be auto-enabled to 30 days, when the feature is supported. To revert the old behavior, you can explictly set it to 0.</li>
</ul>
<h3 id="Performance-Improvements-3"><a href="#Performance-Improvements-3" class="headerlink" title="Performance Improvements"></a>Performance Improvements</h3><ul>
<li>For 64-bit hashing, RocksDB is standardizing on a slightly modified preview version of XXH3. This function is now used for many non-persisted hashes, along with fastrange64() in place of the modulus operator, and some benchmarks show a slight improvement.</li>
<li>Level iterator to invlidate the iterator more often in prefix seek and the level is filtered out by prefix bloom.</li>
</ul>
<h2 id="6-5-3-2020-01-10"><a href="#6-5-3-2020-01-10" class="headerlink" title="6.5.3 (2020-01-10)"></a>6.5.3 (2020-01-10)</h2><h3 id="Bug-Fixes-15"><a href="#Bug-Fixes-15" class="headerlink" title="Bug Fixes"></a>Bug Fixes</h3><ul>
<li>Fixed two performance issues related to memtable history trimming. First, a new SuperVersion is now created only if some memtables were actually trimmed. Second, trimming is only scheduled if there is at least one flushed memtable that is kept in memory for the purposes of transaction conflict checking.</li>
</ul>
<h2 id="6-5-2-2019-11-15"><a href="#6-5-2-2019-11-15" class="headerlink" title="6.5.2 (2019-11-15)"></a>6.5.2 (2019-11-15)</h2><h3 id="Bug-Fixes-16"><a href="#Bug-Fixes-16" class="headerlink" title="Bug Fixes"></a>Bug Fixes</h3><ul>
<li>Fix a assertion failure in MultiGe4t() when BlockBasedTableOptions::no_block_cache is true and there is no compressed block cache</li>
<li>Fix a buffer overrun problem in BlockBasedTable::MultiGet() when compression is enabled and no compressed block cache is configured.</li>
<li>If a call to BackupEngine::PurgeOldBackups or BackupEngine::DeleteBackup suffered a crash, power failure, or I/O error, files could be left over from old backups that could only be purged with a call to GarbageCollect. Any call to PurgeOldBackups, DeleteBackup, or GarbageCollect should now suffice to purge such files.</li>
</ul>
<h2 id="6-5-1-2019-10-16"><a href="#6-5-1-2019-10-16" class="headerlink" title="6.5.1 (2019-10-16)"></a>6.5.1 (2019-10-16)</h2><h3 id="Bug-Fixes-17"><a href="#Bug-Fixes-17" class="headerlink" title="Bug Fixes"></a>Bug Fixes</h3><ul>
<li>Revert the feature “Merging iterator to avoid child iterator reseek for some cases (<a href="https://github.com/facebook/rocksdb/pull/5286" target="_blank" rel="noopener">#5286</a>)” since it might cause strange results when reseek happens with a different iterator upper bound.</li>
<li>Fix a bug in BlockBasedTableIterator that might return incorrect results when reseek happens with a different iterator upper bound.</li>
<li>Fix a bug when partitioned filters and prefix search are used in conjunction, ::SeekForPrev could return invalid for an existing prefix. ::SeekForPrev might be called by the user, or internally on ::Prev, or within ::Seek if the return value involves Delete or a Merge operand.</li>
</ul>
<h2 id="6-5-0-2019-09-13"><a href="#6-5-0-2019-09-13" class="headerlink" title="6.5.0 (2019-09-13)"></a>6.5.0 (2019-09-13)</h2><h3 id="Bug-Fixes-18"><a href="#Bug-Fixes-18" class="headerlink" title="Bug Fixes"></a>Bug Fixes</h3><ul>
<li>Fixed a number of data races in BlobDB.</li>
<li>Fix a bug where the compaction snapshot refresh feature is not disabled as advertised when <code>snap_refresh_nanos</code> is set to 0..</li>
<li>Fix bloom filter lookups by the MultiGet batching API when BlockBasedTableOptions::whole_key_filtering is false, by checking that a key is in the perfix_extractor domain and extracting the prefix before looking up.</li>
<li>Fix a bug in file ingestion caused by incorrect file number allocation when the number of column families involved in the ingestion exceeds 2.</li>
</ul>
<h3 id="New-Features-5"><a href="#New-Features-5" class="headerlink" title="New Features"></a>New Features</h3><ul>
<li>Introduced DBOptions::max_write_batch_group_size_bytes to configure maximum limit on number of bytes that are written in a single batch of WAL or memtable write. It is followed when the leader write size is larger than 1/8 of this limit.</li>
<li>VerifyChecksum() by default will issue readahead. Allow ReadOptions to be passed in to those functions to override the readhead size. For checksum verifying before external SST file ingestion, a new option IngestExternalFileOptions.verify_checksums_readahead_size, is added for this readahead setting.</li>
<li>When user uses options.force_consistency_check in RocksDb, instead of crashing the process, we now pass the error back to the users without killing the process.</li>
<li>Add an option <code>memtable_insert_hint_per_batch</code> to WriteOptions. If it is true, each WriteBatch will maintain its own insert hints for each memtable in concurrent write. See include/rocksdb/options.h for more details.</li>
</ul>
<h3 id="Public-API-Change-6"><a href="#Public-API-Change-6" class="headerlink" title="Public API Change"></a>Public API Change</h3><ul>
<li>Added max_write_buffer_size_to_maintain option to better control memory usage of immutable memtables.</li>
<li>Added a lightweight API GetCurrentWalFile() to get last live WAL filename and size. Meant to be used as a helper for backup/restore tooling in a larger ecosystem such as MySQL with a MyRocks storage engine.</li>
<li>The MemTable Bloom filter, when enabled, now always uses cache locality. Options::bloom_locality now only affects the PlainTable SST format.</li>
</ul>
<h3 id="Performance-Improvements-4"><a href="#Performance-Improvements-4" class="headerlink" title="Performance Improvements"></a>Performance Improvements</h3><ul>
<li>Improve the speed of the MemTable Bloom filter, reducing the write overhead of enabling it by 1/3 to 1/2, with similar benefit to read performance.</li>
</ul>
<h2 id="6-4-6-2019-10-16"><a href="#6-4-6-2019-10-16" class="headerlink" title="6.4.6 (2019-10-16)"></a>6.4.6 (2019-10-16)</h2><h3 id="Bug-Fixes-19"><a href="#Bug-Fixes-19" class="headerlink" title="Bug Fixes"></a>Bug Fixes</h3><ul>
<li>Fix a bug when partitioned filters and prefix search are used in conjunction, ::SeekForPrev could return invalid for an existing prefix. ::SeekForPrev might be called by the user, or internally on ::Prev, or within ::Seek if the return value involves Delete or a Merge operand.</li>
</ul>
<h2 id="6-4-5-2019-10-01"><a href="#6-4-5-2019-10-01" class="headerlink" title="6.4.5 (2019-10-01)"></a>6.4.5 (2019-10-01)</h2><h3 id="Bug-Fixes-20"><a href="#Bug-Fixes-20" class="headerlink" title="Bug Fixes"></a>Bug Fixes</h3><ul>
<li>Revert the feature “Merging iterator to avoid child iterator reseek for some cases (<a href="https://github.com/facebook/rocksdb/pull/5286" target="_blank" rel="noopener">#5286</a>)” since it might cause strange results when reseek happens with a different iterator upper bound.</li>
<li>Fix a bug in BlockBasedTableIterator that might return incorrect results when reseek happens with a different iterator upper bound.</li>
</ul>
<h2 id="6-4-4-2019-09-17"><a href="#6-4-4-2019-09-17" class="headerlink" title="6.4.4 (2019-09-17)"></a>6.4.4 (2019-09-17)</h2><ul>
<li>Fix a bug introduced 6.3 which could cause wrong results in a corner case when prefix bloom filter is used and the iterator is reseeked.</li>
</ul>
<h2 id="6-4-2-2019-09-03"><a href="#6-4-2-2019-09-03" class="headerlink" title="6.4.2 (2019-09-03)"></a>6.4.2 (2019-09-03)</h2><h3 id="Bug-Fixes-21"><a href="#Bug-Fixes-21" class="headerlink" title="Bug Fixes"></a>Bug Fixes</h3><ul>
<li>Fix a bug in file ingestion caused by incorrect file number allocation when the number of column families involved in the ingestion exceeds 2.</li>
</ul>
<h2 id="6-4-1-2019-08-20"><a href="#6-4-1-2019-08-20" class="headerlink" title="6.4.1 (2019-08-20)"></a>6.4.1 (2019-08-20)</h2><h3 id="Bug-Fixes-22"><a href="#Bug-Fixes-22" class="headerlink" title="Bug Fixes"></a>Bug Fixes</h3><ul>
<li>Fix a bug where the compaction snapshot refresh feature is not disabled as advertised when <code>snap_refresh_nanos</code> is set to 0..</li>
</ul>
<h2 id="6-4-0-2019-07-30"><a href="#6-4-0-2019-07-30" class="headerlink" title="6.4.0 (2019-07-30)"></a>6.4.0 (2019-07-30)</h2><h3 id="Default-Option-Change"><a href="#Default-Option-Change" class="headerlink" title="Default Option Change"></a>Default Option Change</h3><ul>
<li>LRUCacheOptions.high_pri_pool_ratio is set to 0.5 (previously 0.0) by default, which means that by default midpoint insertion is enabled. The same change is made for the default value of high_pri_pool_ratio argument in NewLRUCache(). When block cache is not explictly created, the small block cache created by BlockBasedTable will still has this option to be 0.0.</li>
<li>Change BlockBasedTableOptions.cache_index_and_filter_blocks_with_high_priority’s default value from false to true.</li>
</ul>
<h3 id="Public-API-Change-7"><a href="#Public-API-Change-7" class="headerlink" title="Public API Change"></a>Public API Change</h3><ul>
<li>Filter and compression dictionary blocks are now handled similarly to data blocks with regards to the block cache: instead of storing objects in the cache, only the blocks themselves are cached. In addition, filter and compression dictionary blocks (as well as filter partitions) no longer get evicted from the cache when a table is closed.</li>
<li>Due to the above refactoring, block cache eviction statistics for filter and compression dictionary blocks are temporarily broken. We plan to reintroduce them in a later phase.</li>
<li>The semantics of the per-block-type block read counts in the performance context now match those of the generic block_read_count.</li>
<li>Errors related to the retrieval of the compression dictionary are now propagated to the user.</li>
<li>db_bench adds a “benchmark” stats_history, which prints out the whole stats history.</li>
<li>Overload GetAllKeyVersions() to support non-default column family.</li>
<li>Added new APIs ExportColumnFamily() and CreateColumnFamilyWithImport() to support export and import of a Column Family. <a href="https://github.com/facebook/rocksdb/issues/3469" target="_blank" rel="noopener">#3469</a></li>
<li>ldb sometimes uses a string-append merge operator if no merge operator is passed in. This is to allow users to print keys from a DB with a merge operator.</li>
<li>Replaces old Registra with ObjectRegistry to allow user to create custom object from string, also add LoadEnv() to Env.</li>
<li>Added new overload of GetApproximateSizes which gets SizeApproximationOptions object and returns a Status. The older overloads are redirecting their calls to this new method and no longer assert if the include_flags doesn’t have either of INCLUDE_MEMTABLES or INCLUDE_FILES bits set. It’s recommended to use the new method only, as it is more type safe and returns a meaningful status in case of errors.</li>
</ul>
<h3 id="New-Features-6"><a href="#New-Features-6" class="headerlink" title="New Features"></a>New Features</h3><ul>
<li>Add argument <code>--secondary_path</code> to ldb to open the database as the secondary instance. This would keep the original DB intact.</li>
<li>Compression dictionary blocks are now prefetched and pinned in the cache (based on the customer’s settings) the same way as index and filter blocks.</li>
<li>Added DBOptions::log_readahead_size which specifies the number of bytes to prefetch when reading the log. This is mostly useful for reading a remotely located log, as it can save the number of round-trips. If 0 (default), then the prefetching is disabled.</li>
<li>Support loading custom objects in unit tests. In the affected unit tests, RocksDB will create custom Env objects based on environment variable TEST_ENV_URI. Users need to make sure custom object types are properly registered. For example, a static library should expose a <code>RegisterCustomObjects</code> function. By linking the unit test binary with the static library, the unit test can execute this function.</li>
</ul>
<h3 id="Performance-Improvements-5"><a href="#Performance-Improvements-5" class="headerlink" title="Performance Improvements"></a>Performance Improvements</h3><ul>
<li>Reduce iterator key comparision for upper/lower bound check.</li>
<li>Improve performance of row_cache: make reads with newer snapshots than data in an SST file share the same cache key, except in some transaction cases.</li>
<li>The compression dictionary is no longer copied to a new object upon retrieval.</li>
</ul>
<h3 id="Bug-Fixes-23"><a href="#Bug-Fixes-23" class="headerlink" title="Bug Fixes"></a>Bug Fixes</h3><ul>
<li>Fix ingested file and directory not being fsync.</li>
<li>Return TryAgain status in place of Corruption when new tail is not visible to TransactionLogIterator.</li>
<li>Fixed a regression where the fill_cache read option also affected index blocks.</li>
<li>Fixed an issue where using cache_index_and_filter_blocks==false affected partitions of partitioned indexes/filters as well.</li>
</ul>
<h2 id="6-3-6-2019-10-01"><a href="#6-3-6-2019-10-01" class="headerlink" title="6.3.6 (2019-10-01)"></a>6.3.6 (2019-10-01)</h2><ul>
<li>Revert the feature “Merging iterator to avoid child iterator reseek for some cases (<a href="https://github.com/facebook/rocksdb/pull/5286" target="_blank" rel="noopener">#5286</a>)” since it might cause strong results when reseek happens with a different iterator upper bound.</li>
</ul>
<h2 id="6-3-5-2019-09-17"><a href="#6-3-5-2019-09-17" class="headerlink" title="6.3.5 (2019-09-17)"></a>6.3.5 (2019-09-17)</h2><ul>
<li>Fix a bug introduced 6.3 which could cause wrong results in a corner case when prefix bloom filter is used and the iterator is reseeked.</li>
</ul>
<h2 id="6-3-4-2019-09-03"><a href="#6-3-4-2019-09-03" class="headerlink" title="6.3.4 (2019-09-03)"></a>6.3.4 (2019-09-03)</h2><h3 id="Bug-Fixes-24"><a href="#Bug-Fixes-24" class="headerlink" title="Bug Fixes"></a>Bug Fixes</h3><ul>
<li>Fix a bug in file ingestion caused by incorrect file number allocation when the number of column families involved in the ingestion exceeds 2.</li>
</ul>
<h2 id="6-3-3-2019-08-20"><a href="#6-3-3-2019-08-20" class="headerlink" title="6.3.3 (2019-08-20)"></a>6.3.3 (2019-08-20)</h2><h3 id="Bug-Fixes-25"><a href="#Bug-Fixes-25" class="headerlink" title="Bug Fixes"></a>Bug Fixes</h3><ul>
<li>Fix a bug where the compaction snapshot refresh feature is not disabled as advertised when <code>snap_refresh_nanos</code> is set to 0..</li>
</ul>
<h2 id="6-3-2-2019-08-15"><a href="#6-3-2-2019-08-15" class="headerlink" title="6.3.2 (2019-08-15)"></a>6.3.2 (2019-08-15)</h2><h3 id="Public-API-Change-8"><a href="#Public-API-Change-8" class="headerlink" title="Public API Change"></a>Public API Change</h3><ul>
<li>The semantics of the per-block-type block read counts in the performance context now match those of the generic block_read_count.</li>
</ul>
<h3 id="Bug-Fixes-26"><a href="#Bug-Fixes-26" class="headerlink" title="Bug Fixes"></a>Bug Fixes</h3><ul>
<li>Fixed a regression where the fill_cache read option also affected index blocks.</li>
<li>Fixed an issue where using cache_index_and_filter_blocks==false affected partitions of partitioned indexes as well.</li>
</ul>
<h2 id="6-3-1-2019-07-24"><a href="#6-3-1-2019-07-24" class="headerlink" title="6.3.1 (2019-07-24)"></a>6.3.1 (2019-07-24)</h2><h3 id="Bug-Fixes-27"><a href="#Bug-Fixes-27" class="headerlink" title="Bug Fixes"></a>Bug Fixes</h3><ul>
<li>Fix auto rolling bug introduced in 6.3.0, which causes segfault if log file creation fails.</li>
</ul>
<h2 id="6-3-0-2019-06-18"><a href="#6-3-0-2019-06-18" class="headerlink" title="6.3.0 (2019-06-18)"></a>6.3.0 (2019-06-18)</h2><h3 id="Public-API-Change-9"><a href="#Public-API-Change-9" class="headerlink" title="Public API Change"></a>Public API Change</h3><ul>
<li>Now DB::Close() will return Aborted() error when there is unreleased snapshot. Users can retry after all snapshots are released.</li>
<li>Index blocks are now handled similarly to data blocks with regards to the block cache: instead of storing objects in the cache, only the blocks themselves are cached. In addition, index blocks no longer get evicted from the cache when a table is closed, can now use the compressed block cache (if any), and can be shared among multiple table readers.</li>
<li>Partitions of partitioned indexes no longer affect the read amplification statistics.</li>
<li>Due to the above refactoring, block cache eviction statistics for indexes are temporarily broken. We plan to reintroduce them in a later phase.</li>
<li>options.keep_log_file_num will be enforced strictly all the time. File names of all log files will be tracked, which may take significantly amount of memory if options.keep_log_file_num is large and either of options.max_log_file_size or options.log_file_time_to_roll is set.</li>
<li>Add initial support for Get/Put with user timestamps. Users can specify timestamps via ReadOptions and WriteOptions when calling DB::Get and DB::Put.</li>
<li>Accessing a partition of a partitioned filter or index through a pinned reference is no longer considered a cache hit.</li>
<li>Add C bindings for secondary instance, i.e. DBImplSecondary.</li>
<li>Rate limited deletion of WALs is only enabled if DBOptions::wal_dir is not set, or explicitly set to db_name passed to DB::Open and DBOptions::db_paths is empty, or same as db_paths[0].path</li>
</ul>
<h3 id="New-Features-7"><a href="#New-Features-7" class="headerlink" title="New Features"></a>New Features</h3><ul>
<li>Add an option <code>snap_refresh_nanos</code> (default to 0) to periodically refresh the snapshot list in compaction jobs. Assign to 0 to disable the feature.</li>
<li>Add an option <code>unordered_write</code> which trades snapshot guarantees with higher write throughput. When used with WRITE_PREPARED transactions with two_write_queues=true, it offers higher throughput with however no compromise on guarantees.</li>
<li>Allow DBImplSecondary to remove memtables with obsolete data after replaying MANIFEST and WAL.</li>
<li>Add an option <code>failed_move_fall_back_to_copy</code> (default is true) for external SST ingestion. When <code>move_files</code> is true and hard link fails, ingestion falls back to copy if <code>failed_move_fall_back_to_copy</code> is true. Otherwise, ingestion reports an error.</li>
</ul>
<h3 id="Performance-Improvements-6"><a href="#Performance-Improvements-6" class="headerlink" title="Performance Improvements"></a>Performance Improvements</h3><ul>
<li>Reduce binary search when iterator reseek into the same data block.</li>
<li>DBIter::Next() can skip user key checking if previous entry’s seqnum is 0.</li>
<li>Merging iterator to avoid child iterator reseek for some cases</li>
<li>Log Writer will flush after finishing the whole record, rather than a fragment.</li>
<li>Lower MultiGet batching API latency by reading data blocks from disk in parallel</li>
</ul>
<h3 id="General-Improvements"><a href="#General-Improvements" class="headerlink" title="General Improvements"></a>General Improvements</h3><ul>
<li>Added new status code kColumnFamilyDropped to distinguish between Column Family Dropped and DB Shutdown in progress.</li>
<li>Improve ColumnFamilyOptions validation when creating a new column family.</li>
</ul>
<h3 id="Bug-Fixes-28"><a href="#Bug-Fixes-28" class="headerlink" title="Bug Fixes"></a>Bug Fixes</h3><ul>
<li>Fix a bug in WAL replay of secondary instance by skipping write batches with older sequence numbers than the current last sequence number.</li>
<li>Fix flush’s/compaction’s merge processing logic which allowed <code>Put</code>s covered by range tombstones to reappear. Note <code>Put</code>s may exist even if the user only ever called <code>Merge()</code> due to an internal conversion during compaction to the bottommost level.</li>
<li>Fix/improve memtable earliest sequence assignment and WAL replay so that WAL entries of unflushed column families will not be skipped after replaying the MANIFEST and increasing db sequence due to another flushed/compacted column family.</li>
<li>Fix a bug caused by secondary not skipping the beginning of new MANIFEST.</li>
<li>On DB open, delete WAL trash files left behind in wal_dir</li>
</ul>
<h2 id="6-2-4-9-18-2019"><a href="#6-2-4-9-18-2019" class="headerlink" title="6.2.4 (9/18/2019)"></a>6.2.4 (9/18/2019)</h2><h3 id="Bug-Fixes-29"><a href="#Bug-Fixes-29" class="headerlink" title="Bug Fixes"></a>Bug Fixes</h3><ul>
<li>Disable snap_refresh_nanos by default. The feature is to be deprecated in the next release.</li>
</ul>
<h2 id="6-2-3-9-3-2019"><a href="#6-2-3-9-3-2019" class="headerlink" title="6.2.3 (9/3/2019)"></a>6.2.3 (9/3/2019)</h2><h3 id="Bug-Fixes-30"><a href="#Bug-Fixes-30" class="headerlink" title="Bug Fixes"></a>Bug Fixes</h3><ul>
<li>Fix a bug in file ingestion caused by incorrect file number allocation when the number of column families involved in the ingestion exceeds 2.</li>
</ul>
<h2 id="6-2-2-6-7-2019"><a href="#6-2-2-6-7-2019" class="headerlink" title="6.2.2 (6/7/2019)"></a>6.2.2 (6/7/2019)</h2><h3 id="Bug-Fixes-31"><a href="#Bug-Fixes-31" class="headerlink" title="Bug Fixes"></a>Bug Fixes</h3><ul>
<li>Disable dynamic extension support by default for CMake.</li>
</ul>
<h2 id="6-2-1-6-4-2019"><a href="#6-2-1-6-4-2019" class="headerlink" title="6.2.1 (6/4/2019)"></a>6.2.1 (6/4/2019)</h2><h3 id="Bug-Fixes-32"><a href="#Bug-Fixes-32" class="headerlink" title="Bug Fixes"></a>Bug Fixes</h3><ul>
<li>Fix flush’s/compaction’s merge processing logic which allowed <code>Put</code>s covered by range tombstones to reappear. Note <code>Put</code>s may exist even if the user only ever called <code>Merge()</code> due to an internal conversion during compaction to the bottommost level.</li>
</ul>
<h2 id="6-2-0-4-30-2019"><a href="#6-2-0-4-30-2019" class="headerlink" title="6.2.0 (4/30/2019)"></a>6.2.0 (4/30/2019)</h2><h3 id="New-Features-8"><a href="#New-Features-8" class="headerlink" title="New Features"></a>New Features</h3><ul>
<li>Add an option <code>strict_bytes_per_sync</code> that causes a file-writing thread to block rather than exceed the limit on bytes pending writeback specified by <code>bytes_per_sync</code> or <code>wal_bytes_per_sync</code>.</li>
<li>Improve range scan performance by avoiding per-key upper bound check in BlockBasedTableIterator.</li>
<li>Introduce Periodic Compaction for Level style compaction. Files are re-compacted periodically and put in the same level.</li>
<li>Block-based table index now contains exact highest key in the file, rather than an upper bound. This may improve Get() and iterator Seek() performance in some situations, especially when direct IO is enabled and block cache is disabled. A setting BlockBasedTableOptions::index_shortening is introduced to control this behavior. Set it to kShortenSeparatorsAndSuccessor to get the old behavior.</li>
<li>When reading from option file/string/map, customized envs can be filled according to object registry.</li>
<li>Add an option <code>snap_refresh_nanos</code> (default to 0.5s) to periodically refresh the snapshot list in compaction jobs. Assign to 0 to disable the feature.</li>
<li>Improve range scan performance when using explicit user readahead by not creating new table readers for every iterator.</li>
</ul>
<h3 id="Public-API-Change-10"><a href="#Public-API-Change-10" class="headerlink" title="Public API Change"></a>Public API Change</h3><ul>
<li>Change the behavior of OptimizeForPointLookup(): move away from hash-based block-based-table index, and use whole key memtable filtering.</li>
<li>Change the behavior of OptimizeForSmallDb(): use a 16MB block cache, put index and filter blocks into it, and cost the memtable size to it. DBOptions.OptimizeForSmallDb() and ColumnFamilyOptions.OptimizeForSmallDb() start to take an optional cache object.</li>
<li>Added BottommostLevelCompaction::kForceOptimized to avoid double compacting newly compacted files in the bottommost level compaction of manual compaction. Note this option may prohibit the manual compaction to produce a single file in the bottommost level.</li>
</ul>
<h3 id="Bug-Fixes-33"><a href="#Bug-Fixes-33" class="headerlink" title="Bug Fixes"></a>Bug Fixes</h3><ul>
<li>Adjust WriteBufferManager’s dummy entry size to block cache from 1MB to 256KB.</li>
<li>Fix a race condition between WritePrepared::Get and ::Put with duplicate keys.</li>
<li>Fix crash when memtable prefix bloom is enabled and read/write a key out of domain of prefix extractor.</li>
<li>Close a WAL file before another thread deletes it.</li>
<li>Fix an assertion failure <code>IsFlushPending() == true</code> caused by one bg thread releasing the db mutex in ~ColumnFamilyData and another thread clearing <code>flush_requested_</code> flag.</li>
</ul>
<h2 id="6-1-2-6-4-2019"><a href="#6-1-2-6-4-2019" class="headerlink" title="6.1.2 (6/4/2019)"></a>6.1.2 (6/4/2019)</h2><h3 id="Bug-Fixes-34"><a href="#Bug-Fixes-34" class="headerlink" title="Bug Fixes"></a>Bug Fixes</h3><ul>
<li>Fix flush’s/compaction’s merge processing logic which allowed <code>Put</code>s covered by range tombstones to reappear. Note <code>Put</code>s may exist even if the user only ever called <code>Merge()</code> due to an internal conversion during compaction to the bottommost level.</li>
</ul>
<h2 id="6-0-2-4-23-2019"><a href="#6-0-2-4-23-2019" class="headerlink" title="6.0.2 (4/23/2019)"></a>6.0.2 (4/23/2019)</h2><h2 id="Bug-Fixes-needed-for-Java-users"><a href="#Bug-Fixes-needed-for-Java-users" class="headerlink" title="Bug Fixes needed for Java users"></a>Bug Fixes needed for Java users</h2><ul>
<li>Fix build failures due to missing JEMALLOC_CXX_THROW macro (<a href="https://github.com/facebook/rocksdb/pull/5053" target="_blank" rel="noopener">#5053</a>)</li>
<li>Fix compilation on db_bench_tool.cc on Windows (<a href="https://github.com/facebook/rocksdb/pull/5227" target="_blank" rel="noopener">#5227</a>)</li>
</ul>
<h2 id="6-1-1-4-9-2019"><a href="#6-1-1-4-9-2019" class="headerlink" title="6.1.1 (4/9/2019)"></a>6.1.1 (4/9/2019)</h2><h3 id="New-Features-9"><a href="#New-Features-9" class="headerlink" title="New Features"></a>New Features</h3><ul>
<li>When reading from option file/string/map, customized comparators and/or merge operators can be filled according to object registry.</li>
</ul>
<h3 id="Public-API-Change-11"><a href="#Public-API-Change-11" class="headerlink" title="Public API Change"></a>Public API Change</h3><h3 id="Bug-Fixes-35"><a href="#Bug-Fixes-35" class="headerlink" title="Bug Fixes"></a>Bug Fixes</h3><ul>
<li>Fix a bug in 2PC where a sequence of txn prepare, memtable flush, and crash could result in losing the prepared transaction.</li>
<li>Fix a bug in Encryption Env which could cause encrypted files to be read beyond file boundaries.</li>
</ul>
<h2 id="6-1-0-3-27-2019"><a href="#6-1-0-3-27-2019" class="headerlink" title="6.1.0 (3/27/2019)"></a>6.1.0 (3/27/2019)</h2><h3 id="New-Features-10"><a href="#New-Features-10" class="headerlink" title="New Features"></a>New Features</h3><ul>
<li>Introduce two more stats levels, kExceptHistogramOrTimers and kExceptTimers.</li>
<li>Added a feature to perform data-block sampling for compressibility, and report stats to user.</li>
<li>Add support for trace filtering.</li>
<li>Add DBOptions.avoid_unnecessary_blocking_io. If true, we avoid file deletion when destorying ColumnFamilyHandle and Iterator. Instead, a job is scheduled to delete the files in background.</li>
</ul>
<h3 id="Public-API-Change-12"><a href="#Public-API-Change-12" class="headerlink" title="Public API Change"></a>Public API Change</h3><ul>
<li>Remove bundled fbson library.</li>
<li>statistics.stats_level_ becomes atomic. It is preferred to use statistics.set_stats_level() and statistics.get_stats_level() to access it.</li>
<li>Introduce a new IOError subcode, PathNotFound, to indicate trying to open a nonexistent file or directory for read.</li>
<li>Add initial support for multiple db instances sharing the same data in single-writer, multi-reader mode.</li>
<li>Removed some “using std::xxx” from public headers.</li>
</ul>
<h3 id="Bug-Fixes-36"><a href="#Bug-Fixes-36" class="headerlink" title="Bug Fixes"></a>Bug Fixes</h3><ul>
<li>Fix JEMALLOC_CXX_THROW macro missing from older Jemalloc versions, causing build failures on some platforms.</li>
<li>Fix SstFileReader not able to open file ingested with write_glbal_seqno=true.</li>
</ul>
<h2 id="6-0-1-3-26-2019"><a href="#6-0-1-3-26-2019" class="headerlink" title="6.0.1 (3/26/2019)"></a>6.0.1 (3/26/2019)</h2><h3 id="New-Features-11"><a href="#New-Features-11" class="headerlink" title="New Features"></a>New Features</h3><h3 id="Public-API-Change-13"><a href="#Public-API-Change-13" class="headerlink" title="Public API Change"></a>Public API Change</h3><ul>
<li>Added many new features to the Java API to bring it closer to the C++ API.</li>
</ul>
<h3 id="Bug-Fixes-37"><a href="#Bug-Fixes-37" class="headerlink" title="Bug Fixes"></a>Bug Fixes</h3><ul>
<li>Make BlobDB wait for all background tasks on shutdown.</li>
<li>Fixed a BlobDB issue where some trash files are not tracked causing them to remain forever.</li>
</ul>
<h2 id="6-0-0-2-19-2019"><a href="#6-0-0-2-19-2019" class="headerlink" title="6.0.0 (2/19/2019)"></a>6.0.0 (2/19/2019)</h2><h3 id="New-Features-12"><a href="#New-Features-12" class="headerlink" title="New Features"></a>New Features</h3><ul>
<li>Enabled checkpoint on readonly db (DBImplReadOnly).</li>
<li>Make DB ignore dropped column families while committing results of atomic flush.</li>
<li>RocksDB may choose to preopen some files even if options.max_open_files != -1. This may make DB open slightly longer.</li>
<li>For users of dictionary compression with ZSTD v0.7.0+, we now reuse the same digested dictionary when compressing each of an SST file’s data blocks for faster compression speeds.</li>
<li>For all users of dictionary compression who set <code>cache_index_and_filter_blocks == true</code>, we now store dictionary data used for decompression in the block cache for better control over memory usage. For users of ZSTD v1.1.4+ who compile with -DZSTD_STATIC_LINKING_ONLY, this includes a digested dictionary, which is used to increase decompression speed.</li>
<li>Add support for block checksums verification for external SST files before ingestion.</li>
<li>Introduce stats history which periodically saves Statistics snapshots and added <code>GetStatsHistory</code> API to retrieve these snapshots.</li>
<li>Add a place holder in manifest which indicate a record from future that can be safely ignored.</li>
<li>Add support for trace sampling.</li>
<li>Enable properties block checksum verification for block-based tables.</li>
<li>For all users of dictionary compression, we now generate a separate dictionary for compressing each bottom-level SST file. Previously we reused a single dictionary for a whole compaction to bottom level. The new approach achieves better compression ratios; however, it uses more memory and CPU for buffering/sampling data blocks and training dictionaries.</li>
<li>Add whole key bloom filter support in memtable.</li>
<li>Files written by <code>SstFileWriter</code> will now use dictionary compression if it is configured in the file writer’s <code>CompressionOptions</code>.</li>
</ul>
<h3 id="Public-API-Change-14"><a href="#Public-API-Change-14" class="headerlink" title="Public API Change"></a>Public API Change</h3><ul>
<li>Disallow CompactionFilter::IgnoreSnapshots() = false, because it is not very useful and the behavior is confusing. The filter will filter everything if there is no snapshot declared by the time the compaction starts. However, users can define a snapshot after the compaction starts and before it finishes and this new snapshot won’t be repeatable, because after the compaction finishes, some keys may be dropped.</li>
<li>CompactionPri = kMinOverlappingRatio also uses compensated file size, which boosts file with lots of tombstones to be compacted first.</li>
<li>Transaction::GetForUpdate is extended with a do_validate parameter with default value of true. If false it skips validating the snapshot before doing the read. Similarly ::Merge, ::Put, ::Delete, and ::SingleDelete are extended with assume_tracked with default value of false. If true it indicates that call is assumed to be after a ::GetForUpdate.</li>
<li><code>TableProperties::num_entries</code> and <code>TableProperties::num_deletions</code> now also account for number of range tombstones.</li>
<li>Remove geodb, spatial_db, document_db, json_document, date_tiered_db, and redis_lists.</li>
<li>With “ldb —-try_load_options”, when wal_dir specified by the option file doesn’t exist, ignore it.</li>
<li>Change time resolution in FileOperationInfo.</li>
<li>Deleting Blob files also go through SStFileManager.</li>
<li>Remove CuckooHash memtable.</li>
<li>The counter stat <code>number.block.not_compressed</code> now also counts blocks not compressed due to poor compression ratio.</li>
<li>Remove ttl option from <code>CompactionOptionsFIFO</code>. The option has been deprecated and ttl in <code>ColumnFamilyOptions</code> is used instead.</li>
<li>Support SST file ingestion across multiple column families via DB::IngestExternalFiles. See the function’s comment about atomicity.</li>
<li>Remove Lua compaction filter.</li>
</ul>
<h3 id="Bug-Fixes-38"><a href="#Bug-Fixes-38" class="headerlink" title="Bug Fixes"></a>Bug Fixes</h3><ul>
<li>Fix a deadlock caused by compaction and file ingestion waiting for each other in the event of write stalls.</li>
<li>Fix a memory leak when files with range tombstones are read in mmap mode and block cache is enabled</li>
<li>Fix handling of corrupt range tombstone blocks such that corruptions cannot cause deleted keys to reappear</li>
<li>Lock free MultiGet</li>
<li>Fix incorrect <code>NotFound</code> point lookup result when querying the endpoint of a file that has been extended by a range tombstone.</li>
<li>Fix with pipelined write, write leaders’s callback failure lead to the whole write group fail.</li>
</ul>
<h3 id="Change-Default-Options"><a href="#Change-Default-Options" class="headerlink" title="Change Default Options"></a>Change Default Options</h3><ul>
<li>Change options.compaction_pri’s default to kMinOverlappingRatio</li>
</ul>
<h2 id="5-18-3-2-11-2019"><a href="#5-18-3-2-11-2019" class="headerlink" title="5.18.3 (2/11/2019)"></a>5.18.3 (2/11/2019)</h2><h3 id="Bug-Fixes-39"><a href="#Bug-Fixes-39" class="headerlink" title="Bug Fixes"></a>Bug Fixes</h3><ul>
<li>Fix possible LSM corruption when both range deletions and subcompactions are used. The symptom of this corruption is L1+ files overlapping in the user key space.</li>
</ul>
<h2 id="5-18-2-01-31-2019"><a href="#5-18-2-01-31-2019" class="headerlink" title="5.18.2 (01/31/2019)"></a>5.18.2 (01/31/2019)</h2><h3 id="Public-API-Change-15"><a href="#Public-API-Change-15" class="headerlink" title="Public API Change"></a>Public API Change</h3><ul>
<li>Change time resolution in FileOperationInfo.</li>
<li>Deleting Blob files also go through SStFileManager.</li>
</ul>
<h2 id="5-18-0-11-30-2018"><a href="#5-18-0-11-30-2018" class="headerlink" title="5.18.0 (11/30/2018)"></a>5.18.0 (11/30/2018)</h2><h3 id="New-Features-13"><a href="#New-Features-13" class="headerlink" title="New Features"></a>New Features</h3><ul>
<li>Introduced <code>JemallocNodumpAllocator</code> memory allocator. When being use, block cache will be excluded from core dump.</li>
<li>Introduced <code>PerfContextByLevel</code> as part of <code>PerfContext</code> which allows storing perf context at each level. Also replaced <code>__thread</code> with <code>thread_local</code> keyword for perf_context. Added per-level perf context for bloom filter and <code>Get</code> query.</li>
<li>With level_compaction_dynamic_level_bytes = true, level multiplier may be adjusted automatically when Level 0 to 1 compaction is lagged behind.</li>
<li>Introduced DB option <code>atomic_flush</code>. If true, RocksDB supports flushing multiple column families and atomically committing the result to MANIFEST. Useful when WAL is disabled.</li>
<li>Added <code>num_deletions</code> and <code>num_merge_operands</code> members to <code>TableProperties</code>.</li>
<li>Added “rocksdb.min-obsolete-sst-number-to-keep” DB property that reports the lower bound on SST file numbers that are being kept from deletion, even if the SSTs are obsolete.</li>
<li>Add xxhash64 checksum support</li>
<li>Introduced <code>MemoryAllocator</code>, which lets the user specify custom memory allocator for block based table.</li>
<li>Improved <code>DeleteRange</code> to prevent read performance degradation. The feature is no longer marked as experimental.</li>
<li>Enabled checkpoint on readonly db (DBImplReadOnly).</li>
</ul>
<h3 id="Public-API-Change-16"><a href="#Public-API-Change-16" class="headerlink" title="Public API Change"></a>Public API Change</h3><ul>
<li><code>DBOptions::use_direct_reads</code> now affects reads issued by <code>BackupEngine</code> on the database’s SSTs.</li>
<li><code>NO_ITERATORS</code> is divided into two counters <code>NO_ITERATOR_CREATED</code> and <code>NO_ITERATOR_DELETE</code>. Both of them are only increasing now, just as other counters.</li>
</ul>
<h3 id="Bug-Fixes-40"><a href="#Bug-Fixes-40" class="headerlink" title="Bug Fixes"></a>Bug Fixes</h3><ul>
<li>Fix corner case where a write group leader blocked due to write stall blocks other writers in queue with WriteOptions::no_slowdown set.</li>
<li>Fix in-memory range tombstone truncation to avoid erroneously covering newer keys at a lower level, and include range tombstones in compacted files whose largest key is the range tombstone’s start key.</li>
<li>Properly set the stop key for a truncated manual CompactRange</li>
<li>Fix slow flush/compaction when DB contains many snapshots. The problem became noticeable to us in DBs with 100,000+ snapshots, though it will affect others at different thresholds.</li>
<li>Fix the bug that WriteBatchWithIndex’s SeekForPrev() doesn’t see the entries with the same key.</li>
<li>Fix the bug where user comparator was sometimes fed with InternalKey instead of the user key. The bug manifests when during GenerateBottommostFiles.</li>
<li>Fix a bug in WritePrepared txns where if the number of old snapshots goes beyond the snapshot cache size (128 default) the rest will not be checked when evicting a commit entry from the commit cache.</li>
<li>Fixed Get correctness bug in the presence of range tombstones where merge operands covered by a range tombstone always result in NotFound.</li>
<li>Start populating <code>NO_FILE_CLOSES</code> ticker statistic, which was always zero previously.</li>
<li>The default value of NewBloomFilterPolicy()’s argument use_block_based_builder is changed to false. Note that this new default may cause large temp memory usage when building very large SST files.</li>
<li>Fix a deadlock caused by compaction and file ingestion waiting for each other in the event of write stalls.</li>
<li>Make DB ignore dropped column families while committing results of atomic flush.</li>
</ul>
<h1 id="5-17-2-10-24-2018"><a href="#5-17-2-10-24-2018" class="headerlink" title="5.17.2 (10/24/2018)"></a>5.17.2 (10/24/2018)</h1><h3 id="Bug-Fixes-41"><a href="#Bug-Fixes-41" class="headerlink" title="Bug Fixes"></a>Bug Fixes</h3><ul>
<li>Fix the bug that WriteBatchWithIndex’s SeekForPrev() doesn’t see the entries with the same key.</li>
</ul>
<h1 id="5-17-1-10-16-2018"><a href="#5-17-1-10-16-2018" class="headerlink" title="5.17.1 (10/16/2018)"></a>5.17.1 (10/16/2018)</h1><h3 id="Bug-Fixes-42"><a href="#Bug-Fixes-42" class="headerlink" title="Bug Fixes"></a>Bug Fixes</h3><ul>
<li>Fix slow flush/compaction when DB contains many snapshots. The problem became noticeable to us in DBs with 100,000+ snapshots, though it will affect others at different thresholds.</li>
<li>Properly set the stop key for a truncated manual CompactRange</li>
<li>Fix corner case where a write group leader blocked due to write stall blocks other writers in queue with WriteOptions::no_slowdown set.</li>
</ul>
<h3 id="New-Features-14"><a href="#New-Features-14" class="headerlink" title="New Features"></a>New Features</h3><ul>
<li>Introduced CacheAllocator, which lets the user specify custom allocator for memory in block cache.</li>
</ul>
<h2 id="5-17-0-10-05-2018"><a href="#5-17-0-10-05-2018" class="headerlink" title="5.17.0 (10/05/2018)"></a>5.17.0 (10/05/2018)</h2><h3 id="Public-API-Change-17"><a href="#Public-API-Change-17" class="headerlink" title="Public API Change"></a>Public API Change</h3><ul>
<li><code>OnTableFileCreated</code> will now be called for empty files generated during compaction. In that case, <code>TableFileCreationInfo::file_path</code> will be “(nil)” and <code>TableFileCreationInfo::file_size</code> will be zero.</li>
<li>Add <code>FlushOptions::allow_write_stall</code>, which controls whether Flush calls start working immediately, even if it causes user writes to stall, or will wait until flush can be performed without causing write stall (similar to <code>CompactRangeOptions::allow_write_stall</code>). Note that the default value is false, meaning we add delay to Flush calls until stalling can be avoided when possible. This is behavior change compared to previous RocksDB versions, where Flush calls didn’t check if they might cause stall or not.</li>
<li>Application using PessimisticTransactionDB is expected to rollback/commit recovered transactions before starting new ones. This assumption is used to skip concurrency control during recovery.</li>
</ul>
<h1 id="5-16-6-10-24-2018"><a href="#5-16-6-10-24-2018" class="headerlink" title="5.16.6 (10/24/2018)"></a>5.16.6 (10/24/2018)</h1><h3 id="Bug-Fixes-43"><a href="#Bug-Fixes-43" class="headerlink" title="Bug Fixes"></a>Bug Fixes</h3><ul>
<li>Fix the bug that WriteBatchWithIndex’s SeekForPrev() doesn’t see the entries with the same key.</li>
</ul>
<h2 id="5-16-5-10-16-2018"><a href="#5-16-5-10-16-2018" class="headerlink" title="5.16.5 (10/16/2018)"></a>5.16.5 (10/16/2018)</h2><h3 id="Bug-Fixes-44"><a href="#Bug-Fixes-44" class="headerlink" title="Bug Fixes"></a>Bug Fixes</h3><ul>
<li>Fix slow flush/compaction when DB contains many snapshots. The problem became noticeable to us in DBs with 100,000+ snapshots, though it will affect others at different thresholds.</li>
<li>Properly set the stop key for a truncated manual CompactRange</li>
</ul>
<h2 id="5-16-4-10-10-2018"><a href="#5-16-4-10-10-2018" class="headerlink" title="5.16.4 (10/10/2018)"></a>5.16.4 (10/10/2018)</h2><h3 id="Bug-Fixes-45"><a href="#Bug-Fixes-45" class="headerlink" title="Bug Fixes"></a>Bug Fixes</h3><ul>
<li>Fix corner case where a write group leader blocked due to write stall blocks other writers in queue with WriteOptions::no_slowdown set.</li>
</ul>
<h2 id="5-16-3-10-1-2018"><a href="#5-16-3-10-1-2018" class="headerlink" title="5.16.3 (10/1/2018)"></a>5.16.3 (10/1/2018)</h2><h3 id="Bug-Fixes-46"><a href="#Bug-Fixes-46" class="headerlink" title="Bug Fixes"></a>Bug Fixes</h3><ul>
<li>Fix crash caused when <code>CompactFiles</code> run with <code>CompactionOptions::compression == CompressionType::kDisableCompressionOption</code>. Now that setting causes the compression type to be chosen according to the column family-wide compression options.</li>
</ul>
<h2 id="5-16-2-9-21-2018"><a href="#5-16-2-9-21-2018" class="headerlink" title="5.16.2 (9/21/2018)"></a>5.16.2 (9/21/2018)</h2><h3 id="Bug-Fixes-47"><a href="#Bug-Fixes-47" class="headerlink" title="Bug Fixes"></a>Bug Fixes</h3><ul>
<li>Fix bug in partition filters with format_version=4.</li>
</ul>
<h2 id="5-16-1-9-17-2018"><a href="#5-16-1-9-17-2018" class="headerlink" title="5.16.1 (9/17/2018)"></a>5.16.1 (9/17/2018)</h2><h3 id="Bug-Fixes-48"><a href="#Bug-Fixes-48" class="headerlink" title="Bug Fixes"></a>Bug Fixes</h3><ul>
<li>Remove trace_analyzer_tool from rocksdb_lib target in TARGETS file.</li>
<li>Fix RocksDB Java build and tests.</li>
<li>Remove sync point in Block destructor.</li>
</ul>
<h2 id="5-16-0-8-21-2018"><a href="#5-16-0-8-21-2018" class="headerlink" title="5.16.0 (8/21/2018)"></a>5.16.0 (8/21/2018)</h2><h3 id="Public-API-Change-18"><a href="#Public-API-Change-18" class="headerlink" title="Public API Change"></a>Public API Change</h3><ul>
<li><code>OnTableFileCreated</code> will now be called for empty files generated during compaction. In that case, <code>TableFileCreationInfo::file_path</code> will be “(nil)” and <code>TableFileCreationInfo::file_size</code> will be zero.</li>
<li>Add <code>FlushOptions::allow_write_stall</code>, which controls whether Flush calls start working immediately, even if it causes user writes to stall, or will wait until flush can be performed without causing write stall (similar to <code>CompactRangeOptions::allow_write_stall</code>). Note that the default value is false, meaning we add delay to Flush calls until stalling can be avoided when possible. This is behavior change compared to previous RocksDB versions, where Flush calls didn’t check if they might cause stall or not.</li>
<li>The merge operands are passed to <code>MergeOperator::ShouldMerge</code> in the reversed order relative to how they were merged (passed to FullMerge or FullMergeV2) for performance reasons</li>
<li>GetAllKeyVersions() to take an extra argument of <code>max_num_ikeys</code>.</li>
</ul>
<h3 id="New-Features-15"><a href="#New-Features-15" class="headerlink" title="New Features"></a>New Features</h3><ul>
<li>Changes the format of index blocks by delta encoding the index values, which are the block handles. This saves the encoding of BlockHandle::offset of the non-head index entries in each restart interval. The feature is backward compatible but not forward compatible. It is disabled by default unless format_version 4 or above is used.</li>
<li>Add a new tool: trace_analyzer. Trace_analyzer analyzes the trace file generated by using trace_replay API. It can convert the binary format trace file to a human readable txt file, output the statistics of the analyzed query types such as access statistics and size statistics, combining the dumped whole key space file to analyze, support query correlation analyzing, and etc. Current supported query types are: Get, Put, Delete, SingleDelete, DeleteRange, Merge, Iterator (Seek, SeekForPrev only).</li>
<li>Add hash index support to data blocks, which helps reducing the cpu utilization of point-lookup operations. This feature is backward compatible with the data block created without the hash index. It is disabled by default unless BlockBasedTableOptions::data_block_index_type is set to data_block_index_type = kDataBlockBinaryAndHash.</li>
</ul>
<h3 id="Bug-Fixes-49"><a href="#Bug-Fixes-49" class="headerlink" title="Bug Fixes"></a>Bug Fixes</h3><ul>
<li>Fix a bug in misreporting the estimated partition index size in properties block.</li>
<li>Avoid creating empty SSTs and subsequently deleting them in certain cases during compaction.</li>
</ul>
<h2 id="5-15-10-9-13-2018"><a href="#5-15-10-9-13-2018" class="headerlink" title="5.15.10 (9/13/2018)"></a>5.15.10 (9/13/2018)</h2><h3 id="Bug-Fixes-50"><a href="#Bug-Fixes-50" class="headerlink" title="Bug Fixes"></a>Bug Fixes</h3><ul>
<li>Fix RocksDB Java build and tests.</li>
</ul>
<h2 id="5-15-9-9-4-2018"><a href="#5-15-9-9-4-2018" class="headerlink" title="5.15.9 (9/4/2018)"></a>5.15.9 (9/4/2018)</h2><h3 id="Bug-Fixes-51"><a href="#Bug-Fixes-51" class="headerlink" title="Bug Fixes"></a>Bug Fixes</h3><ul>
<li>Fix compilation errors on OS X clang due to ‘-Wsuggest-override’.</li>
</ul>
<h2 id="5-15-8-8-31-2018"><a href="#5-15-8-8-31-2018" class="headerlink" title="5.15.8 (8/31/2018)"></a>5.15.8 (8/31/2018)</h2><h3 id="Bug-Fixes-52"><a href="#Bug-Fixes-52" class="headerlink" title="Bug Fixes"></a>Bug Fixes</h3><ul>
<li>Further avoid creating empty SSTs and subsequently deleting them during compaction.</li>
</ul>
<h2 id="5-15-7-8-24-2018"><a href="#5-15-7-8-24-2018" class="headerlink" title="5.15.7 (8/24/2018)"></a>5.15.7 (8/24/2018)</h2><h3 id="Bug-Fixes-53"><a href="#Bug-Fixes-53" class="headerlink" title="Bug Fixes"></a>Bug Fixes</h3><ul>
<li>Avoid creating empty SSTs and subsequently deleting them in certain cases during compaction.</li>
</ul>
<h2 id="5-15-6-8-21-2018"><a href="#5-15-6-8-21-2018" class="headerlink" title="5.15.6 (8/21/2018)"></a>5.15.6 (8/21/2018)</h2><h3 id="Public-API-Change-19"><a href="#Public-API-Change-19" class="headerlink" title="Public API Change"></a>Public API Change</h3><ul>
<li>The merge operands are passed to <code>MergeOperator::ShouldMerge</code> in the reversed order relative to how they were merged (passed to FullMerge or FullMergeV2) for performance reasons</li>
</ul>
<h2 id="5-15-5-8-16-2018"><a href="#5-15-5-8-16-2018" class="headerlink" title="5.15.5 (8/16/2018)"></a>5.15.5 (8/16/2018)</h2><h3 id="Bug-Fixes-54"><a href="#Bug-Fixes-54" class="headerlink" title="Bug Fixes"></a>Bug Fixes</h3><ul>
<li>Fix VerifyChecksum() API not preserving options</li>
</ul>
<h2 id="5-15-4-8-11-2018"><a href="#5-15-4-8-11-2018" class="headerlink" title="5.15.4 (8/11/2018)"></a>5.15.4 (8/11/2018)</h2><h3 id="Bug-Fixes-55"><a href="#Bug-Fixes-55" class="headerlink" title="Bug Fixes"></a>Bug Fixes</h3><ul>
<li>Fix a bug caused by not generating OnTableFileCreated() notification for a 0-byte SST.</li>
</ul>
<h2 id="5-15-3-8-10-2018"><a href="#5-15-3-8-10-2018" class="headerlink" title="5.15.3 (8/10/2018)"></a>5.15.3 (8/10/2018)</h2><h3 id="Bug-Fixes-56"><a href="#Bug-Fixes-56" class="headerlink" title="Bug Fixes"></a>Bug Fixes</h3><ul>
<li>Fix a bug in misreporting the estimated partition index size in properties block.</li>
</ul>
<h2 id="5-15-2-8-9-2018"><a href="#5-15-2-8-9-2018" class="headerlink" title="5.15.2 (8/9/2018)"></a>5.15.2 (8/9/2018)</h2><h3 id="Bug-Fixes-57"><a href="#Bug-Fixes-57" class="headerlink" title="Bug Fixes"></a>Bug Fixes</h3><ul>
<li>Return correct usable_size for BlockContents.</li>
</ul>
<h2 id="5-15-1-8-1-2018"><a href="#5-15-1-8-1-2018" class="headerlink" title="5.15.1 (8/1/2018)"></a>5.15.1 (8/1/2018)</h2><h3 id="Bug-Fixes-58"><a href="#Bug-Fixes-58" class="headerlink" title="Bug Fixes"></a>Bug Fixes</h3><ul>
<li>Prevent dereferencing invalid STL iterators when there are range tombstones in ingested files.</li>
</ul>
<h2 id="5-15-0-7-17-2018"><a href="#5-15-0-7-17-2018" class="headerlink" title="5.15.0 (7/17/2018)"></a>5.15.0 (7/17/2018)</h2><h3 id="Public-API-Change-20"><a href="#Public-API-Change-20" class="headerlink" title="Public API Change"></a>Public API Change</h3><ul>
<li>Remove managed iterator. ReadOptions.managed is not effective anymore.</li>
<li>For bottommost_compression, a compatible CompressionOptions is added via <code>bottommost_compression_opts</code>. To keep backward compatible, a new boolean <code>enabled</code> is added to CompressionOptions. For compression_opts, it will be always used no matter what value of <code>enabled</code> is. For bottommost_compression_opts, it will only be used when user set <code>enabled=true</code>, otherwise, compression_opts will be used for bottommost_compression as default.</li>
<li>With LRUCache, when high_pri_pool_ratio &gt; 0, midpoint insertion strategy will be enabled to put low-pri items to the tail of low-pri list (the midpoint) when they first inserted into the cache. This is to make cache entries never get hit age out faster, improving cache efficiency when large background scan presents.</li>
<li>For users of <code>Statistics</code> objects created via <code>CreateDBStatistics()</code>, the format of the string returned by its <code>ToString()</code> method has changed.</li>
<li>The “rocksdb.num.entries” table property no longer counts range deletion tombstones as entries.</li>
</ul>
<h3 id="New-Features-16"><a href="#New-Features-16" class="headerlink" title="New Features"></a>New Features</h3><ul>
<li>Changes the format of index blocks by storing the key in their raw form rather than converting them to InternalKey. This saves 8 bytes per index key. The feature is backward compatbile but not forward compatible. It is disabled by default unless format_version 3 or above is used.</li>
<li>Avoid memcpy when reading mmap files with OpenReadOnly and max_open_files==-1.</li>
<li>Support dynamically changing <code>ColumnFamilyOptions::ttl</code> via <code>SetOptions()</code>.</li>
<li>Add a new table property, “rocksdb.num.range-deletions”, which counts the number of range deletion tombstones in the table.</li>
<li>Improve the performance of iterators doing long range scans by using readahead, when using direct IO.</li>
<li>pin_top_level_index_and_filter (default true) in BlockBasedTableOptions can be used in combination with cache_index_and_filter_blocks to prefetch and pin the top-level index of partitioned index and filter blocks in cache. It has no impact when cache_index_and_filter_blocks is false.</li>
</ul>
<h3 id="Bug-Fixes-59"><a href="#Bug-Fixes-59" class="headerlink" title="Bug Fixes"></a>Bug Fixes</h3><ul>
<li>Fix deadlock with enable_pipelined_write=true and max_successive_merges &gt; 0</li>
<li>Check conflict at output level in CompactFiles.</li>
<li>Fix corruption in non-iterator reads when mmap is used for file reads</li>
<li>Fix bug with prefix search in partition filters where a shared prefix would be ignored from the later partitions. The bug could report an eixstent key as missing. The bug could be triggered if prefix_extractor is set and partition filters is enabled.</li>
<li>Change default value of <code>bytes_max_delete_chunk</code> to 0 in NewSstFileManager() as it doesn’t work well with checkpoints.</li>
<li>Fix a bug caused by not copying the block trailer with compressed SST file, direct IO, prefetcher and no compressed block cache.</li>
<li>Fix write can stuck indefinitely if enable_pipelined_write=true. The issue exists since pipelined write was introduced in 5.5.0.</li>
</ul>
<h2 id="5-14-3-8-21-2018"><a href="#5-14-3-8-21-2018" class="headerlink" title="5.14.3 (8/21/2018)"></a>5.14.3 (8/21/2018)</h2><h3 id="Public-API-Change-21"><a href="#Public-API-Change-21" class="headerlink" title="Public API Change"></a>Public API Change</h3><ul>
<li>The merge operands are passed to <code>MergeOperator::ShouldMerge</code> in the reversed order relative to how they were merged (passed to FullMerge or FullMergeV2) for performance reasons</li>
</ul>
<h3 id="Bug-Fixes-60"><a href="#Bug-Fixes-60" class="headerlink" title="Bug Fixes"></a>Bug Fixes</h3><ul>
<li>Fixes DBImpl::FindObsoleteFiles() calling GetChildren() on the same path</li>
</ul>
<h2 id="5-14-3-8-21-2018-1"><a href="#5-14-3-8-21-2018-1" class="headerlink" title="5.14.3 (8/21/2018)"></a>5.14.3 (8/21/2018)</h2><h3 id="Public-API-Change-22"><a href="#Public-API-Change-22" class="headerlink" title="Public API Change"></a>Public API Change</h3><ul>
<li>The merge operands are passed to <code>MergeOperator::ShouldMerge</code> in the reversed order relative to how they were merged (passed to FullMerge or FullMergeV2) for performance reasons</li>
</ul>
<h3 id="Bug-Fixes-61"><a href="#Bug-Fixes-61" class="headerlink" title="Bug Fixes"></a>Bug Fixes</h3><ul>
<li>Fixes DBImpl::FindObsoleteFiles() calling GetChildren() on the same path</li>
</ul>
<h2 id="5-14-2-7-3-2018"><a href="#5-14-2-7-3-2018" class="headerlink" title="5.14.2 (7/3/2018)"></a>5.14.2 (7/3/2018)</h2><h3 id="Bug-Fixes-62"><a href="#Bug-Fixes-62" class="headerlink" title="Bug Fixes"></a>Bug Fixes</h3><ul>
<li>Change default value of <code>bytes_max_delete_chunk</code> to 0 in NewSstFileManager() as it doesn’t work well with checkpoints.</li>
<li>Set DEBUG_LEVEL=0 for RocksJava Mac Release build.</li>
</ul>
<h2 id="5-14-1-6-20-2018"><a href="#5-14-1-6-20-2018" class="headerlink" title="5.14.1 (6/20/2018)"></a>5.14.1 (6/20/2018)</h2><h3 id="Bug-Fixes-63"><a href="#Bug-Fixes-63" class="headerlink" title="Bug Fixes"></a>Bug Fixes</h3><ul>
<li>Fix block-based table reader pinning blocks throughout its lifetime, causing memory usage increase.</li>
<li>Fix bug with prefix search in partition filters where a shared prefix would be ignored from the later partitions. The bug could report an eixstent key as missing. The bug could be triggered if prefix_extractor is set and partition filters is enabled.</li>
</ul>
<h2 id="5-14-0-5-16-2018"><a href="#5-14-0-5-16-2018" class="headerlink" title="5.14.0 (5/16/2018)"></a>5.14.0 (5/16/2018)</h2><h3 id="Public-API-Change-23"><a href="#Public-API-Change-23" class="headerlink" title="Public API Change"></a>Public API Change</h3><ul>
<li>Add a BlockBasedTableOption to align uncompressed data blocks on the smaller of block size or page size boundary, to reduce flash reads by avoiding reads spanning 4K pages.</li>
<li>The background thread naming convention changed (on supporting platforms) to “rocksdb:”, e.g., “rocksdb:low0”.</li>
<li>Add a new ticker stat rocksdb.number.multiget.keys.found to count number of keys successfully read in MultiGet calls</li>
<li>Touch-up to write-related counters in PerfContext. New counters added: write_scheduling_flushes_compactions_time, write_thread_wait_nanos. Counters whose behavior was fixed or modified: write_memtable_time, write_pre_and_post_process_time, write_delay_time.</li>
<li>Posix Env’s NewRandomRWFile() will fail if the file doesn’t exist.</li>
<li>Now, <code>DBOptions::use_direct_io_for_flush_and_compaction</code> only applies to background writes, and <code>DBOptions::use_direct_reads</code> applies to both user reads and background reads. This conforms with Linux’s <code>open(2)</code> manpage, which advises against simultaneously reading a file in buffered and direct modes, due to possibly undefined behavior and degraded performance.</li>
<li>Iterator::Valid() always returns false if !status().ok(). So, now when doing a Seek() followed by some Next()s, there’s no need to check status() after every operation.</li>
<li>Iterator::Seek()/SeekForPrev()/SeekToFirst()/SeekToLast() always resets status().</li>
</ul>
<h3 id="New-Features-17"><a href="#New-Features-17" class="headerlink" title="New Features"></a>New Features</h3><ul>
<li>Introduce TTL for level compaction so that all files older than ttl go through the compaction process to get rid of old data.</li>
<li>TransactionDBOptions::write_policy can be configured to enable WritePrepared 2PC transactions. Read more about them in the wiki.</li>
<li>Add DB properties “rocksdb.block-cache-capacity”, “rocksdb.block-cache-usage”, “rocksdb.block-cache-pinned-usage” to show block cache usage.</li>
<li>Add <code>Env::LowerThreadPoolCPUPriority(Priority)</code> method, which lowers the CPU priority of background (esp. compaction) threads to minimize interference with foreground tasks.</li>
<li>Fsync parent directory after deleting a file in delete scheduler.</li>
<li>In level-based compaction, if bottom-pri thread pool was setup via <code>Env::SetBackgroundThreads()</code>, compactions to the bottom level will be delegated to that thread pool.</li>
</ul>
<h3 id="Bug-Fixes-64"><a href="#Bug-Fixes-64" class="headerlink" title="Bug Fixes"></a>Bug Fixes</h3><ul>
<li>Fsync after writing global seq number to the ingestion file in ExternalSstFileIngestionJob.</li>
<li>Fix WAL corruption caused by race condition between user write thread and FlushWAL when two_write_queue is not set.</li>
<li>Fix <code>BackupableDBOptions::max_valid_backups_to_open</code> to not delete backup files when refcount cannot be accurately determined.</li>
<li>Fix memory leak when pin_l0_filter_and_index_blocks_in_cache is used with partitioned filters</li>
<li>Disable rollback of merge operands in WritePrepared transactions to work around an issue in MyRocks. It can be enabled back by setting TransactionDBOptions::rollback_merge_operands to true.</li>
<li>Fix bug with prefix search in partition filters where a shared prefix would be ignored from the later partitions. The bug could report an eixstent key as missing. The bug could be triggered if prefix_extractor is set and partition filters is enabled.</li>
</ul>
<h3 id="Java-API-Changes-1"><a href="#Java-API-Changes-1" class="headerlink" title="Java API Changes"></a>Java API Changes</h3><ul>
<li>Add <code>BlockBasedTableConfig.setBlockCache</code> to allow sharing a block cache across DB instances.</li>
<li>Added SstFileManager to the Java API to allow managing SST files across DB instances.</li>
</ul>
<h2 id="RocksDB-5-13-4"><a href="#RocksDB-5-13-4" class="headerlink" title="RocksDB 5.13.4"></a><a href="https://github.com/facebook/rocksdb/releases/tag/v5.13.4" target="_blank" rel="noopener">RocksDB 5.13.4</a></h2><p><a href="https://github.com/gfosco" target="_blank" rel="noopener"><img src="https://avatars2.githubusercontent.com/u/406732?s=40&v=4" alt="@gfosco"></a> <a href="https://github.com/gfosco" target="_blank" rel="noopener">gfosco</a> released this on 19 Jun 2018 · <a href="https://github.com/facebook/rocksdb/compare/v5.13.4...master" target="_blank" rel="noopener">2449 commits</a> to master since this release</p>
<h3 id="Bug-Fixes-65"><a href="#Bug-Fixes-65" class="headerlink" title="Bug Fixes"></a>Bug Fixes</h3><ul>
<li>Fix regression bug of Prev() with ReadOptions.iterate_upper_bound.</li>
</ul>
<h2 id="RocksDB-v5-12-5"><a href="#RocksDB-v5-12-5" class="headerlink" title="RocksDB v5.12.5"></a><a href="https://github.com/facebook/rocksdb/releases/tag/v5.12.5" target="_blank" rel="noopener">RocksDB v5.12.5</a></h2><p><a href="https://github.com/gfosco" target="_blank" rel="noopener"><img src="https://avatars2.githubusercontent.com/u/406732?s=40&v=4" alt="@gfosco"></a> <a href="https://github.com/gfosco" target="_blank" rel="noopener">gfosco</a> released this on 19 Jun 2018 · <a href="https://github.com/facebook/rocksdb/compare/v5.12.5...master" target="_blank" rel="noopener">2494 commits</a> to master since this release</p>
<h3 id="Bug-Fixes-66"><a href="#Bug-Fixes-66" class="headerlink" title="Bug Fixes"></a>Bug Fixes</h3><ul>
<li>Fix regression bug of Prev() with ReadOptions.iterate_upper_bound.</li>
</ul>
<h2 id="RocksDB-v5-13-3"><a href="#RocksDB-v5-13-3" class="headerlink" title="RocksDB v5.13.3"></a><a href="https://github.com/facebook/rocksdb/releases/tag/v5.13.3" target="_blank" rel="noopener">RocksDB v5.13.3</a></h2><p><a href="https://github.com/ajkr" target="_blank" rel="noopener"><img src="https://avatars1.githubusercontent.com/u/4780362?s=40&v=4" alt="@ajkr"></a> <a href="https://github.com/ajkr" target="_blank" rel="noopener">ajkr</a> released this on 8 Jun 2018 · <a href="https://github.com/facebook/rocksdb/compare/v5.13.3...5.13.fb" target="_blank" rel="noopener">8 commits</a> to 5.13.fb since this release</p>
<h2 id="5-13-3-6-6-2018"><a href="#5-13-3-6-6-2018" class="headerlink" title="5.13.3 (6/6/2018)"></a>5.13.3 (6/6/2018)</h2><h3 id="Bug-Fixes-67"><a href="#Bug-Fixes-67" class="headerlink" title="Bug Fixes"></a>Bug Fixes</h3><ul>
<li>Fix assertion when reading bloom filter of SST files containing range deletions but no data</li>
</ul>
<h2 id="RocksDB-v5-13-2"><a href="#RocksDB-v5-13-2" class="headerlink" title="RocksDB v5.13.2"></a><a href="https://github.com/facebook/rocksdb/releases/tag/v5.13.2" target="_blank" rel="noopener">RocksDB v5.13.2</a></h2><p><a href="https://github.com/gfosco" target="_blank" rel="noopener"><img src="https://avatars2.githubusercontent.com/u/406732?s=40&v=4" alt="@gfosco"></a> <a href="https://github.com/gfosco" target="_blank" rel="noopener">gfosco</a> released this on 26 May 2018 · <a href="https://github.com/facebook/rocksdb/compare/v5.13.2...master" target="_blank" rel="noopener">2449 commits</a> to master since this release</p>
<h2 id="5-13-2-5-25-2018"><a href="#5-13-2-5-25-2018" class="headerlink" title="5.13.2 (5/25/2018)"></a>5.13.2 (5/25/2018)</h2><h3 id="Public-API-Change-24"><a href="#Public-API-Change-24" class="headerlink" title="Public API Change"></a>Public API Change</h3><ul>
<li>Introduced <code>CompressionOptions::kDefaultCompressionLevel</code>, which is a generic way to tell RocksDB to use the compression library’s default level. It is now the default value for <code>CompressionOptions::level</code>. Previously the level defaulted to -1, which gave poor compression ratios in ZSTD.</li>
</ul>
<h3 id="Bug-Fixes-68"><a href="#Bug-Fixes-68" class="headerlink" title="Bug Fixes"></a>Bug Fixes</h3><ul>
<li>Fix segfault caused by object premature destruction (PR <a href="https://github.com/facebook/rocksdb/pull/3898" target="_blank" rel="noopener">#3898</a>)</li>
<li>Fix an issue with unnecessary capture in lambda expressions (PR <a href="https://github.com/facebook/rocksdb/pull/3904" target="_blank" rel="noopener">#3904</a>)<a href="https://github.com/facebook/rocksdb/releases/tag/v5.13.1" target="_blank" rel="noopener">https://github.com/facebook/rocksdb/releases/tag/v5.13.1</a>)</li>
</ul>
<h2 id="5-13-1-4-30-2018"><a href="#5-13-1-4-30-2018" class="headerlink" title="5.13.1 (4/30/2018)"></a>5.13.1 (4/30/2018)</h2><h3 id="New-Features-18"><a href="#New-Features-18" class="headerlink" title="New Features"></a>New Features</h3><ul>
<li>Add <code>Env::LowerThreadPoolCPUPriority(Priority)</code> method, which lowers the CPU priority of background (esp. compaction) threads to minimize interference with foreground tasks.</li>
<li>Eliminate use of temporary directories in BackupEngine to improve reliability on distributed file systems.</li>
</ul>
<h2 id="5-13-0-3-20-2018"><a href="#5-13-0-3-20-2018" class="headerlink" title="5.13.0 (3/20/2018)"></a>5.13.0 (3/20/2018)</h2><h3 id="Public-API-Change-25"><a href="#Public-API-Change-25" class="headerlink" title="Public API Change"></a>Public API Change</h3><ul>
<li>RocksDBOptionsParser::Parse()’s <code>ignore_unknown_options</code> argument will only be effective if the option file shows it is generated using a higher version of RocksDB than the current version.</li>
<li>Remove CompactionEventListener.</li>
</ul>
<h3 id="New-Features-19"><a href="#New-Features-19" class="headerlink" title="New Features"></a>New Features</h3><ul>
<li>SstFileManager now can cancel compactions if they will result in max space errors. SstFileManager users can also use SetCompactionBufferSize to specify how much space must be leftover during a compaction for auxiliary file functions such as logging and flushing.</li>
<li>Avoid unnecessarily flushing in <code>CompactRange()</code> when the range specified by the user does not overlap unflushed memtables.</li>
<li>If <code>ColumnFamilyOptions::max_subcompactions</code> is set greater than one, we now parallelize large manual level-based compactions.</li>
<li>Add “rocksdb.live-sst-files-size” DB property to return total bytes of all SST files belong to the latest LSM tree.</li>
</ul>
<h3 id="Bug-Fixes-69"><a href="#Bug-Fixes-69" class="headerlink" title="Bug Fixes"></a>Bug Fixes</h3><ul>
<li>Fix a leak in prepared_section_completed_ where the zeroed entries would not removed from the map.</li>
<li>Fix WAL corruption caused by race condition between user write thread and backup/checkpoint thread.</li>
<li>Fsync after writing global seq number to the ingestion file in ExternalSstFileIngestionJob.</li>
<li>Fix memory leak when pin_l0_filter_and_index_blocks_in_cache is used with partitioned filters</li>
</ul>
<h3 id="Java-API-Changes-2"><a href="#Java-API-Changes-2" class="headerlink" title="Java API Changes"></a>Java API Changes</h3><ul>
<li>Add <code>BlockBasedTableConfig.setBlockCache</code> to allow sharing a block cache across DB instances.</li>
</ul>
<p><a href="https://github.com/facebook/rocksdb/releases/tag/v5.12.4" target="_blank" rel="noopener">RocksDB 5.12.4</a></p>
<p><a href="https://github.com/gfosco" target="_blank" rel="noopener"><img src="https://avatars2.githubusercontent.com/u/406732?s=40&v=4" alt="@gfosco"></a> <a href="https://github.com/gfosco" target="_blank" rel="noopener">gfosco</a> released this on 24 Apr 2018 · <a href="https://github.com/facebook/rocksdb/compare/v5.12.4...master" target="_blank" rel="noopener">2494 commits</a> to master since this release</p>
<h2 id="5-12-4-4-23-2018"><a href="#5-12-4-4-23-2018" class="headerlink" title="5.12.4 (4/23/2018)"></a>5.12.4 (4/23/2018)</h2><h3 id="Bug-Fixes-70"><a href="#Bug-Fixes-70" class="headerlink" title="Bug Fixes"></a>Bug Fixes</h3><ul>
<li>Fix memory leak in two_level_iterator</li>
</ul>
<h2 id="5-12-3-4-23-2018"><a href="#5-12-3-4-23-2018" class="headerlink" title="5.12.3 (4/23/2018)"></a>5.12.3 (4/23/2018)</h2><h3 id="Bug-Fixes-71"><a href="#Bug-Fixes-71" class="headerlink" title="Bug Fixes"></a>Bug Fixes</h3><ul>
<li>Fix memory leak when pin_l0_filter_and_index_blocks_in_cache is used with partitioned filters</li>
</ul>
<h2 id="5-12-2-3-23-2018"><a href="#5-12-2-3-23-2018" class="headerlink" title="5.12.2 (3/23/2018)"></a>5.12.2 (3/23/2018)</h2><h3 id="Bug-Fixes-72"><a href="#Bug-Fixes-72" class="headerlink" title="Bug Fixes"></a>Bug Fixes</h3><ul>
<li>Fsync after writing global seq number to the ingestion file in ExternalSstFileIngestionJob.</li>
</ul>
<h3 id="Java-API-Changes-3"><a href="#Java-API-Changes-3" class="headerlink" title="Java API Changes"></a>Java API Changes</h3><ul>
<li>Add <code>BlockBasedTableConfig.setBlockCache</code> to allow sharing a block cache across DB instances.</li>
</ul>
<h2 id="5-12-1-3-16-2018"><a href="#5-12-1-3-16-2018" class="headerlink" title="5.12.1 (3/16/2018)"></a>5.12.1 (3/16/2018)</h2><h3 id="Public-API-Change-26"><a href="#Public-API-Change-26" class="headerlink" title="Public API Change"></a>Public API Change</h3><ul>
<li>RocksDBOptionsParser::Parse()’s <code>ignore_unknown_options</code> argument will only be effective if the option file shows it is generated using a higher version of RocksDB than the current version.</li>
</ul>
<h3 id="New-Features-20"><a href="#New-Features-20" class="headerlink" title="New Features"></a>New Features</h3><ul>
<li>Avoid unnecessarily flushing in <code>CompactRange()</code> when the range specified by the user does not overlap unflushed memtables.</li>
</ul>
<h3 id="Bug-Fixes-73"><a href="#Bug-Fixes-73" class="headerlink" title="Bug Fixes"></a>Bug Fixes</h3><ul>
<li>Fix WAL corruption caused by race condition between user write thread and backup/checkpoint thread.</li>
</ul>
<h2 id="5-12-0-2-14-2018"><a href="#5-12-0-2-14-2018" class="headerlink" title="5.12.0 (2/14/2018)"></a>5.12.0 (2/14/2018)</h2><h3 id="Public-API-Change-27"><a href="#Public-API-Change-27" class="headerlink" title="Public API Change"></a>Public API Change</h3><ul>
<li>Iterator::SeekForPrev is now a pure virtual method. This is to prevent user who implement the Iterator interface fail to implement SeekForPrev by mistake.</li>
<li>Add <code>include_end</code> option to make the range end exclusive when <code>include_end == false</code> in <code>DeleteFilesInRange()</code>.</li>
<li>Add <code>CompactRangeOptions::allow_write_stall</code>, which makes <code>CompactRange</code> start working immediately, even if it causes user writes to stall. The default value is false, meaning we add delay to <code>CompactRange</code> calls until stalling can be avoided when possible. Note this delay is not present in previous RocksDB versions.</li>
<li>Creating checkpoint with empty directory now returns <code>Status::InvalidArgument</code>; previously, it returned <code>Status::IOError</code>.</li>
<li>Adds a BlockBasedTableOption to turn off index block compression.</li>
<li>Close() method now returns a status when closing a db.</li>
</ul>
<h3 id="New-Features-21"><a href="#New-Features-21" class="headerlink" title="New Features"></a>New Features</h3><ul>
<li>Improve the performance of iterators doing long range scans by using readahead.</li>
<li>Add new function <code>DeleteFilesInRanges()</code> to delete files in multiple ranges at once for better performance.</li>
<li>FreeBSD build support for RocksDB and RocksJava.</li>
<li>Improved performance of long range scans with readahead.</li>
<li>Updated to and now continuously tested in Visual Studio 2017.</li>
</ul>
<h3 id="Bug-Fixes-74"><a href="#Bug-Fixes-74" class="headerlink" title="Bug Fixes"></a>Bug Fixes</h3><ul>
<li>Fix <code>DisableFileDeletions()</code> followed by <code>GetSortedWalFiles()</code> to not return obsolete WAL files that <code>PurgeObsoleteFiles()</code> is going to delete.</li>
<li>Fix Handle error return from WriteBuffer() during WAL file close and DB close.</li>
<li>Fix advance reservation of arena block addresses.</li>
<li>Fix handling of empty string as checkpoint directory.</li>
</ul>
<h2 id="5-12-2-3-23-2018-1"><a href="#5-12-2-3-23-2018-1" class="headerlink" title="5.12.2 (3/23/2018)"></a>5.12.2 (3/23/2018)</h2><h3 id="Bug-Fixes-75"><a href="#Bug-Fixes-75" class="headerlink" title="Bug Fixes"></a>Bug Fixes</h3><ul>
<li>Fsync after writing global seq number to the ingestion file in ExternalSstFileIngestionJob.</li>
</ul>
<h3 id="Java-API-Changes-4"><a href="#Java-API-Changes-4" class="headerlink" title="Java API Changes"></a>Java API Changes</h3><ul>
<li>Add <code>BlockBasedTableConfig.setBlockCache</code> to allow sharing a block cache across DB instances.</li>
</ul>
<h2 id="5-12-1-3-16-2018-1"><a href="#5-12-1-3-16-2018-1" class="headerlink" title="5.12.1 (3/16/2018)"></a>5.12.1 (3/16/2018)</h2><h3 id="Public-API-Change-28"><a href="#Public-API-Change-28" class="headerlink" title="Public API Change"></a>Public API Change</h3><ul>
<li>RocksDBOptionsParser::Parse()’s <code>ignore_unknown_options</code> argument will only be effective if the option file shows it is generated using a higher version of RocksDB than the current version.</li>
</ul>
<h3 id="New-Features-22"><a href="#New-Features-22" class="headerlink" title="New Features"></a>New Features</h3><ul>
<li>Avoid unnecessarily flushing in <code>CompactRange()</code> when the range specified by the user does not overlap unflushed memtables.</li>
</ul>
<h3 id="Bug-Fixes-76"><a href="#Bug-Fixes-76" class="headerlink" title="Bug Fixes"></a>Bug Fixes</h3><ul>
<li>Fix WAL corruption caused by race condition between user write thread and backup/checkpoint thread.</li>
</ul>
<h2 id="5-12-0-2-14-2018-1"><a href="#5-12-0-2-14-2018-1" class="headerlink" title="5.12.0 (2/14/2018)"></a>5.12.0 (2/14/2018)</h2><h3 id="Public-API-Change-29"><a href="#Public-API-Change-29" class="headerlink" title="Public API Change"></a>Public API Change</h3><ul>
<li>Iterator::SeekForPrev is now a pure virtual method. This is to prevent user who implement the Iterator interface fail to implement SeekForPrev by mistake.</li>
<li>Add <code>include_end</code> option to make the range end exclusive when <code>include_end == false</code> in <code>DeleteFilesInRange()</code>.</li>
<li>Add <code>CompactRangeOptions::allow_write_stall</code>, which makes <code>CompactRange</code> start working immediately, even if it causes user writes to stall. The default value is false, meaning we add delay to <code>CompactRange</code> calls until stalling can be avoided when possible. Note this delay is not present in previous RocksDB versions.</li>
<li>Creating checkpoint with empty directory now returns <code>Status::InvalidArgument</code>; previously, it returned <code>Status::IOError</code>.</li>
<li>Adds a BlockBasedTableOption to turn off index block compression.</li>
<li>Close() method now returns a status when closing a db.</li>
</ul>
<h3 id="New-Features-23"><a href="#New-Features-23" class="headerlink" title="New Features"></a>New Features</h3><ul>
<li>Improve the performance of iterators doing long range scans by using readahead.</li>
<li>Add new function <code>DeleteFilesInRanges()</code> to delete files in multiple ranges at once for better performance.</li>
<li>FreeBSD build support for RocksDB and RocksJava.</li>
<li>Improved performance of long range scans with readahead.</li>
<li>Updated to and now continuously tested in Visual Studio 2017.</li>
</ul>
<h3 id="Bug-Fixes-77"><a href="#Bug-Fixes-77" class="headerlink" title="Bug Fixes"></a>Bug Fixes</h3><ul>
<li>Fix <code>DisableFileDeletions()</code> followed by <code>GetSortedWalFiles()</code> to not return obsolete WAL files that <code>PurgeObsoleteFiles()</code> is going to delete.</li>
<li>Fix Handle error return from WriteBuffer() during WAL file close and DB close.</li>
<li>Fix advance reservation of arena block addresses.</li>
<li>Fix handling of empty string as checkpoint directory.</li>
</ul>
<h2 id="5-11-2-02-24-2018"><a href="#5-11-2-02-24-2018" class="headerlink" title="5.11.2 (02/24/2018)"></a>5.11.2 (02/24/2018)</h2><h3 id="Bug-Fixes-78"><a href="#Bug-Fixes-78" class="headerlink" title="Bug Fixes"></a>Bug Fixes</h3><ul>
<li>Fix bug in iterator readahead causing blocks to incorrectly be considered truncated (corrupted).</li>
</ul>
<h2 id="5-11-1-02-22-2018"><a href="#5-11-1-02-22-2018" class="headerlink" title="5.11.1 (02/22/2018)"></a>5.11.1 (02/22/2018)</h2><h3 id="New-Features-24"><a href="#New-Features-24" class="headerlink" title="New Features"></a>New Features</h3><ul>
<li>Follow rsync-style naming convention for BackupEngine tempfiles. This enables some optimizations when run on GlusterFS.</li>
</ul>
<h2 id="5-11-0-01-08-2018"><a href="#5-11-0-01-08-2018" class="headerlink" title="5.11.0 (01/08/2018)"></a>5.11.0 (01/08/2018)</h2><h3 id="Public-API-Change-30"><a href="#Public-API-Change-30" class="headerlink" title="Public API Change"></a>Public API Change</h3><ul>
<li>Add <code>autoTune</code> and <code>getBytesPerSecond()</code> to RocksJava RateLimiter</li>
</ul>
<h3 id="New-Features-25"><a href="#New-Features-25" class="headerlink" title="New Features"></a>New Features</h3><ul>
<li>Add a new histogram stat called rocksdb.db.flush.micros for memtable flush.</li>
<li>Add “–use_txn” option to use transactional API in db_stress.</li>
<li>Disable onboard cache for compaction output in Windows platform.</li>
<li>Improve the performance of iterators doing long range scans by using readahead.</li>
</ul>
<h3 id="Bug-Fixes-79"><a href="#Bug-Fixes-79" class="headerlink" title="Bug Fixes"></a>Bug Fixes</h3><ul>
<li>Fix a stack-use-after-scope bug in ForwardIterator.</li>
<li>Fix builds on platforms including Linux, Windows, and PowerPC.</li>
<li>Fix buffer overrun in backup engine for DBs with huge number of files.</li>
<li>Fix a mislabel bug for bottom-pri compaction threads.</li>
<li>Fix DB::Flush() keep waiting after flush finish under certain condition.</li>
</ul>
<h2 id="5-10-4-02-22-2018"><a href="#5-10-4-02-22-2018" class="headerlink" title="5.10.4 (02/22/2018)"></a>5.10.4 (02/22/2018)</h2><h3 id="New-Features-26"><a href="#New-Features-26" class="headerlink" title="New Features"></a>New Features</h3><ul>
<li>Follow rsync-style naming convention for BackupEngine tempfiles. This enables some optimizations when run on GlusterFS.</li>
</ul>
<h3 id="Bug-fixes"><a href="#Bug-fixes" class="headerlink" title="Bug fixes"></a>Bug fixes</h3><ul>
<li>Fix regression of Java build break on Windows.</li>
</ul>
<h2 id="5-10-3-02-21-2018"><a href="#5-10-3-02-21-2018" class="headerlink" title="5.10.3 (02/21/2018)"></a>5.10.3 (02/21/2018)</h2><h3 id="Bug-fixes-1"><a href="#Bug-fixes-1" class="headerlink" title="Bug fixes"></a>Bug fixes</h3><ul>
<li>Fix build break regression using gcc-7</li>
<li>Direct I/O writable file should do fsync in Close()</li>
</ul>
<h3 id="New-Features-27"><a href="#New-Features-27" class="headerlink" title="New Features"></a>New Features</h3><ul>
<li>Add rocksdb.iterator.internal-key property</li>
</ul>
<h2 id="5-10-1-01-18-2018"><a href="#5-10-1-01-18-2018" class="headerlink" title="5.10.1 (01/18/2018)"></a>5.10.1 (01/18/2018)</h2><h3 id="Bug-Fixes-80"><a href="#Bug-Fixes-80" class="headerlink" title="Bug Fixes"></a>Bug Fixes</h3><ul>
<li>Fix DB::Flush() keep waiting after flush finish under certain condition.</li>
</ul>
<h2 id="5-10-0-12-11-2017"><a href="#5-10-0-12-11-2017" class="headerlink" title="5.10.0 (12/11/2017)"></a>5.10.0 (12/11/2017)</h2><h3 id="Public-API-Change-31"><a href="#Public-API-Change-31" class="headerlink" title="Public API Change"></a>Public API Change</h3><ul>
<li>When running <code>make</code> with environment variable <code>USE_SSE</code> set and <code>PORTABLE</code> unset, will use all machine features available locally. Previously this combination only compiled SSE-related features.</li>
</ul>
<h3 id="New-Features-28"><a href="#New-Features-28" class="headerlink" title="New Features"></a>New Features</h3><ul>
<li>CRC32C is now using the 3-way pipelined SSE algorithm <code>crc32c_3way</code> on supported platforms to improve performance. The system will choose to use this algorithm on supported platforms automatically whenever possible. If PCLMULQDQ is not supported it will fall back to the old Fast_CRC32 algorithm.</li>
<li>Provide lifetime hints when writing files on Linux. This reduces hardware write-amp on storage devices supporting multiple streams.</li>
<li>Add a DB stat, <code>NUMBER_ITER_SKIP</code>, which returns how many internal keys were skipped during iterations (e.g., due to being tombstones or duplicate versions of a key).</li>
<li>Add PerfContext counters, <code>key_lock_wait_count</code> and <code>key_lock_wait_time</code>, which measure the number of times transactions wait on key locks and total amount of time waiting.</li>
</ul>
<h3 id="Bug-Fixes-81"><a href="#Bug-Fixes-81" class="headerlink" title="Bug Fixes"></a>Bug Fixes</h3><ul>
<li>Fix IOError on WAL write doesn’t propagate to write group follower</li>
<li>Make iterator invalid on merge error.</li>
<li>Fix performance issue in <code>IngestExternalFile()</code> affecting databases with large number of SST files.</li>
<li>Fix possible corruption to LSM structure when <code>DeleteFilesInRange()</code> deletes a subset of files spanned by a <code>DeleteRange()</code> marker.</li>
</ul>
<h2 id="5-10-3-02-21-2018-1"><a href="#5-10-3-02-21-2018-1" class="headerlink" title="5.10.3 (02/21/2018)"></a>5.10.3 (02/21/2018)</h2><h3 id="Bug-fixes-2"><a href="#Bug-fixes-2" class="headerlink" title="Bug fixes"></a>Bug fixes</h3><ul>
<li>Fix build break regression using gcc-7</li>
<li>Direct I/O writable file should do fsync in Close()</li>
</ul>
<h3 id="New-Features-29"><a href="#New-Features-29" class="headerlink" title="New Features"></a>New Features</h3><ul>
<li>Add rocksdb.iterator.internal-key property</li>
</ul>
<h2 id="5-10-1-01-18-2018-1"><a href="#5-10-1-01-18-2018-1" class="headerlink" title="5.10.1 (01/18/2018)"></a>5.10.1 (01/18/2018)</h2><h3 id="Bug-Fixes-82"><a href="#Bug-Fixes-82" class="headerlink" title="Bug Fixes"></a>Bug Fixes</h3><ul>
<li>Fix DB::Flush() keep waiting after flush finish under certain condition.</li>
</ul>
<h2 id="5-10-0-12-11-2017-1"><a href="#5-10-0-12-11-2017-1" class="headerlink" title="5.10.0 (12/11/2017)"></a>5.10.0 (12/11/2017)</h2><h3 id="Public-API-Change-32"><a href="#Public-API-Change-32" class="headerlink" title="Public API Change"></a>Public API Change</h3><ul>
<li>When running <code>make</code> with environment variable <code>USE_SSE</code> set and <code>PORTABLE</code> unset, will use all machine features available locally. Previously this combination only compiled SSE-related features.</li>
</ul>
<h3 id="New-Features-30"><a href="#New-Features-30" class="headerlink" title="New Features"></a>New Features</h3><ul>
<li>CRC32C is now using the 3-way pipelined SSE algorithm <code>crc32c_3way</code> on supported platforms to improve performance. The system will choose to use this algorithm on supported platforms automatically whenever possible. If PCLMULQDQ is not supported it will fall back to the old Fast_CRC32 algorithm.</li>
<li>Provide lifetime hints when writing files on Linux. This reduces hardware write-amp on storage devices supporting multiple streams.</li>
<li>Add a DB stat, <code>NUMBER_ITER_SKIP</code>, which returns how many internal keys were skipped during iterations (e.g., due to being tombstones or duplicate versions of a key).</li>
<li>Add PerfContext counters, <code>key_lock_wait_count</code> and <code>key_lock_wait_time</code>, which measure the number of times transactions wait on key locks and total amount of time waiting.</li>
</ul>
<h3 id="Bug-Fixes-83"><a href="#Bug-Fixes-83" class="headerlink" title="Bug Fixes"></a>Bug Fixes</h3><ul>
<li>Fix IOError on WAL write doesn’t propagate to write group follower</li>
<li>Make iterator invalid on merge error.</li>
<li>Fix performance issue in <code>IngestExternalFile()</code> affecting databases with large number of SST files.</li>
<li>Fix possible corruption to LSM structure when <code>DeleteFilesInRange()</code> deletes a subset of files spanned by a <code>DeleteRange()</code> marker.</li>
</ul>
<h2 id="RocksDB-5-9-2"><a href="#RocksDB-5-9-2" class="headerlink" title="RocksDB 5.9.2"></a><a href="https://github.com/facebook/rocksdb/releases/tag/rocksdb-5.9.2" target="_blank" rel="noopener">RocksDB 5.9.2</a></h2><p><a href="https://github.com/ajkr" target="_blank" rel="noopener"><img src="https://avatars1.githubusercontent.com/u/4780362?s=40&v=4" alt="@ajkr"></a> <a href="https://github.com/ajkr" target="_blank" rel="noopener">ajkr</a> released this on 19 Dec 2017 · <a href="https://github.com/facebook/rocksdb/compare/rocksdb-5.9.2...5.9.fb" target="_blank" rel="noopener">6 commits</a> to 5.9.fb since this release</p>
<h3 id="Public-API-Change-33"><a href="#Public-API-Change-33" class="headerlink" title="Public API Change"></a>Public API Change</h3><ul>
<li><code>BackupableDBOptions::max_valid_backups_to_open == 0</code> now means no backups will be opened during BackupEngine initialization. Previously this condition disabled limiting backups opened.</li>
<li><code>DBOptions::preserve_deletes</code> is a new option that allows one to specify that DB should not drop tombstones for regular deletes if they have sequence number larger than what was set by the new API call <code>DB::SetPreserveDeletesSequenceNumber(SequenceNumber seqnum)</code>. Disabled by default.</li>
<li>API call <code>DB::SetPreserveDeletesSequenceNumber(SequenceNumber seqnum)</code> was added, users who wish to preserve deletes are expected to periodically call this function to advance the cutoff seqnum (all deletes made before this seqnum can be dropped by DB). It’s user responsibility to figure out how to advance the seqnum in the way so the tombstones are kept for the desired period of time, yet are eventually processed in time and don’t eat up too much space.</li>
<li><code>ReadOptions::iter_start_seqnum</code> was added; if set to something &gt; 0 user will see 2 changes in iterators behavior 1) only keys written with sequence larger than this parameter would be returned and 2) the <code>Slice</code> returned by iter-&gt;key() now points to the the memory that keep User-oriented representation of the internal key, rather than user key. New struct <code>FullKey</code> was added to represent internal keys, along with a new helper function <code>ParseFullKey(const Slice&amp; internal_key, FullKey* result);</code>.</li>
<li>Deprecate trash_dir param in NewSstFileManager, right now we will rename deleted files to .trash instead of moving them to trash directory</li>
<li>Return an error on write if write_options.sync = true and write_options.disableWAL = true to warn user of inconsistent options. Previously we will not write to WAL and not respecting the sync options in this case.</li>
</ul>
<h3 id="New-Features-31"><a href="#New-Features-31" class="headerlink" title="New Features"></a>New Features</h3><ul>
<li><code>DBOptions::writable_file_max_buffer_size</code> can now be changed dynamically.</li>
<li><code>DBOptions::bytes_per_sync</code> and <code>DBOptions::wal_bytes_per_sync</code> can now be changed dynamically, <code>DBOptions::wal_bytes_per_sync</code> will flush all memtables and switch to a new WAL file.</li>
<li>Support dynamic adjustment of rate limit according to demand for background I/O. It can be enabled by passing <code>true</code> to the <code>auto_tuned</code> parameter in <code>NewGenericRateLimiter()</code>. The value passed as <code>rate_bytes_per_sec</code> will still be respected as an upper-bound.</li>
<li>Support dynamically changing <code>ColumnFamilyOptions::compaction_options_fifo</code>.</li>
<li>Introduce <code>EventListener::OnStallConditionsChanged()</code> callback. Users can implement it to be notified when user writes are stalled, stopped, or resumed.</li>
<li>Add a new db property “rocksdb.estimate-oldest-key-time” to return oldest data timestamp. The property is available only for FIFO compaction with compaction_options_fifo.allow_compaction = false.</li>
<li>Upon snapshot release, recompact bottommost files containing deleted/overwritten keys that previously could not be dropped due to the snapshot. This alleviates space-amp caused by long-held snapshots.</li>
<li>Support lower bound on iterators specified via <code>ReadOptions::iterate_lower_bound</code>.</li>
<li>Support for differential snapshots (via iterator emitting the sequence of key-values representing the difference between DB state at two different sequence numbers). Supports preserving and emitting puts and regular deletes, doesn’t support SingleDeletes, MergeOperator, Blobs and Range Deletes.</li>
</ul>
<h3 id="Bug-Fixes-84"><a href="#Bug-Fixes-84" class="headerlink" title="Bug Fixes"></a>Bug Fixes</h3><ul>
<li>Fix a potential data inconsistency issue during point-in-time recovery. <code>DB:Open()</code> will abort if column family inconsistency is found during PIT recovery.</li>
<li>Fix possible metadata corruption in databases using <code>DeleteRange()</code>.</li>
<li>Fix IOError on WAL write doesn’t propagate to write group follower</li>
<li>Fix calculating filter partition target size</li>
<li>Fix possible corruption to LSM structure when <code>DeleteFilesInRange()</code> deletes a subset of files spanned by a <code>DeleteRange()</code> marker.</li>
</ul>
<h2 id="RocksDB-5-8-8"><a href="#RocksDB-5-8-8" class="headerlink" title="RocksDB 5.8.8"></a><a href="https://github.com/facebook/rocksdb/releases/tag/rocksdb-5.8.8" target="_blank" rel="noopener">RocksDB 5.8.8</a></h2><p><a href="https://github.com/ajkr" target="_blank" rel="noopener"><img src="https://avatars1.githubusercontent.com/u/4780362?s=40&v=4" alt="@ajkr"></a> <a href="https://github.com/ajkr" target="_blank" rel="noopener">ajkr</a> released this on 7 Dec 2017 · <a href="https://github.com/facebook/rocksdb/compare/rocksdb-5.8.8...5.8.fb" target="_blank" rel="noopener">3 commits</a> to 5.8.fb since this release</p>
<h3 id="Bug-Fixes-85"><a href="#Bug-Fixes-85" class="headerlink" title="Bug Fixes"></a>Bug Fixes</h3><ul>
<li>Fix possible corruption to LSM structure when <code>DeleteFilesInRange()</code> deletes a subset of files spanned by a <code>DeleteRange()</code> marker.</li>
</ul>
<h2 id="RocksDB-5-8-7"><a href="#RocksDB-5-8-7" class="headerlink" title="RocksDB 5.8.7"></a><a href="https://github.com/facebook/rocksdb/releases/tag/rocksdb-5.8.7" target="_blank" rel="noopener">RocksDB 5.8.7</a></h2><p><a href="https://github.com/yiwu-arbug" target="_blank" rel="noopener"><img src="https://avatars1.githubusercontent.com/u/2606959?s=40&v=4" alt="@yiwu-arbug"></a> <a href="https://github.com/yiwu-arbug" target="_blank" rel="noopener">yiwu-arbug</a> released this on 29 Nov 2017 · <a href="https://github.com/facebook/rocksdb/compare/rocksdb-5.8.7...5.8.fb" target="_blank" rel="noopener">6 commits</a> to 5.8.fb since this release</p>
<h3 id="Bug-Fixes-86"><a href="#Bug-Fixes-86" class="headerlink" title="Bug Fixes"></a>Bug Fixes</h3><ul>
<li>Fix IOError on WAL write doesn’t propagate to write group follower</li>
</ul>
<h2 id="RocksDB-5-7-5"><a href="#RocksDB-5-7-5" class="headerlink" title="RocksDB 5.7.5"></a><a href="https://github.com/facebook/rocksdb/releases/tag/rocksdb-5.7.5" target="_blank" rel="noopener">RocksDB 5.7.5</a></h2><p><a href="https://github.com/yiwu-arbug" target="_blank" rel="noopener"><img src="https://avatars1.githubusercontent.com/u/2606959?s=40&v=4" alt="@yiwu-arbug"></a> <a href="https://github.com/yiwu-arbug" target="_blank" rel="noopener">yiwu-arbug</a> released this on 29 Nov 2017 · <a href="https://github.com/facebook/rocksdb/compare/rocksdb-5.7.5...5.7.fb" target="_blank" rel="noopener">4 commits</a> to 5.7.fb since this release</p>
<h3 id="Bug-Fixes-87"><a href="#Bug-Fixes-87" class="headerlink" title="Bug Fixes"></a>Bug Fixes</h3><ul>
<li>Fix IOError on WAL write doesn’t propagate to write group follower</li>
</ul>
<h2 id="5-8-6-11-20-2017"><a href="#5-8-6-11-20-2017" class="headerlink" title="5.8.6 (11/20/2017)"></a>5.8.6 (11/20/2017)</h2><h3 id="Bug-Fixes-88"><a href="#Bug-Fixes-88" class="headerlink" title="Bug Fixes"></a>Bug Fixes</h3><ul>
<li>Fixed aligned_alloc issues with Windows.</li>
</ul>
<h2 id="5-8-1-10-23-2017"><a href="#5-8-1-10-23-2017" class="headerlink" title="5.8.1 (10/23/2017)"></a>5.8.1 (10/23/2017)</h2><h3 id="New-Features-32"><a href="#New-Features-32" class="headerlink" title="New Features"></a>New Features</h3><ul>
<li>Add a new db property “rocksdb.estimate-oldest-key-time” to return oldest data timestamp. The property is available only for FIFO compaction with compaction_options_fifo.allow_compaction = false.</li>
</ul>
<h2 id="5-8-6-11-20-2017-1"><a href="#5-8-6-11-20-2017-1" class="headerlink" title="5.8.6 (11/20/2017)"></a>5.8.6 (11/20/2017)</h2><h3 id="Bug-Fixes-89"><a href="#Bug-Fixes-89" class="headerlink" title="Bug Fixes"></a>Bug Fixes</h3><ul>
<li>Fixed aligned_alloc issues with Windows.</li>
</ul>
<h2 id="5-8-1-10-23-2017-1"><a href="#5-8-1-10-23-2017-1" class="headerlink" title="5.8.1 (10/23/2017)"></a>5.8.1 (10/23/2017)</h2><h3 id="New-Features-33"><a href="#New-Features-33" class="headerlink" title="New Features"></a>New Features</h3><ul>
<li>Add a new db property “rocksdb.estimate-oldest-key-time” to return oldest data timestamp. The property is available only for FIFO compaction with compaction_options_fifo.allow_compaction = false.</li>
</ul>
<h2 id="5-8-09-28-2017"><a href="#5-8-09-28-2017" class="headerlink" title="5.8 (09/28/2017)"></a>5.8 (09/28/2017)</h2><h3 id="Public-API-Change-34"><a href="#Public-API-Change-34" class="headerlink" title="Public API Change"></a>Public API Change</h3><ul>
<li>Users of Statistics::getHistogramString() will see fewer histogram buckets and different bucket endpoints.</li>
<li>Slice::compare and BytewiseComparator Compare no longer accept Slices containing nullptr.</li>
<li>Transaction::Get and Transaction::GetForUpdate variants with PinnableSlice added.</li>
</ul>
<h3 id="New-Features-34"><a href="#New-Features-34" class="headerlink" title="New Features"></a>New Features</h3><ul>
<li>Add Iterator::Refresh(), which allows users to update the iterator state so that they can avoid some initialization costs of recreating iterators.</li>
<li>Replace dynamic_cast&lt;&gt; (except unit test) so people can choose to build with RTTI off. With make, release mode is by default built with -fno-rtti and debug mode is built without it. Users can override it by setting USE_RTTI=0 or 1.</li>
<li>Universal compactions including the bottom level can be executed in a dedicated thread pool. This alleviates head-of-line blocking in the compaction queue, which cause write stalling, particularly in multi-instance use cases. Users can enable this feature via Env::SetBackgroundThreads(N, Env::Priority::BOTTOM), where N &gt; 0.</li>
<li>Allow merge operator to be called even with a single merge operand during compactions, by appropriately overriding MergeOperator::AllowSingleOperand.</li>
<li>Add DB::VerifyChecksum(), which verifies the checksums in all SST files in a running DB.<br>Block-based table support for disabling checksums by setting BlockBasedTableOptions::checksum = kNoChecksum.</li>
</ul>
<h3 id="Bug-Fixes-90"><a href="#Bug-Fixes-90" class="headerlink" title="Bug Fixes"></a>Bug Fixes</h3><ul>
<li>Fix wrong latencies in rocksdb.db.get.micros, rocksdb.db.write.micros, and rocksdb.sst.read.micros.</li>
<li>Fix incorrect dropping of deletions during intra-L0 compaction.</li>
<li>Fix transient reappearance of keys covered by range deletions when memtable prefix bloom filter is enabled.</li>
<li>Fix potentially wrong file smallest key when range deletions separated by snapshot are written together.</li>
</ul>
<h2 id="5-7-3-08-29-2017"><a href="#5-7-3-08-29-2017" class="headerlink" title="5.7.3 (08/29/2017)"></a>5.7.3 (08/29/2017)</h2><h3 id="Bug-Fixes-91"><a href="#Bug-Fixes-91" class="headerlink" title="Bug Fixes"></a>Bug Fixes</h3><ul>
<li>Fix transient reappearance of keys covered by range deletions when memtable prefix bloom filter is enabled.</li>
<li>Fix potentially wrong file smallest key when range deletions separated by snapshot are written together.</li>
</ul>
<h2 id="5-7-3-08-29-2017-1"><a href="#5-7-3-08-29-2017-1" class="headerlink" title="5.7.3 (08/29/2017)"></a>5.7.3 (08/29/2017)</h2><h3 id="Bug-Fixes-92"><a href="#Bug-Fixes-92" class="headerlink" title="Bug Fixes"></a>Bug Fixes</h3><ul>
<li>Fix transient reappearance of keys covered by range deletions when memtable prefix bloom filter is enabled.</li>
<li>Fix potentially wrong file smallest key when range deletions separated by snapshot are written together.</li>
</ul>
<h2 id="v5-7-2"><a href="#v5-7-2" class="headerlink" title="v5.7.2"></a><a href="https://github.com/facebook/rocksdb/releases/tag/v5.7.2" target="_blank" rel="noopener">v5.7.2</a></h2><p><a href="https://github.com/yiwu-arbug" target="_blank" rel="noopener"><img src="https://avatars1.githubusercontent.com/u/2606959?s=40&v=4" alt="@yiwu-arbug"></a> <a href="https://github.com/yiwu-arbug" target="_blank" rel="noopener">yiwu-arbug</a> released this on 16 Aug 2017 · <a href="https://github.com/facebook/rocksdb/compare/v5.7.2...5.7.fb" target="_blank" rel="noopener">23 commits</a> to 5.7.fb since this release</p>
<h3 id="Bug-Fixes-93"><a href="#Bug-Fixes-93" class="headerlink" title="Bug Fixes"></a>Bug Fixes</h3><ul>
<li>Fix incorrect dropping of deletions issue with FIFO compaction.</li>
<li>Fix LITE build compiler error with missing abort().</li>
</ul>
<h2 id="RocksDB-5-7-2"><a href="#RocksDB-5-7-2" class="headerlink" title="RocksDB 5.7.2"></a><a href="https://github.com/facebook/rocksdb/releases/tag/rocksdb-5.7.2" target="_blank" rel="noopener">RocksDB 5.7.2</a></h2><p><a href="https://github.com/yiwu-arbug" target="_blank" rel="noopener"><img src="https://avatars1.githubusercontent.com/u/2606959?s=40&v=4" alt="@yiwu-arbug"></a> <a href="https://github.com/yiwu-arbug" target="_blank" rel="noopener">yiwu-arbug</a> released this on 16 Aug 2017 · <a href="https://github.com/facebook/rocksdb/compare/rocksdb-5.7.2...5.7.fb" target="_blank" rel="noopener">23 commits</a> to 5.7.fb since this release</p>
<h3 id="Bug-Fixes-94"><a href="#Bug-Fixes-94" class="headerlink" title="Bug Fixes"></a>Bug Fixes</h3><ul>
<li>Fix incorrect dropping of deletions issue with FIFO compaction.</li>
<li>Fix LITE build compiler error with missing abort().</li>
</ul>
<h2 id="5-7-1-08-12-2017"><a href="#5-7-1-08-12-2017" class="headerlink" title="5.7.1 (08/12/2017)"></a>5.7.1 (08/12/2017)</h2><h3 id="Bug-Fixes-95"><a href="#Bug-Fixes-95" class="headerlink" title="Bug Fixes"></a>Bug Fixes</h3><ul>
<li>Fix incorrect dropping of deletions during intra-L0 compaction.</li>
</ul>
<h2 id="5-6-2-08-12-2017"><a href="#5-6-2-08-12-2017" class="headerlink" title="5.6.2 (08/12/2017)"></a>5.6.2 (08/12/2017)</h2><h3 id="Bug-Fixes-96"><a href="#Bug-Fixes-96" class="headerlink" title="Bug Fixes"></a>Bug Fixes</h3><ul>
<li>Fix incorrect dropping of deletions during intra-L0 compaction.</li>
</ul>
<h2 id="5-5-6-08-12-2017"><a href="#5-5-6-08-12-2017" class="headerlink" title="5.5.6 (08/12/2017)"></a>5.5.6 (08/12/2017)</h2><h3 id="Bug-Fixes-97"><a href="#Bug-Fixes-97" class="headerlink" title="Bug Fixes"></a>Bug Fixes</h3><ul>
<li>Fix incorrect dropping of deletions during intra-L0 compaction.</li>
</ul>
<h2 id="5-4-10-08-12-2017"><a href="#5-4-10-08-12-2017" class="headerlink" title="5.4.10 (08/12/2017)"></a>5.4.10 (08/12/2017)</h2><h3 id="Bug-Fixes-98"><a href="#Bug-Fixes-98" class="headerlink" title="Bug Fixes"></a>Bug Fixes</h3><ul>
<li>Fix incorrect dropping of deletions during intra-L0 compaction.</li>
</ul>
<h2 id="5-7-1-08-12-2017-1"><a href="#5-7-1-08-12-2017-1" class="headerlink" title="5.7.1 (08/12/2017)"></a>5.7.1 (08/12/2017)</h2><h3 id="Bug-Fixes-99"><a href="#Bug-Fixes-99" class="headerlink" title="Bug Fixes"></a>Bug Fixes</h3><ul>
<li>Fix incorrect dropping of deletions during intra-L0 compaction.</li>
</ul>
<h2 id="5-6-2-08-12-2017-1"><a href="#5-6-2-08-12-2017-1" class="headerlink" title="5.6.2 (08/12/2017)"></a>5.6.2 (08/12/2017)</h2><h3 id="Bug-Fixes-100"><a href="#Bug-Fixes-100" class="headerlink" title="Bug Fixes"></a>Bug Fixes</h3><ul>
<li>Fix incorrect dropping of deletions during intra-L0 compaction.</li>
</ul>
<h2 id="5-5-6-08-12-2017-1"><a href="#5-5-6-08-12-2017-1" class="headerlink" title="5.5.6 (08/12/2017)"></a>5.5.6 (08/12/2017)</h2><h3 id="Bug-Fixes-101"><a href="#Bug-Fixes-101" class="headerlink" title="Bug Fixes"></a>Bug Fixes</h3><ul>
<li>Fix incorrect dropping of deletions during intra-L0 compaction.</li>
</ul>
<h2 id="5-4-10-08-12-2017-1"><a href="#5-4-10-08-12-2017-1" class="headerlink" title="5.4.10 (08/12/2017)"></a>5.4.10 (08/12/2017)</h2><h3 id="Bug-Fixes-102"><a href="#Bug-Fixes-102" class="headerlink" title="Bug Fixes"></a>Bug Fixes</h3><ul>
<li>Fix incorrect dropping of deletions during intra-L0 compaction.</li>
</ul>
<h2 id="5-6-1-07-25-2017"><a href="#5-6-1-07-25-2017" class="headerlink" title="5.6.1 (07/25/2017)"></a>5.6.1 (07/25/2017)</h2><h3 id="Bug-Fixes-103"><a href="#Bug-Fixes-103" class="headerlink" title="Bug Fixes"></a>Bug Fixes</h3><ul>
<li>Fix lite build.</li>
</ul>
<h2 id="5-6-0-06-06-2017"><a href="#5-6-0-06-06-2017" class="headerlink" title="5.6.0 (06/06/2017)"></a>5.6.0 (06/06/2017)</h2><h3 id="Public-API-Change-35"><a href="#Public-API-Change-35" class="headerlink" title="Public API Change"></a>Public API Change</h3><ul>
<li>Scheduling flushes and compactions in the same thread pool is no longer supported by setting <code>max_background_flushes=0</code>. Instead, users can achieve this by configuring their high-pri thread pool to have zero threads.</li>
<li>Replace <code>Options::max_background_flushes</code>, <code>Options::max_background_compactions</code>, and <code>Options::base_background_compactions</code> all with <code>Options::max_background_jobs</code>, which automatically decides how many threads to allocate towards flush/compaction.</li>
<li>options.delayed_write_rate by default take the value of options.rate_limiter rate.</li>
<li>Replace global variable <code>IOStatsContext iostats_context</code> with <code>IOStatsContext* get_iostats_context()</code>; replace global variable <code>PerfContext perf_context</code> with <code>PerfContext* get_perf_context()</code>.</li>
</ul>
<h3 id="New-Features-35"><a href="#New-Features-35" class="headerlink" title="New Features"></a>New Features</h3><ul>
<li>Change ticker/histogram statistics implementations to use core-local storage. This improves aggregation speed compared to our previous thread-local approach, particularly for applications with many threads.</li>
<li>Users can pass a cache object to write buffer manager, so that they can cap memory usage for memtable and block cache using one single limit.</li>
<li>Flush will be triggered when 7/8 of the limit introduced by write_buffer_manager or db_write_buffer_size is triggered, so that the hard threshold is hard to hit.</li>
<li>Introduce WriteOptions.low_pri. If it is true, low priority writes will be throttled if the compaction is behind.</li>
<li><code>DB::IngestExternalFile()</code> now supports ingesting files into a database containing range deletions.</li>
</ul>
<h3 id="Bug-Fixes-104"><a href="#Bug-Fixes-104" class="headerlink" title="Bug Fixes"></a>Bug Fixes</h3><ul>
<li>Shouldn’t ignore return value of fsync() in flush.</li>
</ul>
<h2 id="RocksDB-5-5-5"><a href="#RocksDB-5-5-5" class="headerlink" title="RocksDB 5.5.5"></a><a href="https://github.com/facebook/rocksdb/releases/tag/v5.5.5" target="_blank" rel="noopener">RocksDB 5.5.5</a></h2><p><a href="https://github.com/siying" target="_blank" rel="noopener"><img src="https://avatars0.githubusercontent.com/u/5334567?s=40&v=4" alt="@siying"></a> <a href="https://github.com/siying" target="_blank" rel="noopener">siying</a> released this on 19 Jul 2017 · <a href="https://github.com/facebook/rocksdb/compare/v5.5.5...5.5.fb" target="_blank" rel="noopener">7 commits</a> to 5.5.fb since this release</p>
<ul>
<li>Change license section of java/rocksjni.pom</li>
<li>Clear up some files still mentioning PATENTS file</li>
</ul>
<h2 id="5-5-4-07-18-2017"><a href="#5-5-4-07-18-2017" class="headerlink" title="5.5.4 (07/18/2017)"></a>5.5.4 (07/18/2017)</h2><ul>
<li>Change License to Apache + GPLv2</li>
</ul>
<h2 id="RocksDB-5-5-3"><a href="#RocksDB-5-5-3" class="headerlink" title="RocksDB 5.5.3"></a><a href="https://github.com/facebook/rocksdb/releases/tag/rocksdb-5.5.3" target="_blank" rel="noopener">RocksDB 5.5.3</a></h2><p><a href="https://github.com/yiwu-arbug" target="_blank" rel="noopener"><img src="https://avatars1.githubusercontent.com/u/2606959?s=40&v=4" alt="@yiwu-arbug"></a> <a href="https://github.com/yiwu-arbug" target="_blank" rel="noopener">yiwu-arbug</a> released this on 18 Jul 2017 · <a href="https://github.com/facebook/rocksdb/compare/rocksdb-5.5.3...5.5.fb" target="_blank" rel="noopener">16 commits</a> to 5.5.fb since this release</p>
<h3 id="Bug-Fixes-105"><a href="#Bug-Fixes-105" class="headerlink" title="Bug Fixes"></a>Bug Fixes</h3><ul>
<li>Fix LITE build error.</li>
</ul>
<h2 id="RocksDB-5-5-1"><a href="#RocksDB-5-5-1" class="headerlink" title="RocksDB 5.5.1"></a><a href="https://github.com/facebook/rocksdb/releases/tag/v5.5.1" target="_blank" rel="noopener">RocksDB 5.5.1</a></h2><p><a href="https://github.com/lightmark" target="_blank" rel="noopener"><img src="https://avatars1.githubusercontent.com/u/1549573?s=40&v=4" alt="@lightmark"></a> <a href="https://github.com/lightmark" target="_blank" rel="noopener">lightmark</a> released this on 4 Jul 2017 · <a href="https://github.com/facebook/rocksdb/compare/v5.5.1...master" target="_blank" rel="noopener">3264 commits</a> to master since this release</p>
<h3 id="New-Features-36"><a href="#New-Features-36" class="headerlink" title="New Features"></a>New Features</h3><ul>
<li>FIFO compaction to support Intra L0 compaction too with CompactionOptionsFIFO.allow_compaction=true.</li>
<li>DB::ResetStats() to reset internal stats.</li>
<li>Statistics::Reset() to reset user stats.</li>
<li>ldb add option –try_load_options, which will open DB with its own option file.</li>
<li>Introduce WriteBatch::PopSavePoint to pop the most recent save point explicitly.</li>
<li>Support dynamically change <code>max_open_files</code> option via SetDBOptions()</li>
<li>Added DB::CreateColumnFamilie() and DB::DropColumnFamilies() to bulk create/drop column families.</li>
<li>Add debugging function <code>GetAllKeyVersions</code> to see internal versions of a range of keys.</li>
<li>Support file ingestion with universal compaction style</li>
<li>Support file ingestion behind with option <code>allow_ingest_behind</code></li>
<li>New option enable_pipelined_write which may improve write throughput in case writing from multiple threads and WAL enabled.</li>
</ul>
<h3 id="Bug-Fixes-106"><a href="#Bug-Fixes-106" class="headerlink" title="Bug Fixes"></a>Bug Fixes</h3><ul>
<li>Fix the bug that Direct I/O uses direct reads for non-SST file</li>
</ul>
<h2 id="v5-4-7"><a href="#v5-4-7" class="headerlink" title="v5.4.7"></a><a href="https://github.com/facebook/rocksdb/releases/tag/v5.4.7" target="_blank" rel="noopener">v5.4.7</a></h2><p><a href="https://github.com/ajkr" target="_blank" rel="noopener"><img src="https://avatars1.githubusercontent.com/u/4780362?s=40&v=4" alt="@ajkr"></a> <a href="https://github.com/ajkr" target="_blank" rel="noopener">ajkr</a> released this on 4 Jul 2017 · <a href="https://github.com/facebook/rocksdb/compare/v5.4.7...master" target="_blank" rel="noopener">3391 commits</a> to master since this release</p>
<h3 id="Bug-Fixes-107"><a href="#Bug-Fixes-107" class="headerlink" title="Bug Fixes"></a>Bug Fixes</h3><ul>
<li>Shouldn’t ignore return value of fsync() in flush.</li>
</ul>
<h2 id="RocksDB-5-4-6"><a href="#RocksDB-5-4-6" class="headerlink" title="RocksDB 5.4.6"></a><a href="https://github.com/facebook/rocksdb/releases/tag/rocksdb-5.4.6" target="_blank" rel="noopener">RocksDB 5.4.6</a></h2><p><a href="https://github.com/yiwu-arbug" target="_blank" rel="noopener"><img src="https://avatars1.githubusercontent.com/u/2606959?s=40&v=4" alt="@yiwu-arbug"></a> <a href="https://github.com/yiwu-arbug" target="_blank" rel="noopener">yiwu-arbug</a> released this on 31 May 2017 · <a href="https://github.com/facebook/rocksdb/compare/rocksdb-5.4.6...5.4.fb" target="_blank" rel="noopener">25 commits</a> to 5.4.fb since this release</p>
<h3 id="Bug-Fixes-108"><a href="#Bug-Fixes-108" class="headerlink" title="Bug Fixes"></a>Bug Fixes</h3><ul>
<li>Fix db_bench with lite build.</li>
</ul>
<h2 id="RocksDB-5-4-5"><a href="#RocksDB-5-4-5" class="headerlink" title="RocksDB 5.4.5"></a><a href="https://github.com/facebook/rocksdb/releases/tag/rocksdb-5.4.5" target="_blank" rel="noopener">RocksDB 5.4.5</a></h2><p><a href="https://github.com/sagar0" target="_blank" rel="noopener"><img src="https://avatars2.githubusercontent.com/u/1087535?s=40&v=4" alt="@sagar0"></a> <a href="https://github.com/sagar0" target="_blank" rel="noopener">sagar0</a> released this on 27 May 2017 · <a href="https://github.com/facebook/rocksdb/compare/rocksdb-5.4.5...5.4.fb" target="_blank" rel="noopener">27 commits</a> to 5.4.fb since this release</p>
<h3 id="Public-API-Change-36"><a href="#Public-API-Change-36" class="headerlink" title="Public API Change"></a>Public API Change</h3><ul>
<li>Support dynamically changing <code>stats_dump_period_sec</code> option via SetDBOptions().</li>
<li>Added ReadOptions::max_skippable_internal_keys to set a threshold to fail a request as incomplete when too many keys are being skipped while using iterators.</li>
<li>DB::Get in place of std::string accepts PinnableSlice, which avoids the extra memcpy of value to std::string in most of cases.<ul>
<li>PinnableSlice releases the pinned resources that contain the value when it is destructed or when ::Reset() is called on it.</li>
<li>The old API that accepts std::string, although discouraged, is still supported.</li>
</ul>
</li>
<li>Replace Options::use_direct_writes with Options::use_direct_io_for_flush_and_compaction. See Direct IO wiki for details.</li>
</ul>
<h3 id="New-Features-37"><a href="#New-Features-37" class="headerlink" title="New Features"></a>New Features</h3><ul>
<li>Memtable flush can be avoided during checkpoint creation if total log file size is smaller than a threshold specified by the user.</li>
<li>Introduce level-based L0-&gt;L0 compactions to reduce file count, so write delays are incurred less often.</li>
<li>(Experimental) Partitioning filters which creates an index on the partitions. The feature can be enabled by setting partition_filters when using kFullFilter. Currently the feature also requires two-level indexing to be enabled. Number of partitions is the same as the number of partitions for indexes, which is controlled by metadata_block_size.</li>
<li>DB::ResetStats() to reset internal stats.</li>
<li>Added CompactionEventListener and EventListener::OnFlushBegin interfaces.</li>
<li>Added DB::CreateColumnFamilie() and DB::DropColumnFamilies() to bulk create/drop column families.</li>
<li>Facility for cross-building RocksJava using Docker.</li>
</ul>
<h3 id="Bug-Fixes-109"><a href="#Bug-Fixes-109" class="headerlink" title="Bug Fixes"></a>Bug Fixes</h3><ul>
<li>Fix WriteBatchWithIndex address use after scope error.</li>
<li>Fix WritableFile buffer size in direct IO.</li>
<li>Add prefetch to PosixRandomAccessFile in buffered io.</li>
<li>Fix PinnableSlice access invalid address when row cache is enabled.</li>
<li>Fix huge fallocate calls fail and make XFS unhappy.</li>
<li>Fix memory alignment with logical sector size.</li>
<li>Fix alignment in ReadaheadRandomAccessFile.</li>
<li>Fix bias with read amplification stats (READ_AMP_ESTIMATE_USEFUL_BYTES and READ_AMP_TOTAL_READ_BYTES).</li>
<li>Fix a manual / auto compaction data race.</li>
<li>Fix CentOS 5 cross-building of RocksJava.</li>
<li>Build and link with ZStd when creating the static RocksJava build.</li>
<li>Fix snprintf’s usage to be cross-platform.</li>
<li>Fix build errors with blob DB.</li>
<li>Fix readamp test type inconsistency.</li>
</ul>
<h2 id="v5-3-6"><a href="#v5-3-6" class="headerlink" title="v5.3.6"></a><a href="https://github.com/facebook/rocksdb/releases/tag/v5.3.6" target="_blank" rel="noopener">v5.3.6</a></h2><p><a href="https://github.com/sagar0" target="_blank" rel="noopener"><img src="https://avatars2.githubusercontent.com/u/1087535?s=40&v=4" alt="@sagar0"></a> <a href="https://github.com/sagar0" target="_blank" rel="noopener">sagar0</a> released this on 20 May 2017 · <a href="https://github.com/facebook/rocksdb/compare/v5.3.6...5.3.fb" target="_blank" rel="noopener">7 commits</a> to 5.3.fb since this release</p>
<ul>
<li>Fix RocksJava static build issue.</li>
<li>Fix RocksJava build for IBM/PPC.</li>
</ul>
<h2 id="v5-3-5"><a href="#v5-3-5" class="headerlink" title="v5.3.5"></a><a href="https://github.com/facebook/rocksdb/releases/tag/v5.3.5" target="_blank" rel="noopener">v5.3.5</a></h2><p><a href="https://github.com/sagar0" target="_blank" rel="noopener"><img src="https://avatars2.githubusercontent.com/u/1087535?s=40&v=4" alt="@sagar0"></a> <a href="https://github.com/sagar0" target="_blank" rel="noopener">sagar0</a> released this on 19 May 2017 · <a href="https://github.com/facebook/rocksdb/compare/v5.3.5...5.3.fb" target="_blank" rel="noopener">10 commits</a> to 5.3.fb since this release</p>
<ul>
<li>Fix Centos5 cross-building of RocksJava</li>
<li>Build and link ZStd statically in RocksJava</li>
<li>Facility for cross-building RocksJava using Docker.</li>
</ul>
<h2 id="RocksDB-5-3-3"><a href="#RocksDB-5-3-3" class="headerlink" title="RocksDB 5.3.3"></a><a href="https://github.com/facebook/rocksdb/releases/tag/rocksdb-5.3.3" target="_blank" rel="noopener">RocksDB 5.3.3</a></h2><p><a href="https://github.com/ajkr" target="_blank" rel="noopener"><img src="https://avatars1.githubusercontent.com/u/4780362?s=40&v=4" alt="@ajkr"></a> <a href="https://github.com/ajkr" target="_blank" rel="noopener">ajkr</a> released this on 2 May 2017 · <a href="https://github.com/facebook/rocksdb/compare/rocksdb-5.3.3...5.3.fb" target="_blank" rel="noopener">18 commits</a> to 5.3.fb since this release</p>
<h3 id="Public-API-Change-37"><a href="#Public-API-Change-37" class="headerlink" title="Public API Change"></a>Public API Change</h3><ul>
<li>Remove disableDataSync option.</li>
<li>Remove timeout_hint_us option from WriteOptions. The option has been deprecated and has no effect since 3.13.0.</li>
<li>Remove option min_partial_merge_operands. Partial merge operands will always be merged in flush or compaction if there are more than one.</li>
<li>Remove option verify_checksums_in_compaction. Compaction will always verify checksum.</li>
</ul>
<h3 id="New-Features-38"><a href="#New-Features-38" class="headerlink" title="New Features"></a>New Features</h3><ul>
<li>Memtable flush can be avoided during checkpoint creation if total log file size is smaller than a threshold specified by the user.</li>
</ul>
<h3 id="Bug-Fixes-110"><a href="#Bug-Fixes-110" class="headerlink" title="Bug Fixes"></a>Bug Fixes</h3><ul>
<li>Fix the bug that iterator may skip keys</li>
</ul>
<h2 id="RocksDB-5-2-1"><a href="#RocksDB-5-2-1" class="headerlink" title="RocksDB 5.2.1"></a><a href="https://github.com/facebook/rocksdb/releases/tag/rocksdb-5.2.1" target="_blank" rel="noopener">RocksDB 5.2.1</a></h2><p><a href="https://github.com/siying" target="_blank" rel="noopener"><img src="https://avatars0.githubusercontent.com/u/5334567?s=40&v=4" alt="@siying"></a> <a href="https://github.com/siying" target="_blank" rel="noopener">siying</a> released this on 23 Mar 2017 · <a href="https://github.com/facebook/rocksdb/compare/rocksdb-5.2.1...5.2.fb" target="_blank" rel="noopener">6 commits</a> to 5.2.fb since this release</p>
<h3 id="Public-API-Change-38"><a href="#Public-API-Change-38" class="headerlink" title="Public API Change"></a>Public API Change</h3><ul>
<li>NewLRUCache() will determine number of shard bits automatically based on capacity, if the user doesn’t pass one. This also impacts the default block cache when the user doesn’t explict provide one.</li>
<li>Change the default of delayed slowdown value to 16MB/s and further increase the L0 stop condition to 36 files.</li>
<li>(Experimental) Two-level indexing that partition the index and creates a 2nd level index on the partitions. The feature can be enabled by setting kTwoLevelIndexSearch as IndexType and configuring index_per_partition.</li>
</ul>
<h3 id="New-Features-39"><a href="#New-Features-39" class="headerlink" title="New Features"></a>New Features</h3><ul>
<li>Added new overloaded function GetApproximateSizes that allows to specify if memtable stats should be computed only without computing SST files’ stats approximations.</li>
<li>Added new function GetApproximateMemTableStats that approximates both number of records and size of memtables.</li>
</ul>
<h3 id="Bug-Fixes-111"><a href="#Bug-Fixes-111" class="headerlink" title="Bug Fixes"></a>Bug Fixes</h3><ul>
<li>RangeSync() should work if ROCKSDB_FALLOCATE_PRESENT is not set</li>
<li>Fix wrong results in a data race case in Get()</li>
<li>Some fixes related to 2PC.</li>
<li>Fix several bugs in Direct I/O supports.</li>
<li>Fix a regression bug which can cause Seek() to miss some keys if the return key has been updated many times after the snapshot which is used by the iterator.</li>
</ul>
<h2 id="RocksDB-5-1-4"><a href="#RocksDB-5-1-4" class="headerlink" title="RocksDB 5.1.4"></a><a href="https://github.com/facebook/rocksdb/releases/tag/v5.1.4" target="_blank" rel="noopener">RocksDB 5.1.4</a></h2><p><a href="https://github.com/lightmark" target="_blank" rel="noopener"><img src="https://avatars1.githubusercontent.com/u/1549573?s=40&v=4" alt="@lightmark"></a> <a href="https://github.com/lightmark" target="_blank" rel="noopener">lightmark</a> released this on 25 Feb 2017 · <a href="https://github.com/facebook/rocksdb/compare/v5.1.4...master" target="_blank" rel="noopener">3641 commits</a> to master since this release</p>
<h3 id="Bug-fixes-3"><a href="#Bug-fixes-3" class="headerlink" title="Bug fixes"></a>Bug fixes</h3><ul>
<li>Fixed the bug of IO Error when <code>compaction_readahead_size &gt; 0</code> in direct I/O</li>
<li>Fixed the bug of file size mismatch between MANIFEST and real size in direct I/O</li>
<li>Fix OSX build break after the fallocate change</li>
</ul>
<h2 id="RocksDB-5-1-2"><a href="#RocksDB-5-1-2" class="headerlink" title="RocksDB 5.1.2"></a><a href="https://github.com/facebook/rocksdb/releases/tag/v5.1.2" target="_blank" rel="noopener">RocksDB 5.1.2</a></h2><p><a href="https://github.com/maysamyabandeh" target="_blank" rel="noopener"><img src="https://avatars0.githubusercontent.com/u/1167741?s=40&v=4" alt="@maysamyabandeh"></a> <a href="https://github.com/maysamyabandeh" target="_blank" rel="noopener">maysamyabandeh</a> released this on 8 Feb 2017 · <a href="https://github.com/facebook/rocksdb/compare/v5.1.2...master" target="_blank" rel="noopener">3641 commits</a> to master since this release</p>
<h3 id="Public-API-Change-39"><a href="#Public-API-Change-39" class="headerlink" title="Public API Change"></a>Public API Change</h3><ul>
<li>Support dynamically change <code>delete_obsolete_files_period_micros</code> option via SetDBOptions().</li>
<li>Added EventListener::OnExternalFileIngested which will be called when IngestExternalFile() add a file successfully.</li>
<li>BackupEngine::Open and BackupEngineReadOnly::Open now always return error statuses matching those of the backup Env.</li>
</ul>
<h3 id="Bug-Fixes-112"><a href="#Bug-Fixes-112" class="headerlink" title="Bug Fixes"></a>Bug Fixes</h3><ul>
<li>Fix the bug that if 2PC is enabled, checkpoints may loss some recent transactions.</li>
<li>When file copying is needed when creating checkpoints or bulk loading files, fsync the file after the file copying.</li>
</ul>
<p><a href="https://github.com/facebook/rocksdb/releases/tag/v5.0.2" target="_blank" rel="noopener">RocksDB 5.0.2</a></p>
<p><a href="https://github.com/ajkr" target="_blank" rel="noopener"><img src="https://avatars1.githubusercontent.com/u/4780362?s=40&v=4" alt="@ajkr"></a> <a href="https://github.com/ajkr" target="_blank" rel="noopener">ajkr</a> released this on 19 Jan 2017 · <a href="https://github.com/facebook/rocksdb/compare/v5.0.2...master" target="_blank" rel="noopener">3742 commits</a> to master since this release</p>
<h3 id="Bug-fixes-4"><a href="#Bug-fixes-4" class="headerlink" title="Bug fixes"></a>Bug fixes</h3><ul>
<li><p>Fixed DeleteRange corruption issue in certain compaction cases</p>
</li>
<li></li>
</ul>
<h2 id="RocksDB-5-0-1"><a href="#RocksDB-5-0-1" class="headerlink" title="RocksDB 5.0.1"></a><a href="https://github.com/facebook/rocksdb/releases/tag/v5.0.1" target="_blank" rel="noopener">RocksDB 5.0.1</a></h2><p><a href="https://github.com/yiwu-arbug" target="_blank" rel="noopener"><img src="https://avatars1.githubusercontent.com/u/2606959?s=40&v=4" alt="@yiwu-arbug"></a> <a href="https://github.com/yiwu-arbug" target="_blank" rel="noopener">yiwu-arbug</a> released this on 7 Jan 2017 · <a href="https://github.com/facebook/rocksdb/compare/v5.0.1...master" target="_blank" rel="noopener">3742 commits</a> to master since this release</p>
<h3 id="Public-API-Change-40"><a href="#Public-API-Change-40" class="headerlink" title="Public API Change"></a>Public API Change</h3><ul>
<li>Options::max_bytes_for_level_multiplier is now a double along with all getters and setters.</li>
<li>Support dynamically change <code>delayed_write_rate</code> and <code>max_total_wal_size</code> options via SetDBOptions().</li>
<li>Introduce DB::DeleteRange for optimized deletion of large ranges of contiguous keys.</li>
<li>Support dynamically change <code>delayed_write_rate</code> option via SetDBOptions().</li>
<li>Options::allow_concurrent_memtable_write and Options::enable_write_thread_adaptive_yield are now true by default.</li>
<li>Remove Tickers::SEQUENCE_NUMBER to avoid confusion if statistics object is shared among RocksDB instance. Alternatively DB::GetLatestSequenceNumber() can be used to get the same value.</li>
<li>Options.level0_stop_writes_trigger default value changes from 24 to 32.</li>
<li>New compaction filter API: CompactionFilter::FilterV2(). Allows to drop ranges of keys.</li>
<li>Removed flashcache support.</li>
<li>DB::AddFile() is deprecated and is replaced with DB::IngestExternalFile(). DB::IngestExternalFile() remove all the restrictions that existed for DB::AddFile.</li>
</ul>
<h3 id="New-Features-40"><a href="#New-Features-40" class="headerlink" title="New Features"></a>New Features</h3><ul>
<li><p>Add avoid_flush_during_shutdown option, which speeds up DB shutdown by not flushing unpersisted data (i.e. with disableWAL = true). Unpersisted data will be lost. The options is dynamically changeable via SetDBOptions().</p>
</li>
<li><p>Add memtable_insert_with_hint_prefix_extractor option. The option is mean to reduce CPU usage for inserting keys into memtable, if keys can be group by prefix and insert for each prefix are sequential or almost sequential. See include/rocksdb/options.h for more details.</p>
</li>
<li><p>Add LuaCompactionFilter in utilities. This allows developers to write compaction filters in Lua. To use this feature, LUA_PATH needs to be set to the root directory of Lua.</p>
</li>
<li><p>No longer populate “LATEST_BACKUP” file in backup directory, which formerly contained the number of the latest backup. The latest backup can be determined by finding the highest numbered file in the “meta/“ subdirectory.</p>
</li>
<li></li>
</ul>
<h2 id="RocksDB-4-13-5"><a href="#RocksDB-4-13-5" class="headerlink" title="RocksDB 4.13.5"></a><a href="https://github.com/facebook/rocksdb/releases/tag/v4.13.5" target="_blank" rel="noopener">RocksDB 4.13.5</a></h2><p><a href="https://github.com/IslamAbdelRahman" target="_blank" rel="noopener"><img src="https://avatars1.githubusercontent.com/u/1676006?s=40&v=4" alt="@IslamAbdelRahman"></a> <a href="https://github.com/IslamAbdelRahman" target="_blank" rel="noopener">IslamAbdelRahman</a> released this on 13 Dec 2016 · <a href="https://github.com/facebook/rocksdb/compare/v4.13.5...4.13.fb" target="_blank" rel="noopener">6 commits</a> to 4.13.fb since this release</p>
<p>We have skipped releasing 4.12.x and went directly to 4.13.5</p>
<h2 id="4-13-5"><a href="#4-13-5" class="headerlink" title="4.13.5"></a>4.13.5</h2><h3 id="Public-API-Change-41"><a href="#Public-API-Change-41" class="headerlink" title="Public API Change"></a>Public API Change</h3><ul>
<li>Fix a regression in compaction performance.</li>
<li>Disallow calling IngestExternalFile() on a dropped column family.</li>
<li>Add EventListener::OnExternalFileIngested() event that will be called for files that are successfully ingested.</li>
</ul>
<h2 id="4-13-4"><a href="#4-13-4" class="headerlink" title="4.13.4"></a>4.13.4</h2><h3 id="Public-API-Change-42"><a href="#Public-API-Change-42" class="headerlink" title="Public API Change"></a>Public API Change</h3><ul>
<li>Removed flashcache support.</li>
</ul>
<h2 id="4-13-0-10-18-2016"><a href="#4-13-0-10-18-2016" class="headerlink" title="4.13.0 (10/18/2016)"></a>4.13.0 (10/18/2016)</h2><h3 id="Public-API-Change-43"><a href="#Public-API-Change-43" class="headerlink" title="Public API Change"></a>Public API Change</h3><ul>
<li>DB::GetOptions() reflect dynamic changed options (i.e. through DB::SetOptions()) and return copy of options instead of reference.</li>
<li>Added Statistics::getAndResetTickerCount().</li>
</ul>
<h3 id="New-Features-41"><a href="#New-Features-41" class="headerlink" title="New Features"></a>New Features</h3><ul>
<li>Add DB::SetDBOptions() to dynamic change base_background_compactions and max_background_compactions.</li>
<li>Added Iterator::SeekForPrev(). This new API will seek to the last key that is less than or equal to the target key.</li>
</ul>
<h2 id="4-12-0-9-12-2016"><a href="#4-12-0-9-12-2016" class="headerlink" title="4.12.0 (9/12/2016)"></a>4.12.0 (9/12/2016)</h2><h3 id="Public-API-Change-44"><a href="#Public-API-Change-44" class="headerlink" title="Public API Change"></a>Public API Change</h3><ul>
<li>CancelAllBackgroundWork() flushes all memtables for databases containing writes that have bypassed the WAL (writes issued with WriteOptions::disableWAL=true) before shutting down background threads.</li>
<li>Merge options source_compaction_factor, max_grandparent_overlap_bytes and expanded_compaction_factor into max_compaction_bytes.</li>
<li>Remove ImmutableCFOptions.</li>
<li>Add a compression type ZSTD, which can work with ZSTD 0.8.0 or up. Still keep ZSTDNotFinal for compatibility reasons.</li>
</ul>
<h3 id="New-Features-42"><a href="#New-Features-42" class="headerlink" title="New Features"></a>New Features</h3><ul>
<li><p>Introduce NewClockCache, which is based on CLOCK algorithm with better concurrent performance in some cases. It can be used to replace the default LRU-based block cache and table cache. To use it, RocksDB need to be linked with TBB lib.</p>
</li>
<li><p>Change ticker/histogram statistics implementations to accumulate data in thread-local storage, which improves CPU performance by reducing cache coherency costs. Callers of CreateDBStatistics do not need to change anything to use this feature.</p>
</li>
<li><p>Block cache mid-point insertion, where index and filter block are inserted into LRU block cache with higher priority. The feature can be enabled by setting BlockBasedTableOptions::cache_index_and_filter_blocks_with_high_priority to true and high_pri_pool_ratio &gt; 0 when creating NewLRUCache.</p>
</li>
<li></li>
</ul>
<h2 id="4-11-2-9-15-2016"><a href="#4-11-2-9-15-2016" class="headerlink" title="4.11.2 (9/15/2016)"></a>4.11.2 (9/15/2016)</h2><h3 id="Bug-fixes-5"><a href="#Bug-fixes-5" class="headerlink" title="Bug fixes"></a>Bug fixes</h3><ul>
<li>Segfault when failing to open an SST file for read-ahead iterators.</li>
<li>WAL without data for all CFs is not deleted after recovery.</li>
</ul>
<h2 id="4-11-1-8-30-2016"><a href="#4-11-1-8-30-2016" class="headerlink" title="4.11.1 (8/30/2016)"></a>4.11.1 (8/30/2016)</h2><h3 id="Bug-Fixes-113"><a href="#Bug-Fixes-113" class="headerlink" title="Bug Fixes"></a>Bug Fixes</h3><ul>
<li>Mitigate the regression bug of deadlock condition during recovery when options.max_successive_merges hits.</li>
<li>Fix data race condition related to hash index in block based table when putting indexes in the block cache.</li>
</ul>
<h2 id="4-11-0-8-1-2016"><a href="#4-11-0-8-1-2016" class="headerlink" title="4.11.0 (8/1/2016)"></a>4.11.0 (8/1/2016)</h2><h3 id="Public-API-Change-45"><a href="#Public-API-Change-45" class="headerlink" title="Public API Change"></a>Public API Change</h3><ul>
<li>options.memtable_prefix_bloom_huge_page_tlb_size =&gt; memtable_huge_page_size. When it is set, RocksDB will try to allocate memory from huge page for memtable too, rather than just memtable bloom filter.</li>
</ul>
<h3 id="New-Features-43"><a href="#New-Features-43" class="headerlink" title="New Features"></a>New Features</h3><ul>
<li>A tool to migrate DB after options change. See include/rocksdb/utilities/option_change_migration.h.</li>
<li>Add ReadOptions.background_purge_on_iterator_cleanup. If true, we avoid file deletion when destorying iterators.</li>
</ul>
<h2 id="4-10-0-7-5-2016"><a href="#4-10-0-7-5-2016" class="headerlink" title="4.10.0 (7/5/2016)"></a>4.10.0 (7/5/2016)</h2><h3 id="Public-API-Change-46"><a href="#Public-API-Change-46" class="headerlink" title="Public API Change"></a>Public API Change</h3><ul>
<li>options.memtable_prefix_bloom_bits changes to options.memtable_prefix_bloom_bits_ratio and deprecate options.memtable_prefix_bloom_probes</li>
<li>enum type CompressionType and PerfLevel changes from char to unsigned char. Value of all PerfLevel shift by one.</li>
<li>Deprecate options.filter_deletes.</li>
</ul>
<h3 id="New-Features-44"><a href="#New-Features-44" class="headerlink" title="New Features"></a>New Features</h3><ul>
<li>Add avoid_flush_during_recovery option.</li>
<li>Add a read option background_purge_on_iterator_cleanup to avoid deleting files in foreground when destroying iterators. Instead, a job is scheduled in high priority queue and would be executed in a separate background thread.</li>
<li>RepairDB support for column families. RepairDB now associates data with non-default column families using information embedded in the SST/WAL files (4.7 or later). For data written by 4.6 or earlier, RepairDB associates it with the default column family.</li>
<li>Add options.write_buffer_manager which allows users to control total memtable sizes across multiple DB instances.</li>
</ul>
<h2 id="RocksDB-4-9"><a href="#RocksDB-4-9" class="headerlink" title="RocksDB 4.9"></a><a href="https://github.com/facebook/rocksdb/releases/tag/v4.9" target="_blank" rel="noopener">RocksDB 4.9</a></h2><p><a href="https://github.com/lightmark" target="_blank" rel="noopener"><img src="https://avatars1.githubusercontent.com/u/1549573?s=40&v=4" alt="@lightmark"></a> <a href="https://github.com/lightmark" target="_blank" rel="noopener">lightmark</a> released this on 18 Aug 2016 · <a href="https://github.com/facebook/rocksdb/compare/v4.9...4.9.fb" target="_blank" rel="noopener">6 commits</a> to 4.9.fb since this release</p>
<h3 id="Public-API-changes"><a href="#Public-API-changes" class="headerlink" title="Public API changes"></a>Public API changes</h3><ul>
<li>Add bottommost_compression option, This option can be used to set a specific compression algorithm for the bottommost level (Last level containing files in the DB).</li>
<li>Introduce CompactionJobInfo::compression, This field state the compression algorithm used to generate the output files of the compaction.</li>
<li>Deprecate BlockBaseTableOptions.hash_index_allow_collision=false</li>
<li>Deprecate options builder (GetOptions()).</li>
</ul>
<h3 id="New-Features-45"><a href="#New-Features-45" class="headerlink" title="New Features"></a>New Features</h3><ul>
<li>Introduce NewSimCache() in rocksdb/utilities/sim_cache.h. This function creates a block cache that is able to give simulation results (mainly hit rate) of simulating block behavior with a configurable cache size.</li>
</ul>
<h2 id="v4-8"><a href="#v4-8" class="headerlink" title="v4.8"></a><a href="https://github.com/facebook/rocksdb/releases/tag/v4.8" target="_blank" rel="noopener">v4.8</a></h2><p><a href="https://github.com/yiwu-arbug" target="_blank" rel="noopener"><img src="https://avatars1.githubusercontent.com/u/2606959?s=40&v=4" alt="@yiwu-arbug"></a> <a href="https://github.com/yiwu-arbug" target="_blank" rel="noopener">yiwu-arbug</a> released this on 27 Jul 2016 · <a href="https://github.com/facebook/rocksdb/compare/v4.8...master" target="_blank" rel="noopener">4444 commits</a> to master since this release</p>
<h3 id="Public-API-Change-47"><a href="#Public-API-Change-47" class="headerlink" title="Public API Change"></a>Public API Change</h3><ul>
<li>Allow preset compression dictionary for improved compression of block-based tables. This is supported for zlib, zstd, and lz4. The compression dictionary’s size is configurable via CompressionOptions::max_dict_bytes.</li>
<li>Delete deprecated classes for creating backups (BackupableDB) and restoring from backups (RestoreBackupableDB). Now, BackupEngine should be used for creating backups, and BackupEngineReadOnly should be used for restorations. For more details, see <a href="https://github.com/facebook/rocksdb/wiki/How-to-backup-RocksDB%3F" target="_blank" rel="noopener">https://github.com/facebook/rocksdb/wiki/How-to-backup-RocksDB%3F</a></li>
<li>Expose estimate of per-level compression ratio via DB property: “rocksdb.compression-ratio-at-levelN”.<br>Added EventListener::OnTableFileCreationStarted. EventListener::OnTableFileCreated will be called on failure case. User can check creation status via TableFileCreationInfo::status.</li>
</ul>
<h3 id="New-Features-46"><a href="#New-Features-46" class="headerlink" title="New Features"></a>New Features</h3><ul>
<li>Add ReadOptions::readahead_size. If non-zero, NewIterator will create a new table reader which performs reads of the given size.</li>
</ul>
<h2 id="RocksDB-4-6-1"><a href="#RocksDB-4-6-1" class="headerlink" title="RocksDB 4.6.1"></a><a href="https://github.com/facebook/rocksdb/releases/tag/v4.6.1" target="_blank" rel="noopener">RocksDB 4.6.1</a></h2><p><a href="https://github.com/ajkr" target="_blank" rel="noopener"><img src="https://avatars1.githubusercontent.com/u/4780362?s=40&v=4" alt="@ajkr"></a> <a href="https://github.com/ajkr" target="_blank" rel="noopener">ajkr</a> released this on 1 Jun 2016 · <a href="https://github.com/facebook/rocksdb/compare/v4.6.1...master" target="_blank" rel="noopener">4632 commits</a> to master since this release</p>
<h3 id="Public-API-Changes"><a href="#Public-API-Changes" class="headerlink" title="Public API Changes"></a>Public API Changes</h3><ul>
<li>Change default of BlockBasedTableOptions.format_version to 2. It means default DB created by 4.6 or up cannot be opened by RocksDB version 3.9 or earlier.</li>
<li>Added strict_capacity_limit option to NewLRUCache. If the flag is set to true, insert to cache will fail if no enough capacity can be free. Signature of Cache::Insert() is updated accordingly.</li>
<li>Tickers [NUMBER_DB_NEXT, NUMBER_DB_PREV, NUMBER_DB_NEXT_FOUND, NUMBER_DB_PREV_FOUND, ITER_BYTES_READ] are not updated immediately. The are updated when the Iterator is deleted.</li>
<li>Add monotonically increasing counter (DB property “rocksdb.current-super-version-number”) that increments upon any change to the LSM tree.</li>
</ul>
<h3 id="New-Features-47"><a href="#New-Features-47" class="headerlink" title="New Features"></a>New Features</h3><ul>
<li>Add CompactionPri::kMinOverlappingRatio, a compaction picking mode friendly to write amplification.</li>
<li>Deprecate Iterator::IsKeyPinned() and replace it with Iterator::GetProperty() with prop_name=”rocksdb.iterator.is.key.pinned”</li>
</ul>
<h2 id="RocksDB-4-5-1"><a href="#RocksDB-4-5-1" class="headerlink" title="RocksDB 4.5.1"></a><a href="https://github.com/facebook/rocksdb/releases/tag/v4.5.1" target="_blank" rel="noopener">RocksDB 4.5.1</a></h2><p><a href="https://github.com/siying" target="_blank" rel="noopener"><img src="https://avatars0.githubusercontent.com/u/5334567?s=40&v=4" alt="@siying"></a> <a href="https://github.com/siying" target="_blank" rel="noopener">siying</a> released this on 27 Apr 2016 · <a href="https://github.com/facebook/rocksdb/compare/v4.5.1...master" target="_blank" rel="noopener">4725 commits</a> to master since this release</p>
<h3 id="Public-API-Changes-1"><a href="#Public-API-Changes-1" class="headerlink" title="Public API Changes"></a>Public API Changes</h3><ul>
<li>Add a new perf context level between kEnableCount and kEnableTime. Level 2 now does not include timers for mutexes.</li>
<li>Statistics of mutex operation durations will not be measured by default. If you want to have them enabled, you need to set Statistics::stats_level_ to kAll.</li>
<li>DBOptions::delete_scheduler and NewDeleteScheduler() are removed, please use DBOptions::sst_file_manager and NewSstFileManager() instead</li>
</ul>
<h3 id="New-Features-48"><a href="#New-Features-48" class="headerlink" title="New Features"></a>New Features</h3><ul>
<li>ldb tool now supports operations to non-default column families.</li>
<li>Add kPersistedTier to ReadTier. This option allows Get and MultiGet to read only the persited data and skip mem-tables if writes were done with disableWAL = true.</li>
<li>Add DBOptions::sst_file_manager. Use NewSstFileManager() in include/rocksdb/sst_file_manager.h to create a SstFileManager that can be used to track the total size of SST files and control the SST files deletion rate.</li>
</ul>
<h2 id="RocksDB-4-4-1"><a href="#RocksDB-4-4-1" class="headerlink" title="RocksDB 4.4.1"></a><a href="https://github.com/facebook/rocksdb/releases/tag/v4.4.1" target="_blank" rel="noopener">RocksDB 4.4.1</a></h2><p><a href="https://github.com/yhchiang" target="_blank" rel="noopener"><img src="https://avatars2.githubusercontent.com/u/6447975?s=40&v=4" alt="@yhchiang"></a> <a href="https://github.com/yhchiang" target="_blank" rel="noopener">yhchiang</a> released this on 13 Apr 2016 · <a href="https://github.com/facebook/rocksdb/compare/v4.4.1...master" target="_blank" rel="noopener">4814 commits</a> to master since this release</p>
<h3 id="New-Features-49"><a href="#New-Features-49" class="headerlink" title="New Features"></a>New Features</h3><ul>
<li>Dynamic slow-down on writes. When slow down on writes is triggered, RocksDB will dynamically optimize the slow-down per write based on the estimated pending compaction bytes. If the number of pending compaction bytes keeps increasing, then RocksDB will slow down on writes more to make compaction able to catch up to avoid write stall.</li>
<li>Introduce CompactionJobInfo::compaction_reason, this field include the reason to trigger the compaction.</li>
<li>Added a new parameter –path to ldb tool. –path accepts the name of either MANIFEST, SST or a WAL file. Either –db or –path can be used when calling ldb.</li>
</ul>
<h3 id="Public-API-Changes-2"><a href="#Public-API-Changes-2" class="headerlink" title="Public API Changes"></a>Public API Changes</h3><ul>
<li>Deprecate options.soft_rate_limit and add options.soft_pending_compaction_bytes_limit.</li>
<li>If options.max_write_buffer_number &gt; 3, writes will be slowed down when writing to the last write buffer to delay a full stop.</li>
<li>Increase default options.delayed_write_rate to 2MB/s.</li>
<li>Change names in CompactionPri and add a new one.</li>
</ul>
<h2 id="RocksDB-4-3-1"><a href="#RocksDB-4-3-1" class="headerlink" title="RocksDB 4.3.1"></a><a href="https://github.com/facebook/rocksdb/releases/tag/v4.3.1" target="_blank" rel="noopener">RocksDB 4.3.1</a></h2><p><a href="https://github.com/kradhakrishnan" target="_blank" rel="noopener"><img src="https://avatars0.githubusercontent.com/u/2488945?s=40&v=4" alt="@kradhakrishnan"></a> <a href="https://github.com/kradhakrishnan" target="_blank" rel="noopener">kradhakrishnan</a> released this on 16 Mar 2016 · <a href="https://github.com/facebook/rocksdb/compare/v4.3.1...master" target="_blank" rel="noopener">4962 commits</a> to master since this release</p>
<h3 id="New-Features-50"><a href="#New-Features-50" class="headerlink" title="New Features"></a>New Features</h3><ul>
<li>CompactionFilter has new member function called IgnoreSnapshots which allows CompactionFilter to be called even if there are snapshots later than the key.</li>
<li>RocksDB will now persist options under the same directory as the RocksDB database on successful DB::Open, CreateColumnFamily, DropColumnFamily, and SetOptions.</li>
<li>Introduce LoadLatestOptions() in rocksdb/utilities/options_util.h. This function can construct the latest DBOptions / ColumnFamilyOptions used by the specified RocksDB intance.</li>
<li>Introduce CheckOptionsCompatibility() in rocksdb/utilities/options_util.h. This function checks whether the input set of options is able to open the specified DB successfully.</li>
</ul>
<h3 id="Public-API-Changes-3"><a href="#Public-API-Changes-3" class="headerlink" title="Public API Changes"></a>Public API Changes</h3><ul>
<li>When options.db_write_buffer_size triggers, only the column family with the largest column family size will be flushed, not all the column families.</li>
</ul>
<h2 id="RocksDB-4-2"><a href="#RocksDB-4-2" class="headerlink" title="RocksDB 4.2"></a><a href="https://github.com/facebook/rocksdb/releases/tag/v4.2" target="_blank" rel="noopener">RocksDB 4.2</a></h2><p><a href="https://github.com/siying" target="_blank" rel="noopener"><img src="https://avatars0.githubusercontent.com/u/5334567?s=40&v=4" alt="@siying"></a> <a href="https://github.com/siying" target="_blank" rel="noopener">siying</a> released this on 24 Feb 2016 · <a href="https://github.com/facebook/rocksdb/compare/v4.2...master" target="_blank" rel="noopener">5071 commits</a> to master since this release</p>
<h3 id="New-Features-51"><a href="#New-Features-51" class="headerlink" title="New Features"></a>New Features</h3><ul>
<li>Introduce CreateLoggerFromOptions(), this function create a Logger for provided DBOptions.</li>
<li>Add GetAggregatedIntProperty(), which returns the sum of the GetIntProperty of all the column families.</li>
<li>Add MemoryUtil in rocksdb/utilities/memory.h. It currently offers a way to get the memory usage by type from a list rocksdb instances.</li>
</ul>
<h3 id="Public-API-Changes-4"><a href="#Public-API-Changes-4" class="headerlink" title="Public API Changes"></a>Public API Changes</h3><ul>
<li>CompactionFilter::Context includes information of Column Family ID</li>
<li>The need-compaction hint given by TablePropertiesCollector::NeedCompact() will be persistent and recoverable after DB recovery. This introduces a breaking format change. If you use this experimental feature, including NewCompactOnDeletionCollectorFactory() in the new version, you may not be able to directly downgrade the DB back to version 4.0 or lower.</li>
<li>TablePropertiesCollectorFactory::CreateTablePropertiesCollector() now takes an option Context, containing the information of column family ID for the file being written.</li>
<li>Remove DefaultCompactionFilterFactory.</li>
</ul>
<h2 id="RocksDB-4-1"><a href="#RocksDB-4-1" class="headerlink" title="RocksDB 4.1"></a><a href="https://github.com/facebook/rocksdb/releases/tag/v4.1" target="_blank" rel="noopener">RocksDB 4.1</a></h2><p><a href="https://github.com/yhchiang" target="_blank" rel="noopener"><img src="https://avatars2.githubusercontent.com/u/6447975?s=40&v=4" alt="@yhchiang"></a> <a href="https://github.com/yhchiang" target="_blank" rel="noopener">yhchiang</a> released this on 18 Nov 2015 · <a href="https://github.com/facebook/rocksdb/compare/v4.1...4.1.fb" target="_blank" rel="noopener">8 commits</a> to 4.1.fb since this release</p>
<h3 id="New-Features-52"><a href="#New-Features-52" class="headerlink" title="New Features"></a>New Features</h3><ul>
<li>Added single delete operation as a more efficient way to delete keys that have not been overwritten.</li>
<li>Added experimental AddFile() to DB interface that allow users to add files created by SstFileWriter into an empty Database, see include/rocksdb/sst_file_writer.h and DB::AddFile() for more info.</li>
<li>Added support for opening SST files with .ldb suffix which enables opening LevelDB databases.</li>
<li>CompactionFilter now supports filtering of merge operands and merge results.</li>
</ul>
<h3 id="Public-API-Changes-5"><a href="#Public-API-Changes-5" class="headerlink" title="Public API Changes"></a>Public API Changes</h3><ul>
<li>Added SingleDelete() to the DB interface.</li>
<li>Added AddFile() to DB interface.</li>
<li>Added SstFileWriter class.</li>
<li>CompactionFilter has a new method FilterMergeOperand() that RocksDB applies to every merge operand during compaction to decide whether to filter the operand.</li>
<li>We removed CompactionFilterV2 interfaces from include/rocksdb/compaction_filter.h. The functionality was deprecated already in version 3.13.</li>
</ul>
<h2 id="RocksDB-4-0"><a href="#RocksDB-4-0" class="headerlink" title="RocksDB 4.0"></a><a href="https://github.com/facebook/rocksdb/releases/tag/v4.0" target="_blank" rel="noopener">RocksDB 4.0</a></h2><p><a href="https://github.com/IslamAbdelRahman" target="_blank" rel="noopener"><img src="https://avatars1.githubusercontent.com/u/1676006?s=40&v=4" alt="@IslamAbdelRahman"></a> <a href="https://github.com/IslamAbdelRahman" target="_blank" rel="noopener">IslamAbdelRahman</a> released this on 21 Oct 2015 · <a href="https://github.com/facebook/rocksdb/compare/v4.0...4.0.fb" target="_blank" rel="noopener">14 commits</a> to 4.0.fb since this release</p>
<h3 id="New-Features-53"><a href="#New-Features-53" class="headerlink" title="New Features"></a>New Features</h3><ul>
<li>Added support for transactions. See include/rocksdb/utilities/transaction.h for more info.</li>
<li>DB::GetProperty() now accepts “rocksdb.aggregated-table-properties” and “rocksdb.aggregated-table-properties-at-levelN”, in which case it returns aggregated table properties of the target column family, or the aggregated table properties of the specified level N if the “at-level” version is used.</li>
<li>Add compression option kZSTDNotFinalCompression for people to experiment ZSTD although its format is not finalized.</li>
<li>We removed the need for LATEST_BACKUP file in BackupEngine. We still keep writing it when we create new backups (because of backward compatibility), but we don’t read it anymore.</li>
</ul>
<h3 id="Public-API-Changes-6"><a href="#Public-API-Changes-6" class="headerlink" title="Public API Changes"></a>Public API Changes</h3><ul>
<li>Removed class Env::RandomRWFile and Env::NewRandomRWFile().</li>
<li>Renamed DBOptions.num_subcompactions to DBOptions.max_subcompactions to make the name better match the actual functionality of the option.</li>
<li>Added Equal() method to the Comparator interface that can optionally be overwritten in cases where equality comparisons can be done more efficiently than three-way comparisons.</li>
<li>Previous ‘experimental’ OptimisticTransaction class has been replaced by Transaction class.</li>
</ul>
<h2 id="RocksDB-4-1-1"><a href="#RocksDB-4-1-1" class="headerlink" title="RocksDB 4.1"></a><a href="https://github.com/facebook/rocksdb/releases/tag/rocksdb-4.1" target="_blank" rel="noopener">RocksDB 4.1</a></h2><p><a href="https://github.com/yhchiang" target="_blank" rel="noopener"><img src="https://avatars2.githubusercontent.com/u/6447975?s=40&v=4" alt="@yhchiang"></a> <a href="https://github.com/yhchiang" target="_blank" rel="noopener">yhchiang</a> released this on 18 Nov 2015 · <a href="https://github.com/facebook/rocksdb/compare/rocksdb-4.1...4.1.fb" target="_blank" rel="noopener">9 commits</a> to 4.1.fb since this release</p>
<h3 id="New-Features-54"><a href="#New-Features-54" class="headerlink" title="New Features"></a>New Features</h3><ul>
<li>Added single delete operation as a more efficient way to delete keys that have not been overwritten.</li>
<li>Added experimental AddFile() to DB interface that allow users to add files created by SstFileWriter into an empty Database, see include/rocksdb/sst_file_writer.h and DB::AddFile() for more info.</li>
<li>Added support for opening SST files with .ldb suffix which enables opening LevelDB databases.</li>
<li>CompactionFilter now supports filtering of merge operands and merge results.</li>
</ul>
<h3 id="Public-API-Changes-7"><a href="#Public-API-Changes-7" class="headerlink" title="Public API Changes"></a>Public API Changes</h3><ul>
<li>Added SingleDelete() to the DB interface.</li>
<li>Added AddFile() to DB interface.</li>
<li>Added SstFileWriter class.</li>
<li>CompactionFilter has a new method FilterMergeOperand() that RocksDB applies to every merge operand during compaction to decide whether to filter the operand.</li>
<li>We removed CompactionFilterV2 interfaces from include/rocksdb/compaction_filter.h. The functionality was deprecated already in version 3.13.</li>
</ul>
<h2 id="RocksDB-3-13-1"><a href="#RocksDB-3-13-1" class="headerlink" title="RocksDB 3.13.1"></a><a href="https://github.com/facebook/rocksdb/releases/tag/rocksdb-3.13.1" target="_blank" rel="noopener">RocksDB 3.13.1</a></h2><p><a href="https://github.com/siying" target="_blank" rel="noopener"><img src="https://avatars0.githubusercontent.com/u/5334567?s=40&v=4" alt="@siying"></a> <a href="https://github.com/siying" target="_blank" rel="noopener">siying</a> released this on 2 Sep 2015 · <a href="https://github.com/facebook/rocksdb/compare/rocksdb-3.13.1...master" target="_blank" rel="noopener">5536 commits</a> to master since this release</p>
<h3 id="New-Features-55"><a href="#New-Features-55" class="headerlink" title="New Features"></a>New Features</h3><ul>
<li>RollbackToSavePoint() in WriteBatch/WriteBatchWithIndex</li>
<li>Add NewCompactOnDeletionCollectorFactory() in utilities/table_properties_collectors, which allows rocksdb to mark a SST file as need-compaction when it observes at least D deletion entries in any N consecutive entries in that SST file. Note that this feature depends on an experimental NeedCompact() API — the result of this API will not persist after DB restart.</li>
<li>Add DBOptions::delete_scheduler. Use NewDeleteScheduler() in include/rocksdb/delete_scheduler.h to create a DeleteScheduler that can be shared among multiple RocksDB instances to control the file deletion rate of SST files that exist in the first db_path.</li>
</ul>
<h3 id="Public-API-Changes-8"><a href="#Public-API-Changes-8" class="headerlink" title="Public API Changes"></a>Public API Changes</h3><ul>
<li>Deprecated WriteOptions::timeout_hint_us. We no longer support write timeout. If you really need this option, talk to us and we might consider returning it.</li>
<li>Deprecated purge_redundant_kvs_while_flush option.</li>
<li>Removed BackupEngine::NewBackupEngine() and NewReadOnlyBackupEngine() that were deprecated in RocksDB 3.8. Please use BackupEngine::Open() instead.</li>
<li>Deprecated Compaction Filter V2. We are not aware of any existing use-cases. If you use this filter, your compile will break with RocksDB 3.13. Please let us know if you use it and we’ll put it back in RocksDB 3.14.</li>
<li>Env::FileExists now returns a Status instead of a boolean</li>
<li>Add statistics::getHistogramString() to print detailed distribution of a histogram metric.</li>
<li>Add DBOptions::skip_stats_update_on_db_open. When it is on, DB::Open() will run faster as it skips the random reads required for loading necessary stats from SST files to optimize compaction.</li>
</ul>
<h2 id="RocksDB-3-12-1"><a href="#RocksDB-3-12-1" class="headerlink" title="RocksDB 3.12.1"></a><a href="https://github.com/facebook/rocksdb/releases/tag/rocksdb-3.12.1" target="_blank" rel="noopener">RocksDB 3.12.1</a></h2><h3 id="New-Features-56"><a href="#New-Features-56" class="headerlink" title="New Features"></a>New Features</h3><ul>
<li>Added experimental support for optimistic transactions. See include/rocksdb/utilities/optimistic_transaction.h for more info.</li>
<li>Added a new way to report QPS from db_bench (check out –report_file and –report_interval_seconds)</li>
<li>Added a cache for individual rows. See DBOptions::row_cache for more info.</li>
<li>Several new features on EventListener (see include/rocksdb/listener.h):<ul>
<li>OnCompationCompleted() now returns per-compaciton job statistics, defined in include/rocksdb/compaction_job_stats.h.</li>
<li>Added OnTableFileCreated() and OnTableFileDeleted().</li>
</ul>
</li>
<li>Add compaction_options_universal.enable_trivial_move to true, to allow trivial move while performing universal compaction. Trivial move will happen only when all the input files are non overlapping.</li>
</ul>
<h3 id="Public-API-Changes-9"><a href="#Public-API-Changes-9" class="headerlink" title="Public API Changes"></a>Public API Changes</h3><ul>
<li>EventListener::OnFlushCompleted() now passes FlushJobInfo instead of a list of parameters.</li>
<li>DB::GetDbIdentity() is now a const function. If this function is overridden in your application, be sure to also make GetDbIdentity() const to avoid compile error.</li>
<li>Move listeners from ColumnFamilyOptions to DBOptions.</li>
<li>Add max_write_buffer_number_to_maintain option</li>
<li>DB::CompactRange()’s parameter reduce_level is changed to change_level, to allow users to move levels to lower levels if allowed. It can be used to migrate a DB from options.level_compaction_dynamic_level_bytes=false to options.level_compaction_dynamic_level_bytes.true.</li>
<li>Change default value for options.compaction_filter_factory and options.compaction_filter_factory_v2 to nullptr instead of DefaultCompactionFilterFactory and DefaultCompactionFilterFactoryV2.</li>
<li>If CancelAllBackgroundWork is called without doing a flush after doing loads with WAL disabled, the changes which haven’t been flushed before the call to CancelAllBackgroundWork will be lost.</li>
<li>WBWIIterator::Entry() now returns WriteEntry instead of <code>const WriteEntry&amp;</code></li>
<li>options.hard_rate_limit is deprecated.</li>
<li>When options.soft_rate_limit or options.level0_slowdown_writes_trigger is triggered, the way to slow down writes is changed to: write rate to DB is limited to to options.delayed_write_rate.</li>
<li>DB::GetApproximateSizes() adds a parameter to allow the estimation to include data in mem table, with default to be not to include. It is now only supported in skip list mem table.</li>
<li>DB::CompactRange() now accept CompactRangeOptions instead of multiple paramters. CompactRangeOptions is defined in include/rocksdb/options.h.</li>
<li>CompactRange() will now skip bottommost level compaction for level based compaction if there is no compaction filter, bottommost_level_compaction is introduced in CompactRangeOptions to control when it’s possbile to skip bottommost level compaction. This mean that if you want the compaction to produce a single file you need to set bottommost_level_compaction to BottommostLevelCompaction::kForce.</li>
<li>Add Cache.GetPinnedUsage() to get the size of memory occupied by entries that are in use by the system.</li>
<li>DB:Open() will fail if the compression specified in Options is not linked with the binary. If you see this failure, recompile RocksDB with compression libraries present on your system. Also, previously our default compression was snappy. This behavior is now changed. Now, the default compression is snappy only if it’s available on the system. If it isn’t we change the default to kNoCompression.</li>
<li>We changed how we account for memory used in block cache. Previously, we only counted the sum of block sizes currently present in block cache. Now, we count the actual memory usage of the blocks. For example, a block of size 4.5KB will use 8KB memory with jemalloc. This might decrease your memory usage and possibly decrease performance. Increase block cache size if you see this happening after an upgrade.</li>
<li>Add BackupEngineImpl.options_.max_background_operations to specify the maximum number of operations that may be performed in parallel. Add support for parallelized backup and restore.</li>
</ul>
<h2 id="RocksDB-3-11-2"><a href="#RocksDB-3-11-2" class="headerlink" title="RocksDB 3.11.2"></a><a href="https://github.com/facebook/rocksdb/releases/tag/rocksdb-3.11.2" target="_blank" rel="noopener">RocksDB 3.11.2</a></h2><p><a href="https://github.com/igorcanadi" target="_blank" rel="noopener"><img src="https://avatars2.githubusercontent.com/u/1091023?s=40&v=4" alt="@igorcanadi"></a> <a href="https://github.com/igorcanadi" target="_blank" rel="noopener">igorcanadi</a> released this on 12 Jun 2015 · <a href="https://github.com/facebook/rocksdb/compare/rocksdb-3.11.2...3.11.fb" target="_blank" rel="noopener">6 commits</a> to 3.11.fb since this release</p>
<h3 id="Fixes"><a href="#Fixes" class="headerlink" title="Fixes"></a>Fixes</h3><ul>
<li>Adjust the way we compensate for tombstones when choosing compactions. Previous heuristics led to pathological behavior in some cases.</li>
<li>Don’t let two L0-&gt;L1 compactions run in parallel (only affected through experimental feature SuggestCompactRange)</li>
</ul>
<h2 id="RocksDB-3-11-1"><a href="#RocksDB-3-11-1" class="headerlink" title="RocksDB 3.11.1"></a><a href="https://github.com/facebook/rocksdb/releases/tag/rocksdb-3.11.1" target="_blank" rel="noopener">RocksDB 3.11.1</a></h2><p><a href="https://github.com/igorcanadi" target="_blank" rel="noopener"><img src="https://avatars2.githubusercontent.com/u/1091023?s=40&v=4" alt="@igorcanadi"></a> <a href="https://github.com/igorcanadi" target="_blank" rel="noopener">igorcanadi</a> released this on 4 Jun 2015 · <a href="https://github.com/facebook/rocksdb/compare/rocksdb-3.11.1...3.11.fb" target="_blank" rel="noopener">9 commits</a> to 3.11.fb since this release</p>
<p>Just a single change to fix the Java linking (github issue <a href="https://github.com/facebook/rocksdb/issues/606" target="_blank" rel="noopener">#606</a>)</p>
<h2 id="RocksDB-3-11"><a href="#RocksDB-3-11" class="headerlink" title="RocksDB 3.11"></a><a href="https://github.com/facebook/rocksdb/releases/tag/rocksdb-3.11" target="_blank" rel="noopener">RocksDB 3.11</a></h2><p><a href="https://github.com/kradhakrishnan" target="_blank" rel="noopener"><img src="https://avatars0.githubusercontent.com/u/2488945?s=40&v=4" alt="@kradhakrishnan"></a> <a href="https://github.com/kradhakrishnan" target="_blank" rel="noopener">kradhakrishnan</a> released this on 22 May 2015 · <a href="https://github.com/facebook/rocksdb/compare/rocksdb-3.11...3.11.fb" target="_blank" rel="noopener">11 commits</a> to 3.11.fb since this release</p>
<h3 id="New-Features-57"><a href="#New-Features-57" class="headerlink" title="New Features"></a>New Features</h3><ul>
<li>Added a new API Cache::SetCapacity(size_t capacity) to dynamically change the maximum configured capacity of the cache. If the new capacity is less than the existing cache usage, the implementation will try to lower the usage by evicting the necessary number of elements following a strict LRU policy.</li>
<li>Added an experimental API for handling flashcache devices (blacklists background threads from caching their reads) – NewFlashcacheAwareEnv</li>
<li>If universal compaction is used and options.num_levels &gt; 1, files are compacted in upper levels with smaller files based on options.target_file_size_base. The limitation of file size when using universal compaction is greatly mitigated by using more levels. You can set num_levels = 1 to make universal compaction behave as before. If you set num_levels &gt; 1 and want to roll back to a previous version, you need to compact all files to a big file in level 0 (by setting target_file_size_base to be large and CompactRange(<cf_handle>, nullptr, nullptr, true, 0) and reopen the DB with the same version to rewrite the manifest, and then you can open it using previous releases.</li>
<li>More information about rocksdb background threads are available in Env::GetThreadList(), including the number of bytes read / written by a compaction job, mem-table size and current number of bytes written by a flush job and many more. Check include/rocksdb/thread_status.h for more detail.</li>
</ul>
<h3 id="Public-API-changes-1"><a href="#Public-API-changes-1" class="headerlink" title="Public API changes"></a>Public API changes</h3><ul>
<li>TablePropertiesCollector::AddUserKey() is added to replace TablePropertiesCollector::Add(). AddUserKey() exposes key type, sequence number and file size up to now to users.</li>
<li>DBOptions::bytes_per_sync used to apply to both WAL and table files. As of 3.11 it applies only to table files. If you want to use this option to sync WAL in the background, please use wal_bytes_per_sync</li>
</ul>
<h2 id="RocksDB-3-10-2"><a href="#RocksDB-3-10-2" class="headerlink" title="RocksDB 3.10.2"></a><a href="https://github.com/facebook/rocksdb/releases/tag/rocksdb-3.10.2" target="_blank" rel="noopener">RocksDB 3.10.2</a></h2><p><a href="https://github.com/igorcanadi" target="_blank" rel="noopener"><img src="https://avatars2.githubusercontent.com/u/1091023?s=40&v=4" alt="@igorcanadi"></a> <a href="https://github.com/igorcanadi" target="_blank" rel="noopener">igorcanadi</a> released this on 5 May 2015 · <a href="https://github.com/facebook/rocksdb/compare/rocksdb-3.10.2...3.10.fb" target="_blank" rel="noopener">8 commits</a> to 3.10.fb since this release</p>
<h2 id="Bug-fixes-since-3-10-1"><a href="#Bug-fixes-since-3-10-1" class="headerlink" title="Bug fixes since 3.10.1:"></a>Bug fixes since 3.10.1:</h2><ul>
<li>Make sure RocksDB is compiled with fallocate support</li>
<li>Fix possible hang in DB::Write()</li>
<li>Fix a possibility of SIGSEGV in CompactRange()</li>
</ul>
<h2 id="RocksDB-3-10-4-3-2015"><a href="#RocksDB-3-10-4-3-2015" class="headerlink" title="RocksDB 3.10 (4/3/2015)"></a><a href="https://github.com/facebook/rocksdb/releases/tag/v3.10" target="_blank" rel="noopener">RocksDB 3.10</a> (4/3/2015)</h2><p><a href="https://github.com/rven1" target="_blank" rel="noopener"><img src="https://avatars0.githubusercontent.com/u/8718743?s=40&v=4" alt="@rven1"></a> <a href="https://github.com/rven1" target="_blank" rel="noopener">rven1</a> released this on 4 Apr 2015 · <a href="https://github.com/facebook/rocksdb/compare/v3.10...master" target="_blank" rel="noopener">6070 commits</a> to master since this release</p>
<h3 id="New-Features-58"><a href="#New-Features-58" class="headerlink" title="New Features"></a>New Features</h3><ul>
<li>GetThreadStatus() is now able to report detailed thread status, including:<ul>
<li>Thread Operation including flush and compaction.</li>
<li>The stage of the current thread operation.</li>
<li>The elapsed time in micros since the current thread operation started.<br>More information can be found in include/rocksdb/thread_status.h. In addition, when running db_bench with –thread_status_per_interval, db_bench will also report thread status periodically.</li>
</ul>
</li>
<li>Changed the LRU caching algorithm so that referenced blocks (by iterators) are never evicted. This change made parameter removeScanCountLimit obsolete. Because of that NewLRUCache doesn’t take three arguments anymore. table_cache_remove_scan_limit option is also removed</li>
<li>By default we now optimize the compilation for the compilation platform (using -march=native). If you want to build portable binary, use ‘PORTABLE=1’ before the make command.</li>
<li>We now allow level-compaction to place files in different paths by<br>specifying them in db_paths along with the target_size.<br>Lower numbered levels will be placed earlier in the db_paths and higher<br>numbered levels will be placed later in the db_paths vector.</li>
<li>Potentially big performance improvements if you’re using RocksDB with lots of column families (100-1000)</li>
<li>Added BlockBasedTableOptions.format_version option, which allows user to specify which version of block based table he wants. As a general guidline, newer versions have more features, but might not be readable by older versions of RocksDB.</li>
<li>Added new block based table format (version 2), which you can enable by setting BlockBasedTableOptions.format_version = 2. This format changes how we encode size information in compressed blocks and should help with memory allocations if you’re using Zlib or BZip2 compressions.</li>
<li>MemEnv (env that stores data in memory) is now available in default library build. You can create it by calling NewMemEnv().</li>
<li>Add SliceTransform.SameResultWhenAppended() to help users determine it is safe to apply prefix bloom/hash.</li>
<li>Block based table now makes use of prefix bloom filter if it is a full fulter.</li>
<li>Block based table remembers whether a whole key or prefix based bloom filter is supported in SST files. Do a sanity check when reading the file with users’ configuration.</li>
<li>Fixed a bug in ReadOnlyBackupEngine that deleted corrupted backups in some cases, even though the engine was ReadOnly</li>
<li>options.level_compaction_dynamic_level_bytes, an experimental feature to allow RocksDB to pick dynamic base of bytes for levels. With this feature turned on, we will automatically adjust max bytes for each level. The goal of this feature is to have lower bound on size amplification. For more details, see comments in options.h.</li>
<li>Added an abstract base class WriteBatchBase for write batches</li>
<li>Fixed a bug where we start deleting files of a dropped column families even if there are still live references to it</li>
</ul>
<h3 id="Public-API-changes-2"><a href="#Public-API-changes-2" class="headerlink" title="Public API changes"></a>Public API changes</h3><ul>
<li>Deprecated skip_log_error_on_recovery and table_cache_remove_scan_count_limit options.</li>
<li>Logger method logv with log level parameter is now virtual</li>
</ul>
<h3 id="RocksJava"><a href="#RocksJava" class="headerlink" title="RocksJava"></a>RocksJava</h3><ul>
<li>Added compression per level API.</li>
<li>MemEnv is now available in RocksJava via RocksMemEnv class.</li>
<li>lz4 compression is now included in rocksjava static library when running <code>make rocksdbjavastatic</code>.</li>
<li>Overflowing a size_t when setting rocksdb options now throws an IllegalArgumentException, which removes the necessity for a developer to catch these Exceptions explicitly.</li>
</ul>
<h2 id="RocksDB-3-9-1"><a href="#RocksDB-3-9-1" class="headerlink" title="RocksDB 3.9.1"></a><a href="https://github.com/facebook/rocksdb/releases/tag/rocksdb-3.9.1" target="_blank" rel="noopener">RocksDB 3.9.1</a></h2><p><a href="https://github.com/yhchiang" target="_blank" rel="noopener"><img src="https://avatars2.githubusercontent.com/u/6447975?s=40&v=4" alt="@yhchiang"></a> <a href="https://github.com/yhchiang" target="_blank" rel="noopener">yhchiang</a> released this on 12 Dec 2014 · <a href="https://github.com/facebook/rocksdb/compare/rocksdb-3.9.1...3.9.fb" target="_blank" rel="noopener">5 commits</a> to 3.9.fb since this release</p>
<h3 id="Public-API-changes-3"><a href="#Public-API-changes-3" class="headerlink" title="Public API changes"></a>Public API changes</h3><ul>
<li>New API to create a checkpoint added. Given a directory name, creates a new<br>database which is an image of the existing database.<br>*New API LinkFile added to Env. If you implement your own Env class, an<br>implementation of the API LinkFile will have to be provided.</li>
<li>MemTableRep takes MemTableAllocator instead of Arena</li>
</ul>
<h3 id="Improvements"><a href="#Improvements" class="headerlink" title="Improvements"></a>Improvements</h3><ul>
<li>RocksDBLite library now becomes smaller and will be compiled with -fno-exceptions flag.</li>
</ul>
<h2 id="RocksDB-3-8"><a href="#RocksDB-3-8" class="headerlink" title="RocksDB 3.8"></a><a href="https://github.com/facebook/rocksdb/releases/tag/rocksdb-3.8" target="_blank" rel="noopener">RocksDB 3.8</a></h2><p><a href="https://github.com/igorcanadi" target="_blank" rel="noopener"><img src="https://avatars2.githubusercontent.com/u/1091023?s=40&v=4" alt="@igorcanadi"></a> <a href="https://github.com/igorcanadi" target="_blank" rel="noopener">igorcanadi</a> released this on 21 Nov 2014 · <a href="https://github.com/facebook/rocksdb/compare/rocksdb-3.8...3.8.fb" target="_blank" rel="noopener">6 commits</a> to 3.8.fb since this release</p>
<p>Public API changes</p>
<ul>
<li>BackupEngine::NewBackupEngine() was deprecated; please use BackupEngine::Open() from now on.</li>
<li>BackupableDB/RestoreBackupableDB have new GarbageCollect() methods, which will clean up files from corrupt and obsolete backups.</li>
<li>BackupableDB/RestoreBackupableDB have new GetCorruptedBackups() methods which list corrupt backups.</li>
</ul>
<p>Cleanup</p>
<ul>
<li>Bunch of code cleanup, some extra warnings turned on (-Wshadow, -Wshorten-64-to-32, -Wnon-virtual-dtor)</li>
</ul>
<p>New features</p>
<ul>
<li>CompactFiles and EventListener, although they are still in experimental state</li>
<li>Full ColumnFamily support in RocksJava.</li>
</ul>
<h2 id="RocksDB-3-7"><a href="#RocksDB-3-7" class="headerlink" title="RocksDB 3.7"></a><a href="https://github.com/facebook/rocksdb/releases/tag/rocksdb-3.7" target="_blank" rel="noopener">RocksDB 3.7</a></h2><p><a href="https://github.com/igorcanadi" target="_blank" rel="noopener"><img src="https://avatars2.githubusercontent.com/u/1091023?s=40&v=4" alt="@igorcanadi"></a> <a href="https://github.com/igorcanadi" target="_blank" rel="noopener">igorcanadi</a> released this on 12 Nov 2014 · <a href="https://github.com/facebook/rocksdb/compare/rocksdb-3.7...3.7.fb" target="_blank" rel="noopener">5 commits</a> to 3.7.fb since this release</p>
<ul>
<li><p>Introduce SetOptions() API to allow adjusting a subset of options dynamically online</p>
</li>
<li><p>Introduce 4 new convenient functions for converting Options from string: GetColumnFamilyOptionsFromMap(), GetColumnFamilyOptionsFromString(), GetDBOptionsFromMap(), GetDBOptionsFromString()</p>
</li>
<li><p>Remove WriteBatchWithIndex.Delete() overloads using SliceParts</p>
</li>
<li><p>When opening a DB, if options.max_background_compactions is larger than the existing low pri pool of options.env, it will enlarge it. Similarly, options.max_background_flushes is larger than the existing high pri pool of options.env, it will enlarge it.</p>
</li>
<li></li>
</ul>
<h2 id="RocksDB-3-6-2"><a href="#RocksDB-3-6-2" class="headerlink" title="RocksDB 3.6.2"></a><a href="https://github.com/facebook/rocksdb/releases/tag/rocksdb-3.6.2" target="_blank" rel="noopener">RocksDB 3.6.2</a></h2><p><a href="https://github.com/yhchiang" target="_blank" rel="noopener"><img src="https://avatars2.githubusercontent.com/u/6447975?s=40&v=4" alt="@yhchiang"></a> <a href="https://github.com/yhchiang" target="_blank" rel="noopener">yhchiang</a> released this on 30 Oct 2014 · <a href="https://github.com/facebook/rocksdb/compare/rocksdb-3.6.2...3.6.fb" target="_blank" rel="noopener">7 commits</a> to 3.6.fb since this release</p>
<h3 id="Bug-Fixes-114"><a href="#Bug-Fixes-114" class="headerlink" title="Bug Fixes"></a>Bug Fixes</h3><ul>
<li>Fix a corner case that causes MANIFEST corruption when RocksDB cannot open new files during the compaction but before the compaction completes RocksDB becomes able to open new files once again.</li>
</ul>
<h3 id="New-Features-59"><a href="#New-Features-59" class="headerlink" title="New Features"></a>New Features</h3><ul>
<li>Allow dynamic disable / enable RocksDB auto-compaction.</li>
</ul>
<h3 id="Internal-Improvements"><a href="#Internal-Improvements" class="headerlink" title="Internal Improvements"></a>Internal Improvements</h3><ul>
<li><p>Use fallocate(FALLOC_FL_PUNCH_HOLE) to release unused blocks at the end of file.</p>
</li>
<li></li>
</ul>
<h2 id="RocksDB-3-6-1"><a href="#RocksDB-3-6-1" class="headerlink" title="RocksDB 3.6.1"></a><a href="https://github.com/facebook/rocksdb/releases/tag/rocksdb-3.6.1" target="_blank" rel="noopener">RocksDB 3.6.1</a></h2><p><a href="https://github.com/igorcanadi" target="_blank" rel="noopener"><img src="https://avatars2.githubusercontent.com/u/1091023?s=40&v=4" alt="@igorcanadi"></a> <a href="https://github.com/igorcanadi" target="_blank" rel="noopener">igorcanadi</a> released this on 21 Oct 2014 · <a href="https://github.com/facebook/rocksdb/compare/rocksdb-3.6.1...3.6.fb" target="_blank" rel="noopener">12 commits</a> to 3.6.fb since this release</p>
<h3 id="New-features"><a href="#New-features" class="headerlink" title="New features"></a>New features</h3><ul>
<li>Support more column families without performance bottlenecks</li>
<li>Provide new way of passing options to RocksDB</li>
<li>Make some options dynamically changeable</li>
<li>Bunch of new Java bindings APIs</li>
</ul>
<h3 id="Disk-format-changes"><a href="#Disk-format-changes" class="headerlink" title="Disk format changes"></a>Disk format changes</h3><ul>
<li>If you’re using RocksDB on ARM platforms and you’re using default bloom filter, there is a disk format change you need to be aware of. There are three steps you need to do when you convert to new release: 1. turn off filter policy, 2. compact the whole database, 3. turn on filter policy</li>
</ul>
<h3 id="Behavior-changes-1"><a href="#Behavior-changes-1" class="headerlink" title="Behavior changes"></a>Behavior changes</h3><ul>
<li>We have refactored our system of stalling writes. Any stall-related statistics’ meanings are changed. Instead of per-write stall counts, we now count stalls per-epoch, where epochs are periods between flushes and compactions. You’ll find more information in our Tuning Perf Guide.</li>
<li>When disableDataSync=true, we no longer sync the MANIFEST file.</li>
<li>Add identity_as_first_hash property to CuckooTable. SST file needs to be rebuilt to be opened by reader properly.</li>
</ul>
<h3 id="Public-API-changes-4"><a href="#Public-API-changes-4" class="headerlink" title="Public API changes"></a>Public API changes</h3><ul>
<li>Change target_file_size_base type to uint64_t from int.</li>
<li>Remove allow_thread_local. This feature was proved to be stable, so we are turning it always-on.</li>
</ul>
<h2 id="RocksDB-3-5-1"><a href="#RocksDB-3-5-1" class="headerlink" title="RocksDB 3.5.1"></a><a href="https://github.com/facebook/rocksdb/releases/tag/rocksdb-3.5.1" target="_blank" rel="noopener">RocksDB 3.5.1</a></h2><p><a href="https://github.com/igorcanadi" target="_blank" rel="noopener"><img src="https://avatars2.githubusercontent.com/u/1091023?s=40&v=4" alt="@igorcanadi"></a> <a href="https://github.com/igorcanadi" target="_blank" rel="noopener">igorcanadi</a> released this on 9 Oct 2014 · <a href="https://github.com/facebook/rocksdb/compare/rocksdb-3.5.1...3.5.fb" target="_blank" rel="noopener">6 commits</a> to 3.5.fb since this release</p>
<p>RocksDB 3.5 including one bug fix that affected deployments that are triggering manual flushes.</p>
<h2 id="RocksDB-3-5-Release"><a href="#RocksDB-3-5-Release" class="headerlink" title="RocksDB 3.5 Release"></a><a href="https://github.com/facebook/rocksdb/releases/tag/rocksdb-3.5" target="_blank" rel="noopener">RocksDB 3.5 Release</a></h2><p><a href="https://github.com/iamjinlei" target="_blank" rel="noopener"><img src="https://avatars3.githubusercontent.com/u/6463139?s=40&v=4" alt="@iamjinlei"></a> <a href="https://github.com/iamjinlei" target="_blank" rel="noopener">iamjinlei</a> released this on 13 Sep 2014 · <a href="https://github.com/facebook/rocksdb/compare/rocksdb-3.5...3.5.fb" target="_blank" rel="noopener">8 commits</a> to 3.5.fb since this release</p>
<h3 id="New-Features-60"><a href="#New-Features-60" class="headerlink" title="New Features"></a>New Features</h3><ul>
<li>Add include/utilities/write_batch_with_index.h, providing a utility class to query data out of WriteBatch when building it.</li>
<li>new ReadOptions.total_order_seek to force total order seek when block-based table is built with hash index.</li>
</ul>
<h3 id="Public-API-changes-5"><a href="#Public-API-changes-5" class="headerlink" title="Public API changes"></a>Public API changes</h3><ul>
<li>The Prefix Extractor used with V2 compaction filters is now passed user key to SliceTransform::Transform instead of unparsed RocksDB key.</li>
<li>Move BlockBasedTable related options to BlockBasedTableOptions from Options. Change corresponding JNI interface. Options affected include: no_block_cache, block_cache, block_cache_compressed, block_size, block_size_deviation, block_restart_interval, filter_policy, whole_key_filtering. filter_policy is changed to shared_ptr from a raw pointer.</li>
<li>Remove deprecated options: disable_seek_compaction and db_stats_log_interval</li>
<li>OptimizeForPointLookup() takes one parameter for block cache size. It now builds hash index, bloom filter, and block cache.</li>
</ul>
<h2 id="RocksDB-3-4-Release"><a href="#RocksDB-3-4-Release" class="headerlink" title="RocksDB 3.4 Release"></a><a href="https://github.com/facebook/rocksdb/releases/tag/rocksdb-3.4" target="_blank" rel="noopener">RocksDB 3.4 Release</a></h2><p><a href="https://github.com/siying" target="_blank" rel="noopener"><img src="https://avatars0.githubusercontent.com/u/5334567?s=40&v=4" alt="@siying"></a> <a href="https://github.com/siying" target="_blank" rel="noopener">siying</a> released this on 28 Aug 2014 · <a href="https://github.com/facebook/rocksdb/compare/rocksdb-3.4...3.4.fb" target="_blank" rel="noopener">8 commits</a> to 3.4.fb since this release</p>
<h3 id="New-Features-61"><a href="#New-Features-61" class="headerlink" title="New Features"></a>New Features</h3><ul>
<li>Support Multiple DB paths in universal style compactions</li>
<li>Add feature of storing plain table index and bloom filter in SST file.</li>
<li>CompactRange() will never output compacted files to level 0. This used to be the case when all the compaction input files were at level 0.</li>
</ul>
<h3 id="Public-API-changes-6"><a href="#Public-API-changes-6" class="headerlink" title="Public API changes"></a>Public API changes</h3><ul>
<li>DBOptions.db_paths now is a vector of a DBPath structure which indicates both of path and target size</li>
<li>NewPlainTableFactory instead of bunch of parameters now accepts PlainTableOptions, which is defined in include/rocksdb/table.h</li>
<li>Moved include/utilities/<em>.h to include/rocksdb/utilities/</em>.h</li>
<li>Statistics APIs now take uint32_t as type instead of Tickers. Also make two access functions getTickerCount and histogramData const</li>
<li>Add DB property rocksdb.estimate-num-keys, estimated number of live keys in DB.</li>
<li>Add DB::GetIntProperty(), which returns DB properties that are integer as uint64_t.</li>
</ul>
<h3 id="Other-notes"><a href="#Other-notes" class="headerlink" title="Other notes"></a>Other notes</h3><ul>
<li>Fixed a data race bug that might cause segment fault</li>
<li>Fixed a bug of manual compaction.</li>
</ul>
<h2 id="RocksDB-3-3"><a href="#RocksDB-3-3" class="headerlink" title="RocksDB 3.3"></a><a href="https://github.com/facebook/rocksdb/releases/tag/rocksdb-3.3" target="_blank" rel="noopener">RocksDB 3.3</a></h2><p><a href="https://github.com/yhchiang" target="_blank" rel="noopener"><img src="https://avatars2.githubusercontent.com/u/6447975?s=40&v=4" alt="@yhchiang"></a> <a href="https://github.com/yhchiang" target="_blank" rel="noopener">yhchiang</a> released this on 30 Jul 2014 · <a href="https://github.com/facebook/rocksdb/compare/rocksdb-3.3...master" target="_blank" rel="noopener">7372 commits</a> to master since this release</p>
<h3 id="New-Features-62"><a href="#New-Features-62" class="headerlink" title="New Features"></a>New Features</h3><ul>
<li><strong>JSON API prototype</strong>.</li>
<li><strong>Performance improvement on HashLinkList</strong>: We addressed performance outlier of HashLinkList caused by skewed bucket by switching data in the bucket from linked list to skip list. Add parameter threshold_use_skiplist in NewHashLinkListRepFactory().</li>
<li><strong>More effective on storage space reclaim</strong>: RocksDB is now able to reclaim storage space more effectively during the compaction process. This is done by compensating the size of each deletion entry by the 2X average value size, which makes compaction to be triggerred by deletion entries more easily.</li>
<li><strong>TimeOut API to write</strong>: Now WriteOptions have a variable called timeout_hint_us. With timeout_hint_us set to non-zero, any write associated with this timeout_hint_us may be aborted when it runs longer than the specified timeout_hint_us, and it is guaranteed that any write completes earlier than the specified time-out will not be aborted due to the time-out condition.</li>
<li><strong>rate_limiter option</strong>: We added an option that controls total throughput of flush and compaction. The throughput is specified in bytes/sec. Flush always has precedence over compaction when available bandwidth is constrained.</li>
</ul>
<h3 id="Public-API-changes-7"><a href="#Public-API-changes-7" class="headerlink" title="Public API changes"></a>Public API changes</h3><ul>
<li>Removed NewTotalOrderPlainTableFactory because it is not used and implemented semantically incorrect.</li>
</ul>
<h2 id="RocksDB-3-2-release"><a href="#RocksDB-3-2-release" class="headerlink" title="RocksDB 3.2 release"></a><a href="https://github.com/facebook/rocksdb/releases/tag/rocksdb-3.2" target="_blank" rel="noopener">RocksDB 3.2 release</a></h2><p><a href="https://github.com/iamjinlei" target="_blank" rel="noopener"><img src="https://avatars3.githubusercontent.com/u/6463139?s=40&v=4" alt="@iamjinlei"></a> <a href="https://github.com/iamjinlei" target="_blank" rel="noopener">iamjinlei</a> released this on 28 Jun 2014 · <a href="https://github.com/facebook/rocksdb/compare/rocksdb-3.2...3.2.fb" target="_blank" rel="noopener">6 commits</a> to 3.2.fb since this release</p>
<p>New Features in RocksDB 3.2:</p>
<ul>
<li>PlainTable now supports a new key encoding: for keys of the same prefix, the prefix is only written once. It can be enabled through encoding_type paramter of NewPlainTableFactory()</li>
<li>Add AdaptiveTableFactory, which is used to convert from a DB of PlainTable to BlockBasedTabe, or vise versa. It can be created using NewAdaptiveTableFactory()</li>
</ul>
<p>Public API changes</p>
<ul>
<li>We removed seek compaction as a concept from RocksDB because:</li>
<li>Add two paramters to NewHashLinkListRepFactory() for logging on too many entries in a hash bucket when flushing.</li>
<li>Added new option BlockBasedTableOptions::hash_index_allow_collision. When enabled, prefix hash index for block-based table will not store prefix and allow hash collision, reducing memory consumption.</li>
</ul>
<h2 id="RocksDB-3-1"><a href="#RocksDB-3-1" class="headerlink" title="RocksDB 3.1"></a><a href="https://github.com/facebook/rocksdb/releases/tag/rocksdb-3.1" target="_blank" rel="noopener">RocksDB 3.1</a></h2><p><a href="https://github.com/igorcanadi" target="_blank" rel="noopener"><img src="https://avatars2.githubusercontent.com/u/1091023?s=40&v=4" alt="@igorcanadi"></a> <a href="https://github.com/igorcanadi" target="_blank" rel="noopener">igorcanadi</a> released this on 23 May 2014 · <a href="https://github.com/facebook/rocksdb/compare/rocksdb-3.1...3.1.fb" target="_blank" rel="noopener">6 commits</a> to 3.1.fb since this release</p>
<p>New features in RocksDB 3.1:</p>
<ul>
<li>Materialize hash index</li>
<li>FIFO Compaction</li>
</ul>
<p>Change LOG: <a href="https://github.com/facebook/rocksdb/blob/3.1.fb/HISTORY.md" target="_blank" rel="noopener">https://github.com/facebook/rocksdb/blob/3.1.fb/HISTORY.md</a></p>
<h2 id="RocksDB-3-0"><a href="#RocksDB-3-0" class="headerlink" title="RocksDB 3.0"></a><a href="https://github.com/facebook/rocksdb/releases/tag/3.0.fb" target="_blank" rel="noopener">RocksDB 3.0</a></h2><p><a href="https://github.com/igorcanadi" target="_blank" rel="noopener"><img src="https://avatars2.githubusercontent.com/u/1091023?s=40&v=4" alt="@igorcanadi"></a> <a href="https://github.com/igorcanadi" target="_blank" rel="noopener">igorcanadi</a> released this on 20 May 2014</p>
<p>New features in RocksDB 3.0:</p>
<ul>
<li>Column Family support (<a href="https://github.com/facebook/rocksdb/wiki/Column-Families" target="_blank" rel="noopener">https://github.com/facebook/rocksdb/wiki/Column-Families</a>)</li>
<li>Ability to use different checksum function in block based table. You can choose between crc32 and xxHash.</li>
<li>ReadOptions::prefix_seek and ReadOptions::prefix are deprecated</li>
<li>Full change log: <a href="https://github.com/facebook/rocksdb/blob/3.0.fb/HISTORY.md" target="_blank" rel="noopener">https://github.com/facebook/rocksdb/blob/3.0.fb/HISTORY.md</a></li>
</ul>

</div>


    <div class="post-guide">
        <div class="item left">
            
              <a href="/2020/11/12/02%20DevOps/02%20%E5%B8%B8%E7%94%A8%E8%BD%AF%E4%BB%B6/09%20%E7%9B%91%E6%8E%A7%E8%BF%9B%E7%A8%8B%E7%9A%84%E5%8F%A5%E6%9F%84%E5%8F%8A%E5%90%AF%E5%8A%A8%E6%97%B6%E9%97%B4/">
                  <i class="fa fa-angle-left" aria-hidden="true"></i>
                  09 监控进程的句柄及启动时间
              </a>
            
        </div>
        <div class="item right">
            
              <a href="/2020/08/31/05%20%E5%88%86%E5%B8%83%E5%BC%8F%E5%8F%8A%E6%95%B0%E6%8D%AE%E5%BA%93/05%20kafka/01%20kafka%E9%A9%B1%E5%8A%A8/">
                01 kafka驱动
                <i class="fa fa-angle-right" aria-hidden="true"></i>
              </a>
            
        </div>
    </div>



	<div id="vcomments"></div>


<script>
	
		// 评论
		new Valine({
			av: AV,
			el: '#vcomments',
			notify: false,
			verify: false,
			path: window.location.pathname,
			appId: 'kqRG1YI357MX0zgAERzjbptL-gzGzoHsz',
			appKey: '2PLYnaLv42a7NAbLhpOadDfj',
			placeholder: '请输入评论',
			avatar: 'retro',
			recordIP: false
		})
	
	
</script>
	</div>
	<div id="footer">
	<p>
	©2019-<span id="footerYear"></span> 
	<a href="/">Fly542</a> 
	
	
		|
		<span id="busuanzi_container_site_pv">
			pv
			<span id="busuanzi_value_site_pv"></span>
		</span>
		|
		<span id="busuanzi_container_site_uv"> 
			uv
			<span id="busuanzi_value_site_uv"></span>
		</span>
	
	<br>
	Powered by <a href="//fly542.cn" target="_blank">Fly542</a>
	</p>
</div>
<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?a630d6a8f1929d069d0a6c8ade4e9add";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>
<script src="/js/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>

	<button id="totop-toggle" class="toggle"><i class="fa fa-angle-double-up" aria-hidden="true"></i></button>
</body>
</html>