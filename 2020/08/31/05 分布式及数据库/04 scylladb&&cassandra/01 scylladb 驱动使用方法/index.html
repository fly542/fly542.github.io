<!DOCTYPE html>
<html lang="en">

<head>
	<meta http-equiv="content-type" content="text/html; charset=utf-8">
	<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
	<link rel="stylesheet" href="/css/highlight/styles/vs2015.css">
	<!-- title -->
	
	<title>
	
		05 分布式及数据库/04 scylladb&amp;&amp;cassandra/01 scylladb 驱动使用方法 | 
	 
	Fly542 技术积累
	</title>
	
	<!-- keywords,description -->
	 

	<!-- favicon -->
	
	<link rel="shortcut icon" href="/favicon.ico">
	
  

	
<link rel="stylesheet" href="/css/main.css">

	
<link rel="stylesheet" href="https://cdn.staticfile.org/font-awesome/4.7.0/css/font-awesome.min.css">

	
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.17.1/build/styles/darcula.min.css">


	
<script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.17.1/build/highlight.min.js"></script>

	
<script src="https://cdn.jsdelivr.net/npm/jquery@3.4.1/dist/jquery.min.js"></script>

	
<script src="https://cdn.jsdelivr.net/npm/jquery-pjax@2.0.1/jquery.pjax.min.js"></script>

	
<script src="/js/main.js"></script>

	
		
<script src="https://cdn.jsdelivr.net/npm/leancloud-storage/dist/av-min.js"></script>

		
<script src="https://cdn.jsdelivr.net/npm/valine@1.3.10/dist/Valine.min.js"></script>

	
	
		<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
	
<meta name="generator" content="Hexo 4.2.1"></head>

<body>
	<header id="header">
    <a id="title" href="/" class="logo">Fly542 技术积累</a>

	<ul id="menu">
		<li class="menu-item">
			<a href="/about" class="menu-item-link">关于我</a>
		</li>
		
		<li class="menu-item">
			<a href="https://fly542.cn" class="menu-item-link" target="_blank">
				<i class="fa fa-github fa-2x"></i>
			</a>
		</li>
	</ul>
</header>


	
<div id="sidebar">
	<button id="sidebar-toggle" class="toggle" ><i class="fa fa-arrow-right " aria-hidden="true"></i></button>
	
	<div id="site-toc">
		<input id="search-input" class="search-input" type="text" placeholder="search...">
		<div id="tree">
			

			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										00 操作系统
									</a>
									
							<ul>
								<li class="file">
									<a href="/2020/07/25/00%20%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/linux%E4%B8%8BIO%E5%BA%94%E7%94%A8%E8%AF%A6%E8%A7%A3/">
										linux下IO应用详解
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										01 架构设计与软件工程
									</a>
									
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										00 架构设计
									</a>
									
							<ul>
								<li class="file">
									<a href="/2020/07/25/01%20%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E4%B8%8E%E8%BD%AF%E4%BB%B6%E5%B7%A5%E7%A8%8B/00%20%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1/%E5%B8%B8%E8%A7%81%E6%9E%B6%E6%9E%84%E6%A8%A1%E5%BC%8F/">
										常见架构模式
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										01 软件工程
									</a>
									
							<ul>
								<li class="file">
									<a href="/2020/07/27/01%20%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E4%B8%8E%E8%BD%AF%E4%BB%B6%E5%B7%A5%E7%A8%8B/01%20%E8%BD%AF%E4%BB%B6%E5%B7%A5%E7%A8%8B/UML%E7%B1%BB%E5%9B%BE%E5%9B%BE%E7%A4%BA%E6%A0%B7%E4%BE%8B/">
										UML类图图示样例
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2020/07/27/01%20%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E4%B8%8E%E8%BD%AF%E4%BB%B6%E5%B7%A5%E7%A8%8B/01%20%E8%BD%AF%E4%BB%B6%E5%B7%A5%E7%A8%8B/%E6%97%B6%E5%BA%8F%E5%9B%BE%E3%80%81%E6%B4%BB%E5%8A%A8%E5%9B%BE%E3%80%81%E7%8A%B6%E6%80%81%E5%9B%BE%E3%80%81%E5%8D%8F%E4%BD%9C%E5%9B%BE%E7%9A%84%E5%8C%BA%E5%88%AB/">
										时序图、活动图、状态图、协作图的区别
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										02 设计模式
									</a>
									
							<ul>
								<li class="file">
									<a href="/2020/08/02/01%20%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E4%B8%8E%E8%BD%AF%E4%BB%B6%E5%B7%A5%E7%A8%8B/02%20%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/00%20%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E7%9A%84%E5%85%AD%E5%A4%A7%E5%8E%9F%E5%88%99/">
										00 设计模式的六大原则
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										01 创建型
									</a>
									
							<ul>
								<li class="file">
									<a href="/2020/08/01/01%20%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E4%B8%8E%E8%BD%AF%E4%BB%B6%E5%B7%A5%E7%A8%8B/02%20%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/01%20%E5%88%9B%E5%BB%BA%E5%9E%8B/01%20Abstract%20Factory(%E6%8A%BD%E8%B1%A1%E5%B7%A5%E5%8E%82)/">
										01 Abstract Factory(抽象工厂)
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2020/08/02/01%20%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E4%B8%8E%E8%BD%AF%E4%BB%B6%E5%B7%A5%E7%A8%8B/02%20%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/01%20%E5%88%9B%E5%BB%BA%E5%9E%8B/02%20Builder%20(%E7%94%9F%E6%88%90%E5%99%A8)/">
										02 Builder (生成器)
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										02 结构型
									</a>
									
							<ul>
								<li class="file">
									<a href="/2020/07/27/01%20%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E4%B8%8E%E8%BD%AF%E4%BB%B6%E5%B7%A5%E7%A8%8B/02%20%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/02%20%E7%BB%93%E6%9E%84%E5%9E%8B/01%20Adapter---%E9%80%82%E9%85%8D%E5%99%A8%E6%A8%A1%E5%BC%8F/">
										01 Adapter---适配器模式
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										03 行为型
									</a>
									
							<ul>
								<li class="file">
									<a href="/2020/08/01/01%20%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E4%B8%8E%E8%BD%AF%E4%BB%B6%E5%B7%A5%E7%A8%8B/02%20%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/03%20%E8%A1%8C%E4%B8%BA%E5%9E%8B/09%20Strategy%20(%E7%AD%96%E7%95%A5)/">
										09 Strategy (策略)
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
								</li>
								
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										02 DevOps
									</a>
									
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										01 程序运维
									</a>
									
							<ul>
								<li class="file">
									<a href="/2020/07/26/02%20DevOps/01%20%E7%A8%8B%E5%BA%8F%E8%BF%90%E7%BB%B4/00%20%E5%AE%9A%E4%BD%8Dcpu%20100_p%E7%9A%84%E6%96%B9%E6%B3%95/">
										00 定位cpu 100_p的方法
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2020/08/13/02%20DevOps/01%20%E7%A8%8B%E5%BA%8F%E8%BF%90%E7%BB%B4/01%20VIRT%E4%B8%8ERES%E5%8D%A0%E7%94%A8%E5%88%86%E6%9E%90/">
										01 VIRT与RES占用分析
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2020/08/14/02%20DevOps/01%20%E7%A8%8B%E5%BA%8F%E8%BF%90%E7%BB%B4/02%20%5B%E7%99%BE%E5%BA%A6%E5%88%86%E4%BA%AB%5D%E9%A2%91%E7%B9%81%E5%88%86%E9%85%8D%E9%87%8A%E6%94%BE%E5%86%85%E5%AD%98%E5%AF%BC%E8%87%B4%E7%9A%84%E6%80%A7%E8%83%BD%E9%97%AE%E9%A2%98%E5%88%86%E6%9E%90/">
										02 [百度分享]频繁分配释放内存导致的性能问题分析
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										02 常用软件
									</a>
									
							<ul>
								<li class="file">
									<a href="/2020/07/27/02%20DevOps/02%20%E5%B8%B8%E7%94%A8%E8%BD%AF%E4%BB%B6/00%20%E5%B8%B8%E7%94%A8git%E5%91%BD%E4%BB%A4/">
										00 常用git命令
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2020/07/30/02%20DevOps/02%20%E5%B8%B8%E7%94%A8%E8%BD%AF%E4%BB%B6/01%20%E5%BC%80%E5%8F%91%E6%9C%BA%E9%83%A8%E7%BD%B2/">
										01 开发机部署
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2020/07/30/02%20DevOps/02%20%E5%B8%B8%E7%94%A8%E8%BD%AF%E4%BB%B6/02%20%E5%A4%9A%E7%89%88%E6%9C%ACgcc%E9%83%A8%E7%BD%B2/">
										02 多版本gcc部署
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2020/07/30/02%20DevOps/02%20%E5%B8%B8%E7%94%A8%E8%BD%AF%E4%BB%B6/03%20vimrc%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6/">
										03 vimrc配置文件
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2020/07/31/02%20DevOps/02%20%E5%B8%B8%E7%94%A8%E8%BD%AF%E4%BB%B6/04%20goreplay%20%E5%BC%95%E6%B5%81%E6%B5%8B%E8%AF%95%E5%B7%A5%E5%85%B7/">
										04 goreplay 引流测试工具
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2014/08/01/02%20DevOps/02%20%E5%B8%B8%E7%94%A8%E8%BD%AF%E4%BB%B6/05%20scons%E5%AE%9E%E7%94%A8%E8%AF%B4%E6%98%8E/">
										05 scons实用说明
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2012/03/20/02%20DevOps/02%20%E5%B8%B8%E7%94%A8%E8%BD%AF%E4%BB%B6/06%20ssh%E8%B7%B3%E8%BD%AC%E6%97%A0%E5%AF%86%E7%A0%81%E7%99%BB%E5%BD%95%E6%88%96%E6%89%A7%E8%A1%8C%E5%91%BD%E4%BB%A4/">
										06 ssh跳转无密码登录或执行命令
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2018/05/03/02%20DevOps/02%20%E5%B8%B8%E7%94%A8%E8%BD%AF%E4%BB%B6/07%20%E6%9C%AC%E5%9C%B0%E6%96%87%E4%BB%B6%E6%98%A0%E5%B0%84%E4%B8%BA%E7%A3%81%E7%9B%98/">
										07 本地文件映射为磁盘
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2020/08/27/02%20DevOps/02%20%E5%B8%B8%E7%94%A8%E8%BD%AF%E4%BB%B6/08%20Python%20%E5%86%85%E7%BD%AE%E7%9A%84SimpleHTTPServer%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/">
										08 Python 内置的SimpleHTTPServer使用指南
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										03 工具参考
									</a>
									
							<ul>
								<li class="file">
									<a href="/2020/08/20/02%20DevOps/03%20%E5%B7%A5%E5%85%B7%E5%8F%82%E8%80%83/00%20objdump%20%E4%BA%8C%E8%BF%9B%E5%88%B6%E6%96%87%E4%BB%B6%E5%88%86%E6%9E%90/">
										00 objdump 二进制文件分析
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2020/08/20/02%20DevOps/03%20%E5%B7%A5%E5%85%B7%E5%8F%82%E8%80%83/01%20lsof%20%E4%B8%80%E5%88%87%E7%9A%86%E6%96%87%E4%BB%B6/">
										01 lsof 一切皆文件
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2020/08/20/02%20DevOps/03%20%E5%B7%A5%E5%85%B7%E5%8F%82%E8%80%83/02%20strace%20%E8%B7%9F%E8%B8%AA%E8%BF%9B%E7%A8%8B%E4%B8%AD%E7%9A%84%E7%B3%BB%E7%BB%9F%E8%B0%83%E7%94%A8/">
										02 strace 跟踪进程中的系统调用
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2020/08/20/02%20DevOps/03%20%E5%B7%A5%E5%85%B7%E5%8F%82%E8%80%83/03%20pstack%20%E8%B7%9F%E8%B8%AA%E8%BF%9B%E7%A8%8B%E6%A0%88/">
										03 pstack 跟踪进程栈
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										03 开发
									</a>
									
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										00 算法与数据结构
									</a>
									
							<ul>
								<li class="file">
									<a href="/2014/08/01/03%20%E5%BC%80%E5%8F%91/00%20%E7%AE%97%E6%B3%95%E4%B8%8E%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/01%20(%E8%BD%AC%E8%BD%BD)%E4%B8%80%E8%87%B4%E6%80%A7hash%E7%AE%97%E6%B3%95(consistent%20hashing)/">
										01 (转载)一致性hash算法(consistent hashing)
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2020/07/27/03%20%E5%BC%80%E5%8F%91/00%20%E7%AE%97%E6%B3%95%E4%B8%8E%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/02%20MD5%E7%AE%97%E6%B3%95%E5%8E%9F%E7%90%86/">
										02 MD5算法原理
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2020/08/15/03%20%E5%BC%80%E5%8F%91/00%20%E7%AE%97%E6%B3%95%E4%B8%8E%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/03%20%E4%BC%B8%E5%B1%95%E6%A0%91(splay)/">
										03 伸展树(splay)
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										01 C&C++
									</a>
									
							<ul>
								<li class="file">
									<a href="/2020/08/16/03%20%E5%BC%80%E5%8F%91/01%20C&C++/00%20C++%20%E5%86%85%E5%AD%98%E5%88%86%E9%85%8D(new%EF%BC%8Coperator%20new)%E8%AF%A6%E8%A7%A3/">
										00 C++ 内存分配(new，operator new)详解
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2020/08/03/03%20%E5%BC%80%E5%8F%91/01%20C&C++/01%20getopt%E4%B8%8Egetopt_long%E4%BD%BF%E7%94%A8/">
										01 getopt与getopt_long使用
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2020/07/26/03%20%E5%BC%80%E5%8F%91/01%20C&C++/02%20%E5%A4%A7%E7%AB%AF-%E5%B0%8F%E7%AB%AF%E5%AF%B9%E9%BD%90%E5%88%A4%E5%AE%9A%E5%87%BD%E6%95%B0/">
										02 大端-小端对齐判定函数
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2020/08/28/03%20%E5%BC%80%E5%8F%91/01%20C&C++/03%20Linux%E4%B8%AD%E7%BA%BF%E7%A8%8B%E4%B8%8ECPU%E6%A0%B8%E7%9A%84%E7%BB%91%E5%AE%9A/">
										03 Linux中线程与CPU核的绑定
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2020/08/29/03%20%E5%BC%80%E5%8F%91/01%20C&C++/04%20typedef%20%E7%B2%BE%E9%AB%93/">
										04 typedef 精髓
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										02 Rust
									</a>
									
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										00 fun_code
									</a>
									
							<ul>
								<li class="file">
									<a href="/2020/07/31/03%20%E5%BC%80%E5%8F%91/02%20Rust/00%20fun_code/rust%20%E5%AE%9E%E7%8E%B0%E5%87%BD%E6%95%B0%E9%87%8D%E8%BD%BD/">
										rust 实现函数重载
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2020/07/31/03%20%E5%BC%80%E5%8F%91/02%20Rust/00%20fun_code/rust%20%E8%8E%B7%E5%8F%96%E5%BD%93%E5%89%8D%E7%9A%84%E6%97%B6%E9%97%B4%E6%88%B3/">
										rust 获取当前的时间戳
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2020/07/31/03%20%E5%BC%80%E5%8F%91/02%20Rust/00%20fun_code/vec%E5%90%88%E5%B9%B6%E6%95%B0%E6%8D%AE%E6%97%B6%E9%98%B2%E6%AD%A2%E5%87%BA%E7%8E%B0%E6%8B%B7%E8%B4%9D%E7%9A%84%E6%96%B9%E6%B3%95/">
										vec合并数据时防止出现拷贝的方法
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2020/07/31/03%20%E5%BC%80%E5%8F%91/02%20Rust/00%20fun_code/%E5%90%8C%E4%B8%80%E4%B8%AAcrate%E5%86%85%E4%B8%8D%E5%90%8Clib%E6%88%96%E7%A8%8B%E5%BA%8F%E9%97%B4%E7%9A%84%E5%BC%95%E7%94%A8/">
										同一个crate内不同lib或程序间的引用
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2020/07/31/03%20%E5%BC%80%E5%8F%91/02%20Rust/00%20fun_code/%E6%89%93%E5%8D%B0%E5%8F%82%E6%95%B0%E7%B1%BB%E5%9E%8B/">
										打印参数类型
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2020/07/31/03%20%E5%BC%80%E5%8F%91/02%20Rust/00%20fun_code/%E6%89%93%E5%8D%B0%E5%8F%98%E9%87%8F%E5%9C%B0%E5%9D%80/">
										打印变量地址
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2020/07/31/03%20%E5%BC%80%E5%8F%91/02%20Rust/00%20fun_code/%E6%9C%89%E8%B6%A3%E7%9A%84%E6%89%80%E6%9C%89%E6%9D%83%E9%97%AE%E9%A2%98%E9%97%AE%E9%A2%98/">
										有趣的所有权问题问题
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2020/07/31/03%20%E5%BC%80%E5%8F%91/02%20Rust/rust%20%E5%AE%8F/">
										rust 宏
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2020/07/25/03%20%E5%BC%80%E5%8F%91/02%20Rust/rust-%E4%B8%BA%E4%BB%80%E4%B9%88%E4%B8%8D%E8%83%BD%E5%B0%86u32%E8%BD%AC%E6%8D%A2%E4%B8%BAchar%EF%BC%9F/">
										rust-为什么不能将u32转换为char？
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2020/07/31/03%20%E5%BC%80%E5%8F%91/02%20Rust/%E4%B8%BA%E4%BB%80%E4%B9%88%E5%87%BD%E6%95%B0%E5%8F%82%E6%95%B0%E6%8F%90%E7%A4%BA%E3%80%8Aremove%20this%20mut%E3%80%8B/">
										为什么函数参数提示《remove this mut》
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										03 Shell
									</a>
									
							<ul>
								<li class="file">
									<a href="/2020/07/30/03%20%E5%BC%80%E5%8F%91/03%20Shell/awk%E5%B8%B8%E7%94%A8%E6%96%B9%E6%B3%95/">
										awk常用方法
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2020/07/27/03%20%E5%BC%80%E5%8F%91/03%20Shell/%E5%88%A9%E7%94%A8Shell%E5%91%BD%E4%BB%A4%E8%8E%B7%E5%8F%96IP%E5%9C%B0%E5%9D%80/">
										利用Shell命令获取IP地址
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2018/11/30/03%20%E5%BC%80%E5%8F%91/03%20Shell/%E7%9B%91%E6%8E%A7%E6%8C%87%E5%AE%9A%E8%BF%9B%E7%A8%8B%E7%9A%84%E5%8F%A5%E6%9F%84%E4%BF%A1%E6%81%AF/">
										监控指定进程的句柄信息
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										04 网络
									</a>
									
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										00 DNS
									</a>
									
							<ul>
								<li class="file">
									<a href="/2020/08/26/04%20%E7%BD%91%E7%BB%9C/00%20DNS/00%20DNS%E5%8D%8F%E8%AE%AE/">
										00 DNS协议
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2020/08/26/04%20%E7%BD%91%E7%BB%9C/00%20DNS/01%20DNS%E4%B8%ADRR%E4%BB%8B%E7%BB%8D/">
										01 DNS中RR介绍
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2020/07/27/04%20%E7%BD%91%E7%BB%9C/hello-world/">
										hello-world
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										05 分布式及数据库
									</a>
									
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										00 传统数据库
									</a>
									
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										00 mysql
									</a>
									
							<ul>
								<li class="file">
									<a href="/2020/07/27/05%20%E5%88%86%E5%B8%83%E5%BC%8F%E5%8F%8A%E6%95%B0%E6%8D%AE%E5%BA%93/00%20%E4%BC%A0%E7%BB%9F%E6%95%B0%E6%8D%AE%E5%BA%93/00%20mysql/mysql%20%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/">
										mysql 常用命令
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										01 sqlite
									</a>
									
							<ul>
								<li class="file">
									<a href="/2020/07/26/05%20%E5%88%86%E5%B8%83%E5%BC%8F%E5%8F%8A%E6%95%B0%E6%8D%AE%E5%BA%93/00%20%E4%BC%A0%E7%BB%9F%E6%95%B0%E6%8D%AE%E5%BA%93/01%20sqlite/sqlite3%20%E5%AE%A2%E6%88%B7%E7%AB%AF%E6%93%8D%E4%BD%9C%E5%91%BD%E4%BB%A4/">
										sqlite3 客户端操作命令
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										02 Pika
									</a>
									
							<ul>
								<li class="file">
									<a href="/2020/07/29/05%20%E5%88%86%E5%B8%83%E5%BC%8F%E5%8F%8A%E6%95%B0%E6%8D%AE%E5%BA%93/02%20Pika/pika%20%E8%BF%90%E7%BB%B4%E5%91%BD%E4%BB%A4/">
										pika 运维命令
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										03 squid
									</a>
									
							<ul>
								<li class="file">
									<a href="/2020/08/16/05%20%E5%88%86%E5%B8%83%E5%BC%8F%E5%8F%8A%E6%95%B0%E6%8D%AE%E5%BA%93/03%20squid/00%20squid%20%E5%86%85%E5%AD%98%E6%B1%A0%E7%A0%94%E7%A9%B6/">
										00 squid 内存池研究
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2020/08/22/05%20%E5%88%86%E5%B8%83%E5%BC%8F%E5%8F%8A%E6%95%B0%E6%8D%AE%E5%BA%93/03%20squid/01%20suqid%20%E5%AD%98%E5%82%A8%E6%A8%A1%E5%9E%8B%E7%A0%94%E7%A9%B6/">
										01 suqid 存储模型研究
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										04 scylladb&&cassandra
									</a>
									
							<ul>
								<li class="file">
									<a href="/2020/08/19/05%20%E5%88%86%E5%B8%83%E5%BC%8F%E5%8F%8A%E6%95%B0%E6%8D%AE%E5%BA%93/04%20scylladb&&cassandra/00%20scylladb/">
										00 scylladb
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file active">
									<a href="/2020/08/31/05%20%E5%88%86%E5%B8%83%E5%BC%8F%E5%8F%8A%E6%95%B0%E6%8D%AE%E5%BA%93/04%20scylladb&&cassandra/01%20scylladb%20%E9%A9%B1%E5%8A%A8%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95/">
										01 scylladb 驱动使用方法
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										05 kafka
									</a>
									
							<ul>
								<li class="file">
									<a href="/2020/08/31/05%20%E5%88%86%E5%B8%83%E5%BC%8F%E5%8F%8A%E6%95%B0%E6%8D%AE%E5%BA%93/05%20kafka/00%20kafka%E5%9F%BA%E7%A1%80/">
										00 kafka基础
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										06 杂项
									</a>
									
							<ul>
								<li class="file">
									<a href="/2020/08/19/06%20%E6%9D%82%E9%A1%B9/00%20%E7%A0%94%E5%8F%91%E9%A1%B9%E7%9B%AE%E4%BA%A4%E6%8E%A5%E5%86%85%E5%AE%B9/">
										00 研发项目交接内容
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
		</div>
	</div>
</div>

	<!-- 引入正文 -->
	<div id="content">
		<h1 id="article-title">

	01 scylladb 驱动使用方法
</h1>
<div class="article-meta">
	
	<span>Fly542</span>
	<span>2020-08-31 12:32:15</span>
    
		<div id="article-categories">
            
		</div>
    
</div>

<div id="article-content">
	<p>本文主要总结下 scylladb 的c/c++驱动使用详细方法与步骤，便于快速进行开发。</p>
<h2 id="1-基本使用步骤"><a href="#1-基本使用步骤" class="headerlink" title="1. 基本使用步骤"></a>1. 基本使用步骤</h2><h3 id="创建-cluster"><a href="#创建-cluster" class="headerlink" title="创建 cluster"></a>创建 cluster</h3><ol>
<li><p>创建方法：<br> CassCluster * cluster = cass_cluster_new();<br> cass_cluster_free(cluster); //不用时释放申请的资源</p>
</li>
<li><p>对cluster进行参数设置</p>
</li>
</ol>
<p>根据需要对cluster 进行各种相关参数的设置，主要进行以下设置</p>
<pre><code>cass_cluster_set_port(cluster, port);  //设置集群连接的端口号
cass_cluster_set_contact_points(cluster, addr); //设置集群连接地址，只需要指定一个地址即可
cass_cluster_set_credentials(cluster, user, pass); //设置集群连接时的认证信息(用户名、密码)
cass_cluster_set_num_threads_io(cluster, num); //设置处理io的线程数，，默认2个
cass_cluster_set_core_connections_per_host(cluster, count); // 设置集群中每个服务端的连接数，默认为1个</code></pre><p>总的io连接数=io线程数 × 每个服务端的连接数 × 集群服务端个数</p>
<h3 id="创建-session"><a href="#创建-session" class="headerlink" title="创建 session"></a>创建 session</h3><p>CassSession维护每个节点的连接以及可调整的I / O线程池，以根据负载平衡策略进行查询。 因为CassSession是线程安全的，所以通常建议您为每个 keyspace 创建一个会话，并在应用程序线程之间共享它。</p>
<pre><code>    CassSession * session = cass_session_new();
    cass_session_free(session);  //不用时释放申请的资源</code></pre><h3 id="执行操作语句"><a href="#执行操作语句" class="headerlink" title="执行操作语句"></a>执行操作语句</h3><p>执行操作主要按以下步骤进行处理</p>
<ol>
<li>创建操作执行对象<pre><code>CassStatement * statement = cass_statement_new(qstr.c_str(), 0);</code></pre>第一个参数为要执行的操作语句，第二个参数代表要使用的占位符个数，在批量循环处理的时候使用占位符时使用，</li>
<li>执行具体操作语句<pre><code>CassFuture * futrue = cass_session_execute(session, statement);</code></pre></li>
<li>等待执行结果<pre><code>cass_future_wait(future);</code></pre></li>
<li>判定执行结果<pre><code>if (CASS_OK != cass_future_error_code(future)) {
 // 异常处理
} else {
 // 成功执行相关语句
}</code></pre></li>
<li>释放执行资源<pre><code> cass_statement_free(statement);
 cass_future_free(future);</code></pre></li>
</ol>
<h2 id="2-封装库示例"><a href="#2-封装库示例" class="headerlink" title="2. 封装库示例"></a>2. 封装库示例</h2><p>头文件db_scylla.h</p>
<pre><code>
#include &lt;vector&gt;
#include &lt;cassandra.h&gt;

namespace DB {

class ed_error;

class scylla_obj
{ //数据库查询查询传递对象
public:
    scylla_obj() {}
    ~scylla_obj () {}

public:
    std::string  uri_;                          //uri
    std::vector&lt;std::string&gt; vidc_;             //idc列表
};
class record_scylla : public record_base
{
public:
    record_scylla();
    ~record_scylla();

public:
    std::string  uri_;                           //uri
    std::string  vidc_;                          //vidc
    std::string  cache_;                         //cache
    std::string  zone_;                          //zone
    int     type_;                          //type
};

class db_scylla
{
public:
    db_scylla ();
    ~db_scylla ();

    /**
     * 打开数据库
     * @param addr 要打开的地址
     * @param port 要打开的端口号
     * @return true 成功打开，false 打开失败
     */
    bool open(const char * addr, int port);

    /**
     * 查询内容
     * @param obj 要查询的信息
     * @param bhot 是否是查询热点数据
     * @param vec 返回查询结果
     * @param err 错误时返回错误详细信息
     * @return true 成功查询，false 未查询到
     */
    bool query(const scylla_obj &amp; obj, bool bhot,
            std::vector&lt;record_scylla&gt; &amp; vec, ed_error * err);

    /**
     * 批量插入数据
     * @param vec 要插入的数据总量
     * @param ttl 过期时间 &lt;=0 则永不过期，单位秒
     * @param err 出错时返回错误详细信息
     * @return  成功插入记录数
     */
    size_t insert(const std::vector&lt;record_scylla&gt; &amp; vec,
            long long ttl, ed_error * err);

    /**
     * 删除数据
     * @param vec 要删除的记录
     * @param err 出错时返回错误详细信息
     * @return 成功删除的记录数
     */
    size_t remove(const std::vector&lt;record_scylla&gt; &amp; vec, ed_error * err);
public:
    /**
     * 设置认证的用户名和密码
     * @param user 用户名
     * @param pass 密码
     */
    void set_auth(const char * user, const char * pass);

    /**
     * 设置连接超时
     * @param ms_timeout 超时时间，单位ms
     */
    void set_conn_timeout(int ms_timeout);

    /**
     * 设置读写超时
     * @param timeout 超时时间，单位ms
     */
    void set_rw_timeout(int ms_timeout);

    /**
     * 设置scyllad 处理io的线程数
     * @param cn 线程数
     */
    void set_io_thread_num(int cn);
private:
    /**
     * 创建session连接
     * @return 非NULL 成功连接，返回连接对象，NULL 连接失败
     */
    CassSession* create_connect_session(ed_error *err);

    /**
     * 获取查询的字符串信息
     * @param obj 要查询的对象信息
     * @param bhot 是否是查询热点数据
     * @param str 返回查询字符串
     * @param cloNum 返回查询的字段个数
     */
    void get_query_string(const scylla_obj &amp; obj, bool bhot, acl::string &amp; str);

    /**
     * 从row中解析一条记录到vec中
     * @param row 要解析的行
     * @param bhot 是否是查询热点数据
     * @param vec 存储解析结果
     * @return true 成功解析，false 解析失败
     */
    bool parse_one_record(const CassRow* row, bool bhot,
            std::vector&lt;record_scylla&gt; &amp; vec);

    /**
     * 获取其中某一列的值
     * @param row 行信息
     * @param cname 列名
     * @param value 返回获取到的value
     * @return true 成功获取，false 获取失败
     */
    bool get_col_value(const CassRow* row, const char * cname,
            std::string &amp; value);
    bool get_col_value(const CassRow* row, const char * cname, int &amp; value);

    /**
     * 获取删除条件字符串
     * @param key 添加的条件字符串
     * @param key_title 添加时使用的关键字
     * @param all 返回添加后的结果
     */
    void get_remove_cond_str(const std::string &amp; key,
            const char * key_title, std::string &amp; all);
    void get_remove_cond_int(int key, const char * key_title, std::string &amp; all);

    /**
     * 从连接池池中获取一个连接
     */
    CassSession * get_session(ed_error * err);

    /**
     * 归还使用后的session
     * @param session 要归还的session
     * @param bok false session 异常，true 正常
     */
    void put_session(CassSession * session, bool bok);
private:
    int port_;                          //端口号
    int conn_timeout_;                  //连接超时
    int rw_timeout_;                    //读写超时
    int thread_num_;                    //处理io线程数
    std::string addr_;                  //连接地址
    std::string user_;                  //用户名
    std::string pass_;                  //密码
    CassSession * session_;
#    QLock lock_;                        // pool_ 实际应用时需要考虑加 锁
};

} /* DB */
</code></pre><p>db_scylla.cpp</p>
<pre><code>#include &quot;stdafx.h&quot;

#include &quot;db_scylla.h&quot;

namespace DB {

static const char * CONST_COL_URI = &quot;uri&quot;;
static const char * CONST_COL_VIDC = &quot;vidc&quot;;
static const char * CONST_COL_CACHE = &quot;cache&quot;;
static const char * CONST_COL_TYPE = &quot;typ&quot;;

static const char * CONST_COL_ZONE = &quot;zone&quot;;
static const char * CONST_COL_LEVEL = &quot;level&quot;;
static const char * KEYSPACE_TABLE=&quot;keyspace.test_table&quot;;

db_scylla::db_scylla()
: port_(9042)
, conn_timeout_(2000)
, rw_timeout_(2000)
, thread_num_(10)
, cluster_(NULL)
, session_(NULL)
{
}

db_scylla::~db_scylla() {
    if(cluster_) {
        cass_cluster_free(cluster_);
    }
    if(session_) {
        cass_session_free(session_);
        session_ = NULL;
    }
}

bool db_scylla::open(const char * addr, int port) {
    if(NULL==addr || port&gt;65535 || port&lt;=0) {
        printf(&quot;open scylladb failed addr=%s, port=%d\n&quot;,
                NULL==addr?&quot;NULL&quot;:addr, port);
        return false;
    }

    cluster_ = cass_cluster_new();
    cass_cluster_set_port(cluster_, port);
    cass_cluster_set_contact_points(cluster_, addr);
    cass_cluster_set_credentials(cluster_, user_.c_str(), pass_.c_str());
    cass_cluster_set_num_threads_io(cluster_, thread_num_); //处理请求的线程数
    //cass_cluster_set_max_connections_per_host(cluster_, 50); //被废弃可不用了
    //cass_cluster_set_core_connections_per_host(cluster_, 1); //每个线程的连接, 不用设置太多，默认的就够
    return true;
}

void db_scylla::get_remove_cond_str(const std::string &amp; key,
        const char * key_title, std::string &amp; all) {
    if(key.empty()) {
        return ;
    }
    acl::string tmp;
    tmp.format(&quot;%s=&#39;%s&#39;&quot;,key_title, key.c_str());
    if(false == all.empty()) {
        all.append(&quot; AND &quot;);
    }
    all.append(tmp.c_str());
}

void db_scylla::get_remove_cond_int(int key,
        const char * key_title, std::string &amp; all) {
    if(key&lt;0) {
        return ;
    }
    acl::string tmp;
    tmp.format(&quot;%s=%d&quot;,key_title, key);
    if(false == all.empty()) {
        all.append(&quot; AND &quot;);
    }
    all.append(tmp.c_str());
}

size_t db_scylla::remove(const std::vector&lt;record_scylla&gt; &amp; vec, ed_error * err) {
    size_t iok = 0;
    CassSession * session = get_session(err);
    if(NULL==session || vec.empty()) {
        return iok;
    }

    CassFuture* futures[ vec.size() ];
    for(size_t i=0; i&lt;vec.size(); ++i) {
        std::string strtmp;
        get_remove_cond_str(vec[i].uri_, CONST_COL_URI, strtmp);
        get_remove_cond_str(vec[i].vidc_, CONST_COL_VIDC, strtmp);
        get_remove_cond_str(vec[i].cache_, CONST_COL_CACHE, strtmp);
        get_remove_cond_int(vec[i].type_, CONST_COL_TYPE, strtmp);

        acl::string qstr;
        qstr.format(&quot;DELETE FROM cdn_global_index.uri_index WHERE %s ;&quot;, strtmp.c_str());
        CassStatement * statement = cass_statement_new(qstr.c_str(), 0);
        futures[i] = cass_session_execute(session, statement);
        cass_statement_free(statement);
    }

    for (size_t i=0; i&lt;vec.size(); ++i) {
        CassFuture* future = futures[i];
        cass_future_wait(future);
        CassError rc = cass_future_error_code(future);
        if (rc != CASS_OK) {
            ADD_ED_ERROR(err, ERR_SDB_DELETE, &quot;%s failed. err=%s&quot;, vec[i].uri_.c_str(),
                    cass_error_desc(rc));
        } else {
            iok++;
        }
        cass_future_free(future);
    }
    put_session(session, 0==iok?false:true);
    return iok;
}

size_t  db_scylla::insert(const std::vector&lt;record_scylla&gt; &amp; vec, long long ttl,
        ed_error * err) {
    size_t iok = 0;
    CassSession * session = get_session(err);
    if(NULL==session || vec.empty()) {
        return iok;
    }
    acl::string qstr;
    if(ttl&gt;0) {
        qstr.format(&quot;INSERT INTO %s (%s, %s, %s, %s) VALUES(?,?,?,?) USING TTL %lld;&quot;,
                KEYSPACE_TABLE, CONST_COL_URI, CONST_COL_VIDC, CONST_COL_CACHE, CONST_COL_TYPE, ttl);
    } else {
        qstr.format(&quot;INSERT INTO %s (%s, %s, %s, %s) VALUES(?,?,?,?) ;&quot;,
                KEYSPACE_TABLE, CONST_COL_URI, CONST_COL_VIDC, CONST_COL_CACHE, CONST_COL_TYPE);
    }
    CassFuture* futures[ vec.size() ];
    for(size_t i=0; i&lt;vec.size(); ++i) {
        CassStatement * statement = cass_statement_new(qstr.c_str(), 4);
        cass_statement_bind_string(statement, 0, vec[i].uri_.c_str());
        cass_statement_bind_string(statement, 1, vec[i].vidc_.c_str());
        cass_statement_bind_string(statement, 2, vec[i].cache_.c_str());
        cass_statement_bind_int32(statement, 3, vec[i].type_);

        futures[i] = cass_session_execute(session, statement);
        cass_statement_free(statement);
    }

    for (size_t i=0; i&lt;vec.size(); ++i) {
        CassFuture* future = futures[i];
        cass_future_wait(future);
        CassError rc = cass_future_error_code(future);
        if (rc != CASS_OK) {
            ADD_ED_ERROR(err, ERR_SDB_INSERT, &quot;%s failed. err=%s&quot;, vec[i].uri_.c_str(),
                    cass_error_desc(rc));
        } else {
            iok++;
        }
        cass_future_free(future);
    }
    put_session(session, 0==iok?false:true);
    return iok;
}

bool db_scylla::query(const scylla_obj &amp; obj, bool bhot,
        std::vector&lt;record_scylla&gt; &amp; vec, ed_error * err) {
    CassSession * session = get_session(err);
    if(NULL==session) {
        return false;
    }
    CassError rc = CASS_OK;
    acl::string qstr;
    get_query_string(obj, bhot, qstr);
    CassStatement * statement = cass_statement_new(qstr.c_str(), 0);
    CassFuture * future = cass_session_execute(session, statement);
    if(CASS_OK!=(rc=cass_future_error_code(future))) {
        ADD_ED_ERROR(err, ERR_SDB_QUERY, &quot;query cass_future_wait failed. err=%s&quot;,
                cass_error_desc(rc));
    } else {
        const CassResult* result = cass_future_get_result(future);
        CassIterator* iterator = cass_iterator_from_result(result);
        while (cass_iterator_next(iterator)) {
            const CassRow* row = cass_iterator_get_row(iterator);
            parse_one_record(row, bhot, vec);
        }
        cass_result_free(result);
        cass_iterator_free(iterator);
    }

    cass_future_free(future);
    cass_statement_free(statement);
    put_session(session, rc==CASS_OK);
    return rc==CASS_OK;
}


CassSession * db_scylla::get_session(ed_error * err) {
    lock_.lock();
    if(NULL==session_) {
        session_ = create_connect_session(err);
    }
    lock_.unlock();
    return session_;
    CassSession * session = NULL;
    lock_.lock();
    if(pool_.empty()) {
        lock_.unlock();
        session = create_connect_session(err);
    } else {
        session = pool_.front();
        pool_.pop_front();
        lock_.unlock();
    }
    return session;
}

void db_scylla::put_session(CassSession * session, bool bok) {
    return;
    if(bok) {
        lock_.lock();
        pool_.push_back(session);
        lock_.unlock();
    } else {
        cass_session_free(session);
    }
}

void db_scylla::set_auth(const char * user, const char * pass) {
    if(NULL==pass || NULL==user) {
        logger_error(&quot;user or pass is NULL.&quot;);
        return;
    }
    user_ = user;
    pass_ = pass;
}

void db_scylla::set_conn_timeout(int ms_timeout) {
    conn_timeout_ = ms_timeout;
}

void db_scylla::set_rw_timeout(int ms_timeout) {
    rw_timeout_ = ms_timeout;
}

void db_scylla::set_io_thread_num(int cn) {
    if(cn&gt;0 &amp;&amp; cn&lt;1024) {
        thread_num_ = cn;
    }
}

CassSession* db_scylla::create_connect_session(ed_error* err){
    CassSession* session = cass_session_new();
    if(NULL==session) {
        ADD_ED_ERROR(err, ERR_SDB_CREATE_SESSION, &quot;create session failed.&quot;);
        return NULL;
    }
    CassFuture* future = cass_session_connect(session, cluster_);
    cass_future_wait(future);
    CassError rc = cass_future_error_code(future);
    if (rc != CASS_OK) {
        ADD_ED_ERROR(err, ERR_SDB_CREATE_SESSION, &quot;create session failed. err=%s&quot;,
                cass_error_desc(rc));
        cass_session_free(session);
        session = NULL;
    }
    cass_future_free(future);
    return session;
}

void db_scylla::get_query_string(const scylla_obj &amp; obj, bool bhot,
        acl::string &amp; str) {
    std::string tmpstr;
    size_t maxPos = obj.vidc_.size()-1;
    for(size_t i=0; i&lt;obj.vidc_.size(); ++i) {
        tmpstr.append(&quot;&#39;&quot;).append(obj.vidc_[i]).append(&quot;&#39;&quot;);
        if(i!=maxPos) {
            tmpstr.append(&quot;,&quot;);
        }
    }
    if(bhot) {
        if(tmpstr.empty()) {
            str.format(&quot;SELECT %s,%s FROM %s WHERE uri=&#39;%s&#39;&quot;,
                    CONST_COL_ZONE, CONST_COL_LEVEL, KEYSPACE_TABLE, obj.uri_.c_str());
        } else {
            str.format(&quot;SELECT %s,%s FROM %s WHERE uri=&#39;%s&#39; AND zone in(%s)&quot;,
                    CONST_COL_ZONE, CONST_COL_LEVEL, KEYSPACE_TABLE, 
                    obj.uri_.c_str(), tmpstr.c_str());
        }
    } else {
        if(tmpstr.empty()) {
            str.format(&quot;SELECT %s,%s,%s,%s FROM %s WHERE uri=&#39;%s&#39;&quot;,
                    CONST_COL_URI, CONST_COL_VIDC, CONST_COL_CACHE, CONST_COL_TYPE,
                    KEYSPACE_TABLE, obj.uri_.c_str());
        } else {
            str.format(&quot;SELECT %s,%s,%s,%s FROM %s WHERE uri=&#39;%s&#39; AND vidc in(%s)&quot;,
                    CONST_COL_URI, CONST_COL_VIDC, CONST_COL_CACHE, CONST_COL_TYPE,
                    KEYSPACE_TABLE, obj.uri_.c_str(), tmpstr.c_str());
        }
    }

}

bool db_scylla::parse_one_record(const CassRow* row, bool bhot,
        std::vector&lt;record_scylla&gt; &amp; vec) {
    bool bret = true;
    record_scylla record;
    if(bhot) {
        get_col_value(row, CONST_COL_ZONE, record.vidc_); //将zone 存放到vidc_中
        get_col_value(row, CONST_COL_LEVEL, record.type_); //将level 存放到type中
    } else {
        get_col_value(row, CONST_COL_URI, record.uri_);
        get_col_value(row, CONST_COL_VIDC, record.vidc_);
        get_col_value(row, CONST_COL_CACHE, record.cache_);
        //    get_col_value(row, &quot;zone&quot;, record.zone_);
        get_col_value(row, CONST_COL_TYPE, record.type_);
    }
    vec.push_back(record);
    return bret;
}

bool db_scylla::get_col_value(const CassRow* row, const char * cname,
        std::string &amp; value) {
    bool bret = false;
    const char* row_key;
    size_t row_key_length;
    if(CASS_OK==cass_value_get_string(
                cass_row_get_column_by_name(row, cname),
                &amp;row_key, &amp;row_key_length)) {
        value = row_key;
        bret = true;
    }
    return bret;
}

bool db_scylla::get_col_value(const CassRow* row, const char * cname,
        int &amp; value) {
    bool bret = false;
    if(CASS_OK==cass_value_get_int32(cass_row_get_column_by_name(row, cname),
                &amp;value)) {
        bret = true;
    }
    return bret;
}

} /* DB */
</code></pre>
</div>


    <div class="post-guide">
        <div class="item left">
            
              <a href="/2020/08/31/05%20%E5%88%86%E5%B8%83%E5%BC%8F%E5%8F%8A%E6%95%B0%E6%8D%AE%E5%BA%93/05%20kafka/00%20kafka%E5%9F%BA%E7%A1%80/">
                  <i class="fa fa-angle-left" aria-hidden="true"></i>
                  00 kafka基础
              </a>
            
        </div>
        <div class="item right">
            
              <a href="/2020/08/29/03%20%E5%BC%80%E5%8F%91/01%20C&C++/04%20typedef%20%E7%B2%BE%E9%AB%93/">
                04 typedef 精髓
                <i class="fa fa-angle-right" aria-hidden="true"></i>
              </a>
            
        </div>
    </div>



	<div id="vcomments"></div>


<script>
	
		// 评论
		new Valine({
			av: AV,
			el: '#vcomments',
			notify: false,
			verify: false,
			path: window.location.pathname,
			appId: 'kqRG1YI357MX0zgAERzjbptL-gzGzoHsz',
			appKey: '2PLYnaLv42a7NAbLhpOadDfj',
			placeholder: '请输入评论',
			avatar: 'retro',
			recordIP: false
		})
	
	
</script>
	</div>
	<div id="footer">
	<p>
	©2019-<span id="footerYear"></span> 
	<a href="/">Fly542</a> 
	
	
		|
		<span id="busuanzi_container_site_pv">
			pv
			<span id="busuanzi_value_site_pv"></span>
		</span>
		|
		<span id="busuanzi_container_site_uv"> 
			uv
			<span id="busuanzi_value_site_uv"></span>
		</span>
	
	<br>
	Powered by <a href="//fly542.cn" target="_blank">Fly542</a>
	</p>
</div>
<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?a630d6a8f1929d069d0a6c8ade4e9add";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>
<script src="/js/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>

	<button id="totop-toggle" class="toggle"><i class="fa fa-angle-double-up" aria-hidden="true"></i></button>
</body>
</html>